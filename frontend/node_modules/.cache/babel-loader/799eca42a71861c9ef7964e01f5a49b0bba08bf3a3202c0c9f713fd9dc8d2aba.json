{"ast":null,"code":"var _jsxFileName = \"D:\\\\weektable\\\\frontend\\\\src\\\\components\\\\Archive.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Archive() {\n  _s();\n  const [months, setMonths] = useState([]);\n  const [sel, setSel] = useState(null);\n  const [days, setDays] = useState([]);\n  const [tasks, setTasks] = useState([]);\n\n  // 加载月份档案列表 & 任务\n  useEffect(() => {\n    axios.get('/api/monthly/archives').then(res => {\n      setMonths(res.data.archives);\n      if (res.data.archives.length) setSel(res.data.archives[0]);\n    });\n    axios.get('/api/tasks').then(res => setTasks(res.data.tasks));\n  }, []);\n\n  // 加载所选月份数据\n  useEffect(() => {\n    if (!sel) return;\n    axios.get(`/api/monthly_records?month=${sel}`).then(res => setDays(res.data.days));\n  }, [sel]);\n\n  // 生成日历格子二维数组 (周一~周日)\n  const weeks = [];\n  if (days.length) {\n    // 确定第一天星期几 (0=Sun,1=Mon…)\n    const firstDow = new Date(days[0].date).getDay();\n    let week = Array(7).fill(null);\n    // 从 Monday=1 映射\n    let idx = firstDow === 0 ? 6 : firstDow - 1;\n    days.forEach(d => {\n      week[idx] = d;\n      idx++;\n      if (idx === 7) {\n        weeks.push(week);\n        week = Array(7).fill(null);\n        idx = 0;\n      }\n    });\n    if (week.some(x => x !== null)) weeks.push(week);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"\\u5386\\u53F2\\u7B7E\\u5230\\u6863\\u6848\\uFF08\\u6309\\u6708\\uFF09\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: 16\n      },\n      children: months.map(m => /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setSel(m),\n        style: {\n          marginRight: 8,\n          padding: '4px 10px',\n          background: m === sel ? '#1890ff' : '#eee',\n          color: m === sel ? '#fff' : '#000',\n          border: 'none',\n          cursor: 'pointer'\n        },\n        children: m\n      }, m, false, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 7\n    }, this), weeks.length > 0 && /*#__PURE__*/_jsxDEV(\"table\", {\n      style: {\n        borderCollapse: 'collapse',\n        width: '100%'\n      },\n      border: \"1\",\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          style: {\n            background: '#f4f4f4'\n          },\n          children: ['一', '二', '三', '四', '五', '六', '日'].map(d => /*#__PURE__*/_jsxDEV(\"th\", {\n            style: {\n              padding: 6\n            },\n            children: [\"\\u5468\", d]\n          }, d, true, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: weeks.map((week, wi) => /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: week.map((cell, ci) => /*#__PURE__*/_jsxDEV(\"td\", {\n            style: {\n              height: 80,\n              verticalAlign: 'top',\n              padding: 4\n            },\n            title: cell ? tasks.map(t => `${t.name} ${cell.statuses[t.id] ? '√' : '×'}`).join('\\n') : '',\n            children: cell ? `${cell.done_count}/${cell.total_count}` : ''\n          }, ci, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 19\n          }, this))\n        }, wi, false, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }, this), weeks.length === 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\u8BE5\\u6708\\u6682\\u65E0\\u6570\\u636E\\u3002\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 28\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 5\n  }, this);\n}\n_s(Archive, \"/EgUBY3+lEU4HkrkW1MkyF7EDs0=\");\n_c = Archive;\nvar _c;\n$RefreshReg$(_c, \"Archive\");","map":{"version":3,"names":["React","useEffect","useState","axios","jsxDEV","_jsxDEV","Archive","_s","months","setMonths","sel","setSel","days","setDays","tasks","setTasks","get","then","res","data","archives","length","weeks","firstDow","Date","date","getDay","week","Array","fill","idx","forEach","d","push","some","x","children","fileName","_jsxFileName","lineNumber","columnNumber","style","marginBottom","map","m","onClick","marginRight","padding","background","color","border","cursor","borderCollapse","width","wi","cell","ci","height","verticalAlign","title","t","name","statuses","id","join","done_count","total_count","_c","$RefreshReg$"],"sources":["D:/weektable/frontend/src/components/Archive.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\n\r\nexport default function Archive() {\r\n  const [months, setMonths] = useState([]);\r\n  const [sel, setSel]      = useState(null);\r\n  const [days, setDays]     = useState([]);\r\n  const [tasks, setTasks]   = useState([]);\r\n\r\n  // 加载月份档案列表 & 任务\r\n  useEffect(() => {\r\n    axios.get('/api/monthly/archives')\r\n      .then(res => {\r\n        setMonths(res.data.archives);\r\n        if (res.data.archives.length) setSel(res.data.archives[0]);\r\n      });\r\n    axios.get('/api/tasks')\r\n      .then(res => setTasks(res.data.tasks));\r\n  }, []);\r\n\r\n  // 加载所选月份数据\r\n  useEffect(() => {\r\n    if (!sel) return;\r\n    axios.get(`/api/monthly_records?month=${sel}`)\r\n      .then(res => setDays(res.data.days));\r\n  }, [sel]);\r\n\r\n  // 生成日历格子二维数组 (周一~周日)\r\n  const weeks = [];\r\n  if (days.length) {\r\n    // 确定第一天星期几 (0=Sun,1=Mon…)\r\n    const firstDow = new Date(days[0].date).getDay();\r\n    let week = Array(7).fill(null);\r\n    // 从 Monday=1 映射\r\n    let idx = firstDow === 0 ? 6 : firstDow - 1;\r\n    days.forEach(d => {\r\n      week[idx] = d;\r\n      idx++;\r\n      if (idx === 7) {\r\n        weeks.push(week);\r\n        week = Array(7).fill(null);\r\n        idx = 0;\r\n      }\r\n    });\r\n    if (week.some(x=>x!==null)) weeks.push(week);\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <h3>历史签到档案（按月）</h3>\r\n      <div style={{ marginBottom:16 }}>\r\n        {months.map(m => (\r\n          <button key={m}\r\n                  onClick={()=>setSel(m)}\r\n                  style={{\r\n                    marginRight:8, padding:'4px 10px',\r\n                    background: m===sel?'#1890ff':'#eee',\r\n                    color:    m===sel?'#fff':'#000',\r\n                    border:'none', cursor:'pointer'\r\n                  }}\r\n          >{m}</button>\r\n        ))}\r\n      </div>\r\n\r\n      {weeks.length>0 && (\r\n        <table style={{ borderCollapse:'collapse', width:'100%' }} border=\"1\">\r\n          <thead>\r\n            <tr style={{ background:'#f4f4f4' }}>\r\n              {['一','二','三','四','五','六','日'].map(d => (\r\n                <th key={d} style={{ padding:6 }}>周{d}</th>\r\n              ))}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {weeks.map((week, wi) => (\r\n              <tr key={wi}>\r\n                {week.map((cell, ci) => (\r\n                  <td key={ci} style={{ height:80, verticalAlign:'top', padding:4 }}\r\n                      title={\r\n                        cell\r\n                          ? tasks.map(t => `${t.name} ${cell.statuses[t.id]? '√':'×'}`).join('\\n')\r\n                          : ''\r\n                      }\r\n                  >\r\n                    {cell\r\n                      ? `${cell.done_count}/${cell.total_count}`\r\n                      : ''\r\n                    }\r\n                  </td>\r\n                ))}\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      )}\r\n      {weeks.length===0 && <p>该月暂无数据。</p>}\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}