{"ast":null,"code":"import { extend, addClass, removeClass, setValue, closest, select, EventHandler } from '@syncfusion/ej2-base';\nimport { remove, classList } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, refreshForeignData, getObject, addRemoveEventListener, getCellFromRow } from '../base/util';\nimport { getCellByColAndRowIndex, addFixedColumnBorder } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\nimport * as literals from '../base/string-literals';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n *\n * @hidden\n */\nvar BatchEdit = /** @class */function () {\n  function BatchEdit(parent, serviceLocator, renderer) {\n    this.cellDetails = {};\n    this.originalCell = {};\n    this.cloneCell = {};\n    this.editNext = false;\n    this.preventSaveCell = false;\n    this.initialRender = true;\n    this.validationColObj = [];\n    /** @hidden */\n    this.addBatchRow = false;\n    this.prevEditedBatchCell = false;\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.renderer = renderer;\n    this.focus = serviceLocator.getService('focus');\n    this.addEventListener();\n  }\n  /**\n   * @returns {void}\n   * @hidden\n   */\n  BatchEdit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.evtHandlers = [{\n      event: events.click,\n      handler: this.clickHandler\n    }, {\n      event: events.dblclick,\n      handler: this.dblClickHandler\n    }, {\n      event: events.beforeCellFocused,\n      handler: this.onBeforeCellFocused\n    }, {\n      event: events.cellFocused,\n      handler: this.onCellFocused\n    }, {\n      event: events.doubleTap,\n      handler: this.dblClickHandler\n    }, {\n      event: events.keyPressed,\n      handler: this.keyDownHandler\n    }, {\n      event: events.editNextValCell,\n      handler: this.editNextValCell\n    }, {\n      event: events.destroy,\n      handler: this.destroy\n    }];\n    addRemoveEventListener(this.parent, this.evtHandlers, true, this);\n    EventHandler.add(this.parent.element, 'mousedown', this.mouseDownHandler, this);\n    this.dataBoundFunction = this.dataBound.bind(this);\n    this.batchCancelFunction = this.batchCancel.bind(this);\n    this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n  BatchEdit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    addRemoveEventListener(this.parent, this.evtHandlers, false);\n    EventHandler.remove(this.parent.element, 'mousedown', this.mouseDownHandler);\n    this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n  };\n  BatchEdit.prototype.batchCancel = function () {\n    this.parent.focusModule.restoreFocus({\n      requestType: 'batchCancel'\n    });\n  };\n  BatchEdit.prototype.dataBound = function () {\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n  BatchEdit.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n  BatchEdit.prototype.mouseDownHandler = function (e) {\n    if (!isNullOrUndefined(this.parent.element.querySelector('.e-gridform'))) {\n      this.mouseDownElement = e.target;\n    } else {\n      this.mouseDownElement = undefined;\n    }\n  };\n  BatchEdit.prototype.clickHandler = function (e) {\n    if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n      if (this.parent.isEdit && closest(this.form, 'td') !== closest(e.target, 'td') && isNullOrUndefined(this.mouseDownElement) || this.mouseDownElement === e.target) {\n        this.saveCell();\n        this.editNextValCell();\n      }\n      if (parentsUntil(e.target, literals.rowCell) && !this.parent.isEdit) {\n        this.setCellIdx(e.target);\n      }\n    }\n  };\n  BatchEdit.prototype.dblClickHandler = function (e) {\n    var target = parentsUntil(e.target, literals.rowCell);\n    var tr = parentsUntil(e.target, literals.row);\n    var rowIndex = tr && parseInt(tr.getAttribute(literals.ariaRowIndex), 10) - 1;\n    var colIndex = target && parseInt(target.getAttribute(literals.ariaColIndex), 10) - 1;\n    if (!isNullOrUndefined(target) && !isNullOrUndefined(rowIndex) && !isNaN(colIndex) && !target.parentElement.classList.contains(literals.editedRow) && this.parent.getColumns()[parseInt(colIndex.toString(), 10)].allowEditing) {\n      this.editCell(rowIndex, this.parent.getColumns()[parseInt(colIndex.toString(), 10)].field, this.isAddRow(rowIndex));\n    }\n  };\n  BatchEdit.prototype.onBeforeCellFocused = function (e) {\n    if (this.parent.isEdit && this.validateFormObj() && (e.byClick || ['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1)) {\n      e.cancel = true;\n      if (e.byClick) {\n        e.clickArgs.preventDefault();\n      } else {\n        e.keyArgs.preventDefault();\n      }\n    }\n  };\n  BatchEdit.prototype.onCellFocused = function (e) {\n    var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n    if (this.parent.focusModule.active) {\n      this.prevEditedBatchCell = this.parent.focusModule.active.matrix.current.toString() === this.prevEditedBatchCellMatrix().toString();\n      this.crtRowIndex = [].slice.call(this.parent.focusModule.active.getTable().rows).indexOf(closest(e.element, 'tr'));\n    }\n    if (!e.byKey || clear) {\n      if (this.parent.isEdit && clear) {\n        this.saveCell();\n      }\n      return;\n    }\n    var _a = e.container.indexes,\n      rowIndex = _a[0],\n      cellIndex = _a[1];\n    var actualIndex = e.element.getAttribute('aria-colindex') ? parseInt(e.element.getAttribute('aria-colindex'), 10) - 1 : cellIndex;\n    if (actualIndex !== cellIndex) {\n      cellIndex = actualIndex;\n    }\n    if (this.parent.frozenRows && e.container.isContent) {\n      rowIndex += (this.parent.getContent().querySelector('.e-hiddenrow') ? 0 : this.parent.frozenRows) + this.parent.getHeaderContent().querySelectorAll('.e-insertedrow').length;\n    }\n    var isEdit = this.parent.isEdit;\n    if (!this.parent.element.getElementsByClassName('e-popup-open').length) {\n      isEdit = isEdit && !this.validateFormObj();\n      switch (e.keyArgs.action) {\n        case 'tab':\n        case 'shiftTab':\n          // eslint-disable-next-line no-case-declarations\n          var indent = this.parent.isRowDragable() && this.parent.isDetail() ? 2 : this.parent.isRowDragable() || this.parent.isDetail() ? 1 : 0;\n          // eslint-disable-next-line no-case-declarations\n          var col = this.parent.getColumns()[cellIndex - indent];\n          if (col && !this.parent.isEdit) {\n            this.editCell(rowIndex, col.field);\n          }\n          if (isEdit || this.parent.isLastCellPrimaryKey) {\n            this.editCellFromIndex(rowIndex, cellIndex);\n          }\n          break;\n        case 'enter':\n        case 'shiftEnter':\n          e.keyArgs.preventDefault();\n          // eslint-disable-next-line no-case-declarations\n          var args = {\n            cancel: false,\n            keyArgs: e.keyArgs\n          };\n          this.parent.notify('beforeFocusCellEdit', args);\n          if (!args.cancel && isEdit) {\n            this.editCell(rowIndex, this.cellDetails.column.field);\n          }\n          break;\n        case 'f2':\n          this.editCellFromIndex(rowIndex, cellIndex);\n          this.focus.focus();\n          break;\n      }\n    }\n  };\n  BatchEdit.prototype.isAddRow = function (index) {\n    return this.parent.getDataRows()[parseInt(index.toString(), 10)].classList.contains('e-insertedrow');\n  };\n  BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n    this.cellDetails.rowIndex = rowIdx;\n    this.cellDetails.cellIndex = cellIdx;\n    this.editCell(rowIdx, this.parent.getColumns()[parseInt(cellIdx.toString(), 10)].field, this.isAddRow(rowIdx));\n  };\n  BatchEdit.prototype.closeEdit = function () {\n    var gObj = this.parent;\n    var rows = this.parent.getRowsObject();\n    var argument = {\n      cancel: false,\n      batchChanges: this.getBatchChanges()\n    };\n    gObj.notify(events.beforeBatchCancel, argument);\n    if (argument.cancel) {\n      return;\n    }\n    if (gObj.isEdit) {\n      this.saveCell(true);\n    }\n    this.isAdded = false;\n    var selectedIndexes = [];\n    if (gObj.selectionModule) {\n      selectedIndexes = gObj.selectionModule.selectedRowIndexes;\n    }\n    gObj.clearSelection();\n    for (var i = 0; i < rows.length; i++) {\n      var isInsert = false;\n      var isDirty = rows[parseInt(i.toString(), 10)].isDirty;\n      isInsert = this.removeBatchElementChanges(rows[parseInt(i.toString(), 10)], isDirty);\n      if (isInsert) {\n        rows.splice(i, 1);\n      }\n      if (isInsert) {\n        i--;\n      }\n    }\n    if (!gObj.getContentTable().querySelector('tr.e-row')) {\n      gObj.renderModule.renderEmptyRow();\n    }\n    var args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.notify(events.batchCancel, {\n      rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() : [new Row({\n        isDataRow: true,\n        cells: [new Cell({\n          isDataCell: true,\n          visible: true\n        })]\n      })]\n    });\n    if (gObj.isCheckBoxSelection && (gObj.selectionSettings.checkboxOnly || gObj.selectionSettings.persistSelection)) {\n      gObj.selectRows(selectedIndexes);\n    } else {\n      gObj.selectRow(this.cellDetails.rowIndex);\n    }\n    this.refreshRowIdx();\n    gObj.notify(events.toolbarRefresh, {});\n    this.parent.notify(events.tooltipDestroy, {});\n    args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.trigger(events.batchCancel, args);\n  };\n  BatchEdit.prototype.removeBatchElementChanges = function (row, isDirty) {\n    var gObj = this.parent;\n    var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n    var isInstertedRemoved = false;\n    if (isDirty) {\n      row.isDirty = isDirty;\n      var tr = gObj.getRowElementByUID(row.uid);\n      if (tr) {\n        if (tr.classList.contains('e-insertedrow')) {\n          remove(tr);\n          isInstertedRemoved = true;\n        } else {\n          refreshForeignData(row, this.parent.getForeignKeyColumns(), row.data);\n          delete row.changes;\n          delete row.edit;\n          row.isDirty = false;\n          classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n          rowRenderer.refresh(row, gObj.getColumns(), false);\n        }\n        if (this.parent.aggregates.length > 0) {\n          var type = 'type';\n          var editType = [];\n          editType[\"\" + type] = 'cancel';\n          this.parent.notify(events.refreshFooterRenderer, editType);\n          if (this.parent.groupSettings.columns.length > 0) {\n            this.parent.notify(events.groupAggregates, editType);\n          }\n        }\n      }\n    }\n    return isInstertedRemoved;\n  };\n  BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n    this.saveCell();\n    if (this.validateFormObj()) {\n      this.saveCell(true);\n    }\n    this.isAdded = false;\n    this.bulkDelete(fieldname, data);\n    if (this.parent.aggregates.length > 0) {\n      if (!(this.parent.isReact || this.parent.isVue)) {\n        this.parent.notify(events.refreshFooterRenderer, {});\n      }\n      if (this.parent.groupSettings.columns.length > 0) {\n        this.parent.notify(events.groupAggregates, {});\n      }\n      if (this.parent.isReact || this.parent.isVue) {\n        this.parent.notify(events.refreshFooterRenderer, {});\n      }\n    }\n  };\n  BatchEdit.prototype.addRecord = function (data) {\n    this.bulkAddRow(data);\n  };\n  BatchEdit.prototype.endEdit = function () {\n    if (this.parent.isEdit && this.validateFormObj()) {\n      return;\n    }\n    this.batchSave();\n  };\n  BatchEdit.prototype.validateFormObj = function () {\n    return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n  };\n  BatchEdit.prototype.batchSave = function () {\n    var gObj = this.parent;\n    var deletedRecords = 'deletedRecords';\n    if (gObj.isCheckBoxSelection) {\n      var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n      if (checkAllBox.classList.contains('e-checkbox-disabled') && gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n        removeClass([checkAllBox], ['e-checkbox-disabled']);\n      }\n    }\n    this.saveCell();\n    if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n      return;\n    }\n    var changes = this.getBatchChanges();\n    if (this.parent.selectionSettings.type === 'Multiple' && changes[\"\" + deletedRecords].length && this.parent.selectionSettings.persistSelection) {\n      changes[\"\" + deletedRecords] = this.removeSelectedData;\n      this.removeSelectedData = [];\n    }\n    var original = {\n      changedRecords: this.parent.getRowsObject().filter(function (row) {\n        return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1;\n      }).map(function (row) {\n        return row.data;\n      })\n    };\n    var args = {\n      batchChanges: changes,\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n      if (beforeBatchSaveArgs.cancel) {\n        return;\n      }\n      gObj.showSpinner();\n      gObj.notify(events.bulkSave, {\n        changes: changes,\n        original: original\n      });\n    });\n  };\n  BatchEdit.prototype.getBatchChanges = function () {\n    var changes = {\n      addedRecords: [],\n      deletedRecords: [],\n      changedRecords: []\n    };\n    var rows = this.parent.getRowsObject();\n    for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n      var row = rows_1[_i];\n      if (row.isDirty) {\n        switch (row.edit) {\n          case 'add':\n            changes.addedRecords.push(row.changes);\n            break;\n          case 'delete':\n            changes.deletedRecords.push(row.data);\n            break;\n          default:\n            changes.changedRecords.push(row.changes);\n        }\n      }\n    }\n    return changes;\n  };\n  /**\n   * @param {string} uid - specifes the uid\n   * @returns {void}\n   * @hidden\n   */\n  BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n    var rows = this.parent.getRowsObject();\n    var i = 0;\n    for (var len = rows.length; i < len; i++) {\n      if (rows[parseInt(i.toString(), 10)].uid === uid) {\n        break;\n      }\n    }\n    rows.splice(i, 1);\n  };\n  /**\n   * @param {Row<Column>} row - specifies the row object\n   * @returns {void}\n   * @hidden\n   */\n  BatchEdit.prototype.addRowObject = function (row) {\n    var gObj = this.parent;\n    var isTop = gObj.editSettings.newRowPosition === 'Top';\n    var rowClone = row.clone();\n    if (isTop) {\n      gObj.getRowsObject().unshift(rowClone);\n    } else {\n      gObj.getRowsObject().push(rowClone);\n    }\n  };\n  // tslint:disable-next-line:max-func-body-length\n  BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n    var _this = this;\n    this.removeSelectedData = [];\n    var gObj = this.parent;\n    var index = gObj.selectedRowIndex;\n    var selectedRows = gObj.getSelectedRows();\n    var args = {\n      primaryKey: this.parent.getPrimaryKeyFieldNames(),\n      rowIndex: index,\n      rowData: data ? data : gObj.getSelectedRecords(),\n      cancel: false\n    };\n    if (data) {\n      args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid) : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n    } else {\n      args.row = selectedRows;\n    }\n    if (!args.row) {\n      return;\n    }\n    // tslint:disable-next-line:max-func-body-length\n    gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n      if (beforeBatchDeleteArgs.cancel) {\n        return;\n      }\n      _this.removeSelectedData = gObj.getSelectedRecords();\n      gObj.clearSelection();\n      beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ? beforeBatchDeleteArgs.row : data ? gObj.getRows()[parseInt(index.toString(), 10)] : selectedRows;\n      if (selectedRows.length === 1 || data) {\n        if (Array.isArray(beforeBatchDeleteArgs.row)) {\n          beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row[0];\n        }\n        var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n        uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n        if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n          _this.removeRowObjectFromUID(uid);\n          remove(beforeBatchDeleteArgs.row);\n        } else {\n          var rowObj = gObj.getRowObjectFromUID(uid);\n          rowObj.isDirty = true;\n          rowObj.edit = 'delete';\n          classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n          if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n            gObj.getHeaderTable().querySelector(literals.tbody).appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n          }\n        }\n        delete beforeBatchDeleteArgs.row;\n      } else {\n        if (data) {\n          index = parseInt(beforeBatchDeleteArgs.row.getAttribute(literals.ariaRowIndex), 10) - 1;\n        }\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uniqueid = selectedRows[parseInt(i.toString(), 10)].getAttribute('data-uid');\n          if (selectedRows[parseInt(i.toString(), 10)].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uniqueid);\n            remove(selectedRows[parseInt(i.toString(), 10)]);\n          } else {\n            classList(selectedRows[parseInt(i.toString(), 10)], ['e-hiddenrow', 'e-updatedtd'], []);\n            var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n            selectedRow.isDirty = true;\n            selectedRow.edit = 'delete';\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderTable().querySelector(literals.tbody).appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n          }\n        }\n        delete beforeBatchDeleteArgs.row;\n      }\n      _this.refreshRowIdx();\n      if (data) {\n        gObj.editModule.deleteRowUid = undefined;\n      }\n      if (!gObj.isCheckBoxSelection) {\n        gObj.selectRow(index);\n      }\n      gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n      gObj.notify(events.batchDelete, {\n        rows: _this.parent.getRowsObject()\n      });\n      gObj.focusModule.restoreFocus({\n        requestType: 'batchDelete'\n      });\n      gObj.notify(events.toolbarRefresh, {});\n      if (!gObj.getContentTable().querySelector('tr.e-row')) {\n        gObj.renderModule.renderEmptyRow();\n      }\n    });\n  };\n  BatchEdit.prototype.refreshRowIdx = function () {\n    var gObj = this.parent;\n    var rows = gObj.getAllDataRows(true);\n    var dataObjects = gObj.getRowsObject().filter(function (row) {\n      return !row.isDetailRow;\n    });\n    for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n      if (rows[parseInt(i.toString(), 10)].classList.contains(literals.row) && !rows[parseInt(i.toString(), 10)].classList.contains('e-hiddenrow')) {\n        rows[parseInt(i.toString(), 10)].setAttribute(literals.ariaRowIndex, (j + 1).toString());\n        dataObjects[parseInt(i.toString(), 10)].index = j;\n        j++;\n      } else {\n        rows[parseInt(i.toString(), 10)].removeAttribute(literals.ariaRowIndex);\n        dataObjects[parseInt(i.toString(), 10)].index = -1;\n      }\n    }\n  };\n  BatchEdit.prototype.bulkAddRow = function (data) {\n    var _this = this;\n    var gObj = this.parent;\n    if (!gObj.editSettings.allowAdding) {\n      if (gObj.isEdit) {\n        this.saveCell();\n      }\n      return;\n    }\n    if (gObj.isEdit) {\n      this.saveCell();\n      this.parent.notify(events.editNextValCell, {});\n    }\n    if (this.validateFormObj()) {\n      return;\n    }\n    if (this.initialRender) {\n      var visibleColumns = gObj.getVisibleColumns();\n      for (var i = 0; i < visibleColumns.length; i++) {\n        if (visibleColumns[parseInt(i.toString(), 10)].validationRules && visibleColumns[parseInt(i.toString(), 10)].validationRules['required']) {\n          var obj = {\n            field: visibleColumns[parseInt(i.toString(), 10)]['field'].slice(),\n            cellIdx: i\n          };\n          this.validationColObj.push(obj);\n        }\n      }\n      this.initialRender = false;\n    }\n    this.parent.element.classList.add('e-editing');\n    var defaultData = data ? data : this.getDefaultData();\n    var args = {\n      defaultData: defaultData,\n      primaryKey: gObj.getPrimaryKeyFieldNames(),\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n      if (beforeBatchAddArgs.cancel) {\n        return;\n      }\n      _this.isAdded = true;\n      gObj.clearSelection();\n      var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n      var model = new RowModelGenerator(_this.parent);\n      var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n      var tr = row.render(modelData[0], gObj.getColumns());\n      addFixedColumnBorder(tr);\n      var col;\n      var index;\n      for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n        tr.insertBefore(_this.parent.createElement('td', {\n          className: 'e-indentcell'\n        }), tr.firstChild);\n        modelData[0].cells.unshift(new Cell({\n          cellType: CellType.Indent\n        }));\n      }\n      var tbody = gObj.getContentTable().querySelector(literals.tbody);\n      tr.classList.add('e-insertedrow');\n      if (tbody.querySelector('.e-emptyrow')) {\n        var emptyRow = tbody.querySelector('.e-emptyrow');\n        emptyRow.parentNode.removeChild(emptyRow);\n        if (gObj.frozenRows && gObj.element.querySelector('.e-frozenrow-empty')) {\n          gObj.element.querySelector('.e-frozenrow-empty').classList.remove('e-frozenrow-empty');\n        }\n      }\n      if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n        tbody = gObj.getHeaderTable().querySelector(literals.tbody);\n      } else {\n        tbody = gObj.getContentTable().querySelector(literals.tbody);\n      }\n      if (_this.parent.editSettings.newRowPosition === 'Top') {\n        tbody.insertBefore(tr, tbody.firstChild);\n      } else {\n        tbody.appendChild(tr);\n      }\n      addClass([].slice.call(tr.getElementsByClassName(literals.rowCell)), ['e-updatedtd']);\n      modelData[0].isDirty = true;\n      modelData[0].changes = extend({}, {}, modelData[0].data, true);\n      modelData[0].edit = 'add';\n      _this.addRowObject(modelData[0]);\n      _this.refreshRowIdx();\n      _this.focus.forgetPrevious();\n      gObj.notify(events.batchAdd, {\n        rows: _this.parent.getRowsObject()\n      });\n      var changes = _this.getBatchChanges();\n      var btmIdx = _this.getBottomIndex();\n      if (_this.parent.editSettings.newRowPosition === 'Top') {\n        gObj.selectRow(0);\n      } else {\n        gObj.selectRow(btmIdx);\n      }\n      if (!data) {\n        index = _this.findNextEditableCell(0, true);\n        col = gObj.getColumns()[parseInt(index.toString(), 10)];\n        if (_this.parent.editSettings.newRowPosition === 'Top') {\n          _this.editCell(0, col.field, true);\n        } else {\n          _this.editCell(btmIdx, col.field, true);\n        }\n      }\n      if (_this.parent.aggregates.length > 0 && (data || changes[literals.addedRecords].length)) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n      }\n      var args1 = {\n        defaultData: beforeBatchAddArgs.defaultData,\n        row: tr,\n        columnObject: col,\n        columnIndex: index,\n        primaryKey: beforeBatchAddArgs.primaryKey,\n        cell: !isNullOrUndefined(index) ? tr.cells[parseInt(index.toString(), 10)] : undefined\n      };\n      gObj.trigger(events.batchAdd, args1);\n    });\n  };\n  BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n    var cols = this.parent.getColumns();\n    var endIndex = cols.length;\n    var validation;\n    for (var i = columnIndex; i < endIndex; i++) {\n      validation = isValOnly ? isNullOrUndefined(cols[parseInt(i.toString(), 10)].validationRules) : false;\n      // if (!isAdd && this.checkNPCell(cols[parseInt(i.toString(), 10)])) {\n      //     return i;\n      // } else\n      if (isAdd && (!cols[parseInt(i.toString(), 10)].template || cols[parseInt(i.toString(), 10)].field) && cols[parseInt(i.toString(), 10)].allowEditing && cols[parseInt(i.toString(), 10)].visible && !(cols[parseInt(i.toString(), 10)].isIdentity && cols[parseInt(i.toString(), 10)].isPrimaryKey) && !validation) {\n        return i;\n      }\n    }\n    return -1;\n  };\n  BatchEdit.prototype.getDefaultData = function () {\n    var gObj = this.parent;\n    var data = {};\n    var dValues = {\n      'number': 0,\n      'string': null,\n      'boolean': false,\n      'date': null,\n      'datetime': null,\n      'dateonly': null\n    };\n    for (var _i = 0, _a = gObj.columnModel; _i < _a.length; _i++) {\n      var col = _a[_i];\n      if (col.field) {\n        setValue(col.field, Object.keys(col).indexOf('defaultValue') >= 0 ? col.defaultValue : dValues[col.type], data);\n      }\n    }\n    return data;\n  };\n  BatchEdit.prototype.setCellIdx = function (target) {\n    var gLen = 0;\n    if (this.parent.allowGrouping) {\n      gLen = this.parent.groupSettings.columns.length;\n    }\n    this.cellDetails.cellIndex = target.cellIndex - gLen;\n    this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n  };\n  BatchEdit.prototype.editCell = function (index, field, isAdd) {\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    this.index = index;\n    this.field = field;\n    this.isAdd = isAdd;\n    var visibleRows = gObj.getDataRows();\n    visibleRows = visibleRows.filter(function (row) {\n      return row.style.display !== 'none' && !row.classList.contains('e-childrow-hidden');\n    });\n    var lastRowIndex = parseInt(visibleRows[visibleRows.length - 1].getAttribute('aria-rowindex'), 10) - 1;\n    var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field && this.cellDetails.rowIndex === index && lastRowIndex !== index && this.prevEditedBatchCell);\n    if (gObj.editSettings.allowEditing) {\n      if (!checkEdit && (col.allowEditing || !col.allowEditing && gObj.focusModule.active && gObj.focusModule.active.getTable().rows[this.crtRowIndex] && gObj.focusModule.active.getTable().rows[this.crtRowIndex].classList.contains('e-insertedrow'))) {\n        this.editCellExtend(index, field, isAdd);\n      } else if (checkEdit) {\n        this.editNext = true;\n        this.saveCell();\n      }\n    }\n  };\n  BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n    var _this = this;\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var keys = gObj.getPrimaryKeyFieldNames();\n    if (gObj.isEdit) {\n      return;\n    }\n    var rowData = extend({}, {}, this.getDataByIndex(index), true);\n    var row = gObj.getDataRows()[parseInt(index.toString(), 10)];\n    rowData = extend({}, {}, this.getDataByIndex(index), true);\n    if (keys[0] === col.field && !row.classList.contains('e-insertedrow') || col.columns || col.isPrimaryKey && col.isIdentity || col.commands) {\n      this.parent.isLastCellPrimaryKey = true;\n      return;\n    }\n    this.parent.isLastCellPrimaryKey = false;\n    this.parent.element.classList.add('e-editing');\n    var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n    var cells = [].slice.apply(row.cells);\n    var args = {\n      columnName: col.field,\n      isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n      primaryKey: keys,\n      rowData: rowData,\n      validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n      value: getObject(col.field, rowData),\n      type: !isAdd ? 'edit' : 'add',\n      cancel: false,\n      foreignKeyData: rowObj && rowObj.foreignKeyData\n    };\n    args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n    args.row = row;\n    args.columnObject = col;\n    if (!args.cell) {\n      return;\n    }\n    gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n      if (cellEditArgs.cancel) {\n        return;\n      }\n      cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n      cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n      cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n      // cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n      _this.cellDetails = {\n        rowData: rowData,\n        column: col,\n        value: cellEditArgs.value,\n        isForeignKey: cellEditArgs.isForeignKey,\n        rowIndex: index,\n        cellIndex: parseInt(cellEditArgs.cell.getAttribute(literals.ariaColIndex), 10) - 1,\n        foreignKeyData: cellEditArgs.foreignKeyData\n      };\n      if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n        _this.isColored = true;\n        cellEditArgs.cell.classList.remove('e-updatedtd');\n      }\n      gObj.isEdit = true;\n      var checkSelect = !isNullOrUndefined(cellEditArgs.row.querySelector('.e-selectionbackground')) ? true : false;\n      gObj.clearSelection();\n      if ((!gObj.isCheckBoxSelection || !gObj.isPersistSelection) && (checkSelect || !gObj.selectionSettings.checkboxOnly)) {\n        gObj.selectRow(_this.cellDetails.rowIndex, true);\n      }\n      _this.renderer.update(cellEditArgs);\n      _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n      _this.form = select('#' + gObj.element.id + 'EditForm', gObj.element);\n      gObj.editModule.applyFormValidation([col]);\n      _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n    });\n  };\n  BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var index = gObj.getColumnIndexByField(field);\n    var isInsertedBatchRow = gObj.getRowByIndex(rowIndex).classList.contains('e-insertedrow') && gObj.getRowByIndex(rowIndex).classList.contains('e-batchrow');\n    if (col && (!col.isPrimaryKey || isInsertedBatchRow) && col.allowEditing) {\n      var td_1 = this.parent.isSpan ? getCellFromRow(gObj, rowIndex, index) : getCellByColAndRowIndex(this.parent, col, rowIndex, index);\n      if (this.parent.isSpan && !td_1) {\n        return;\n      }\n      var rowObj_1 = gObj.getRowObjectFromUID(td_1.parentElement.getAttribute('data-uid'));\n      if (gObj.isEdit || !rowObj_1.changes && (!(value instanceof Date) && rowObj_1.data['' + field] !== value || value instanceof Date && new Date(rowObj_1.data['' + field]).toString() !== new Date(value).toString()) || rowObj_1.changes && (!(value instanceof Date) && rowObj_1.changes['' + field] !== value || value instanceof Date && new Date(rowObj_1.changes['' + field]).toString() !== new Date(value).toString())) {\n        this.refreshTD(td_1, col, rowObj_1, value);\n        var isReactChild = this.parent.parentDetails && this.parent.parentDetails.parentInstObj && this.parent.parentDetails.parentInstObj.isReact;\n        if ((this.parent.isReact && this.parent.requireTemplateRef || isReactChild && this.parent.parentDetails.parentInstObj.requireTemplateRef) && col.template) {\n          // eslint-disable-next-line @typescript-eslint/no-this-alias\n          var thisRef_1 = this;\n          var newReactTd_1 = this.newReactTd;\n          thisRef_1.parent.renderTemplates(function () {\n            thisRef_1.parent.trigger(events.queryCellInfo, {\n              cell: newReactTd_1 || td_1,\n              column: col,\n              data: rowObj_1.changes\n            });\n          });\n        } else if ((this.parent.isReact || isReactChild) && col.template) {\n          this.parent.renderTemplates();\n          this.parent.trigger(events.queryCellInfo, {\n            cell: this.newReactTd || td_1,\n            column: col,\n            data: rowObj_1.changes\n          });\n        } else {\n          this.parent.trigger(events.queryCellInfo, {\n            cell: this.newReactTd || td_1,\n            column: col,\n            data: rowObj_1.changes\n          });\n        }\n      }\n    }\n  };\n  BatchEdit.prototype.setChanges = function (rowObj, field, value) {\n    if (!rowObj.changes) {\n      rowObj.changes = extend({}, {}, rowObj.data, true);\n    }\n    if (!isNullOrUndefined(field)) {\n      if (typeof value === 'string') {\n        value = this.parent.sanitize(value);\n      }\n      DataUtil.setValue(field, value, rowObj.changes);\n    }\n    if (rowObj.data[\"\" + field] !== value) {\n      var type = this.parent.getColumnByField(field).type;\n      if (type === 'date' || type === 'datetime') {\n        if (new Date(rowObj.data[\"\" + field]).toString() !== new Date(value).toString()) {\n          rowObj.isDirty = true;\n        }\n      } else {\n        rowObj.isDirty = true;\n      }\n    }\n  };\n  BatchEdit.prototype.updateRow = function (index, data) {\n    var keys = Object.keys(data);\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var col = keys_1[_i];\n      this.updateCell(index, col, data[\"\" + col]);\n    }\n  };\n  BatchEdit.prototype.getCellIdx = function (uid) {\n    var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n    return cIdx;\n  };\n  BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n    var cell = new CellRenderer(this.parent, this.serviceLocator);\n    value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n    if (rowObj) {\n      this.setChanges(rowObj, column.field, value);\n      refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n    }\n    var rowcell = rowObj ? rowObj.cells : undefined;\n    var parentElement;\n    var cellIndex;\n    if (this.parent.isReact) {\n      parentElement = td.parentElement;\n      cellIndex = td.cellIndex;\n    }\n    var index = 0;\n    if (rowObj) {\n      cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - index], rowObj.changes, {\n        'index': this.getCellIdx(column.uid)\n      });\n    }\n    if (this.parent.isReact) {\n      this.newReactTd = parentElement.cells[parseInt(cellIndex.toString(), 10)];\n      parentElement.cells[parseInt(cellIndex.toString(), 10)].classList.add('e-updatedtd');\n    } else {\n      td.classList.add('e-updatedtd');\n    }\n    td.classList.add('e-updatedtd');\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  BatchEdit.prototype.getColIndex = function (cells, index) {\n    var cIdx = 0;\n    if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n      cIdx = this.parent.groupSettings.columns.length;\n    }\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n    for (var m = 0; m < cells.length; m++) {\n      var colIndex = parseInt(cells[parseInt(m.toString(), 10)].getAttribute(literals.ariaColIndex), 10) - 1;\n      if (colIndex === index - cIdx) {\n        return m;\n      }\n    }\n    return -1;\n  };\n  BatchEdit.prototype.editNextValCell = function () {\n    var gObj = this.parent;\n    var insertedRows = gObj.element.querySelectorAll('.e-insertedrow');\n    var isSingleInsert = insertedRows.length === 1 ? true : false;\n    if (isSingleInsert && this.isAdded && !gObj.isEdit) {\n      var btmIdx = this.getBottomIndex();\n      for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n        if (gObj.isEdit) {\n          return;\n        }\n        var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n        var col = gObj.getColumns()[parseInt(index.toString(), 10)];\n        if (col) {\n          if (this.parent.editSettings.newRowPosition === 'Bottom') {\n            this.editCell(btmIdx, col.field, true);\n          } else {\n            var args = {\n              index: 0,\n              column: col\n            };\n            this.parent.notify(events.nextCellIndex, args);\n            this.editCell(args.index, col.field, true);\n          }\n          this.saveCell();\n        }\n      }\n      if (!gObj.isEdit) {\n        this.isAdded = false;\n      }\n    } else if (!isSingleInsert && this.isAdded && !gObj.isEdit) {\n      for (var i = 0; i < insertedRows.length; i++) {\n        if (!gObj.isEdit) {\n          for (var j = 0; j < this.validationColObj.length; j++) {\n            if (gObj.isEdit) {\n              break;\n            } else if (insertedRows[parseInt(i.toString(), 10)].querySelectorAll('td:not(.e-hide, .e-rowdragdrop, .e-detailrowcollapse, .e-detailrowexpand, .e-indentcell)')[this.validationColObj[parseInt(j.toString(), 10)].cellIdx].innerHTML === '') {\n              this.editCell(parseInt(insertedRows[parseInt(i.toString(), 10)].getAttribute('aria-rowindex'), 10) - 1, this.validationColObj[parseInt(j.toString(), 10)].field);\n              if (this.validateFormObj()) {\n                this.saveCell();\n              }\n            }\n          }\n        } else {\n          break;\n        }\n      }\n      if (!gObj.isEdit) {\n        this.isAdded = false;\n      }\n    }\n  };\n  BatchEdit.prototype.escapeCellEdit = function () {\n    var args = this.generateCellArgs();\n    args.value = args.previousValue;\n    if (args.value || !this.cellDetails.column.validationRules) {\n      this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n    }\n  };\n  BatchEdit.prototype.generateCellArgs = function () {\n    var gObj = this.parent;\n    this.parent.element.classList.remove('e-editing');\n    var column = this.cellDetails.column;\n    var obj = {};\n    obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n    var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n    var cloneEditedData = extend({}, editedData);\n    editedData = extend({}, editedData, this.cellDetails.rowData);\n    var value = getObject(column.field, cloneEditedData);\n    if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n      setValue(column.field, value, editedData);\n    }\n    var args = {\n      columnName: column.field,\n      value: getObject(column.field, editedData),\n      rowData: this.cellDetails.rowData,\n      column: column,\n      previousValue: this.cellDetails.value,\n      isForeignKey: this.cellDetails.isForeignKey,\n      cancel: false\n    };\n    args.cell = this.form.parentElement;\n    args.columnObject = column;\n    return args;\n  };\n  BatchEdit.prototype.saveCell = function (isForceSave) {\n    if (this.preventSaveCell || !this.form) {\n      return;\n    }\n    var gObj = this.parent;\n    if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n      return;\n    }\n    this.preventSaveCell = true;\n    var args = this.generateCellArgs();\n    var tr = args.cell.parentElement;\n    var col = args.column;\n    args.cell.removeAttribute('aria-label');\n    if (!isForceSave) {\n      gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n      gObj.notify(events.batchForm, {\n        formObj: this.form\n      });\n    } else {\n      this.successCallBack(args, tr, col)(args);\n    }\n  };\n  BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n    var _this = this;\n    return function (cellSaveArgs) {\n      var gObj = _this.parent;\n      cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n      cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n      // cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n      if (cellSaveArgs.cancel) {\n        _this.preventSaveCell = false;\n        if (_this.editNext) {\n          _this.editNext = false;\n          if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n            return;\n          }\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n        return;\n      }\n      gObj.editModule.destroyWidgets([column]);\n      gObj.isEdit = false;\n      gObj.editModule.destroyForm();\n      _this.parent.notify(events.tooltipDestroy, {});\n      var rowObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n      _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n      if (_this.parent.isReact) {\n        cellSaveArgs.cell = _this.newReactTd;\n      }\n      removeClass([tr], [literals.editedRow, 'e-batchrow']);\n      removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n      if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored || isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(rowObj.data[column.field]) && isNullOrUndefined(_this.cellDetails.value) && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        cellSaveArgs.cell.classList.remove('e-updatedtd');\n      }\n      if (isNullOrUndefined(isEscapeCellEdit)) {\n        var isReactCompiler = gObj.isReact && column.template && typeof column.template !== 'string';\n        var isReactChild = gObj.parentDetails && gObj.parentDetails.parentInstObj && gObj.parentDetails.parentInstObj.isReact;\n        if (isReactCompiler || isReactChild) {\n          if (gObj.requireTemplateRef) {\n            gObj.renderTemplates(function () {\n              gObj.trigger(events.cellSaved, cellSaveArgs);\n            });\n          } else {\n            gObj.renderTemplates();\n            gObj.trigger(events.cellSaved, cellSaveArgs);\n          }\n        } else {\n          gObj.trigger(events.cellSaved, cellSaveArgs);\n        }\n      }\n      gObj.notify(events.toolbarRefresh, {});\n      _this.isColored = false;\n      if (_this.parent.aggregates.length > 0) {\n        if (!(_this.parent.isReact || _this.parent.isVue)) {\n          _this.parent.notify(events.refreshFooterRenderer, {});\n        }\n        if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n          _this.parent.notify(events.groupAggregates, {});\n        }\n        if (_this.parent.isReact || _this.parent.isVue) {\n          _this.parent.notify(events.refreshFooterRenderer, {});\n        }\n      }\n      _this.preventSaveCell = false;\n      if (_this.editNext) {\n        _this.editNext = false;\n        if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field && _this.prevEditedBatchCell) {\n          return;\n        }\n        var col = gObj.getColumnByField(_this.field);\n        if (col && (col.allowEditing || !col.allowEditing && gObj.focusModule.active && gObj.focusModule.active.getTable().rows[_this.crtRowIndex] && gObj.focusModule.active.getTable().rows[_this.crtRowIndex].classList.contains('e-insertedrow'))) {\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n      }\n      if (isEscapeCellEdit) {\n        gObj.notify(events.restoreFocus, {});\n      }\n    };\n  };\n  BatchEdit.prototype.prevEditedBatchCellMatrix = function () {\n    var editedBatchCellMatrix = [];\n    var gObj = this.parent;\n    var editedBatchCell = gObj.focusModule.active.getTable().querySelector('.e-editedbatchcell');\n    if (editedBatchCell) {\n      var tr = editedBatchCell.parentElement;\n      var rowIndex = [].slice.call(this.parent.focusModule.active.getTable().rows).indexOf(tr);\n      var cellIndex = [].slice.call(tr.cells).indexOf(editedBatchCell);\n      editedBatchCellMatrix = [rowIndex, cellIndex];\n    }\n    return editedBatchCellMatrix;\n  };\n  BatchEdit.prototype.getDataByIndex = function (index) {\n    var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[parseInt(index.toString(), 10)].getAttribute('data-uid'));\n    return row.changes ? row.changes : row.data;\n  };\n  BatchEdit.prototype.keyDownHandler = function (e) {\n    if (this.addBatchRow || (e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n      var gObj = this.parent;\n      var btmIdx = this.getBottomIndex();\n      var rowcell = parentsUntil(e.target, literals.rowCell);\n      if (this.addBatchRow || rowcell && !this.parent.isReact) {\n        var cell = void 0;\n        if (rowcell) {\n          cell = rowcell.querySelector('.e-field');\n        }\n        if (this.addBatchRow || cell) {\n          var visibleColumns = this.parent.getVisibleColumns();\n          var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n          if (this.addBatchRow || visibleColumns[parseInt(columnIndex.toString(), 10)].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n            if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n              if (gObj.editSettings.newRowPosition === 'Top') {\n                gObj.editSettings.newRowPosition = 'Bottom';\n                this.addRecord();\n                gObj.editSettings.newRowPosition = 'Top';\n              } else {\n                this.addRecord();\n              }\n              this.addBatchRow = false;\n            } else {\n              this.saveCell();\n            }\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n  BatchEdit.prototype.addCancelWhilePaging = function () {\n    if (this.validateFormObj()) {\n      this.parent.notify(events.destroyForm, {});\n      this.parent.isEdit = false;\n      this.editNext = false;\n      this.mouseDownElement = undefined;\n      this.isColored = false;\n    }\n  };\n  BatchEdit.prototype.getBottomIndex = function () {\n    var changes = this.getBatchChanges();\n    return this.parent.getCurrentViewRecords().length + changes[literals.addedRecords].length - changes[literals.deletedRecords].length - 1;\n  };\n  return BatchEdit;\n}();\nexport { BatchEdit };","map":{"version":3,"names":["extend","addClass","removeClass","setValue","closest","select","EventHandler","remove","classList","isNullOrUndefined","isUndefined","CellType","parentsUntil","refreshForeignData","getObject","addRemoveEventListener","getCellFromRow","getCellByColAndRowIndex","addFixedColumnBorder","events","RowRenderer","CellRenderer","Row","Cell","RowModelGenerator","DataUtil","literals","BatchEdit","parent","serviceLocator","renderer","cellDetails","originalCell","cloneCell","editNext","preventSaveCell","initialRender","validationColObj","addBatchRow","prevEditedBatchCell","focus","getService","addEventListener","prototype","isDestroyed","evtHandlers","event","click","handler","clickHandler","dblclick","dblClickHandler","beforeCellFocused","onBeforeCellFocused","cellFocused","onCellFocused","doubleTap","keyPressed","keyDownHandler","editNextValCell","destroy","add","element","mouseDownHandler","dataBoundFunction","dataBound","bind","batchCancelFunction","batchCancel","removeEventListener","focusModule","restoreFocus","requestType","notify","toolbarRefresh","e","querySelector","mouseDownElement","target","undefined","id","isEdit","form","saveCell","rowCell","setCellIdx","tr","row","rowIndex","parseInt","getAttribute","ariaRowIndex","colIndex","ariaColIndex","isNaN","parentElement","contains","editedRow","getColumns","toString","allowEditing","editCell","field","isAddRow","validateFormObj","byClick","indexOf","keyArgs","action","cancel","clickArgs","preventDefault","clear","container","isContent","isDataCell","frozenRows","isHeader","active","matrix","current","prevEditedBatchCellMatrix","crtRowIndex","slice","call","getTable","rows","byKey","_a","indexes","cellIndex","actualIndex","getContent","getHeaderContent","querySelectorAll","length","getElementsByClassName","indent","isRowDragable","isDetail","col","isLastCellPrimaryKey","editCellFromIndex","args","column","index","getDataRows","rowIdx","cellIdx","closeEdit","gObj","getRowsObject","argument","batchChanges","getBatchChanges","beforeBatchCancel","isAdded","selectedIndexes","selectionModule","selectedRowIndexes","clearSelection","i","isInsert","isDirty","removeBatchElementChanges","splice","getContentTable","renderModule","renderEmptyRow","isDataRow","cells","visible","isCheckBoxSelection","selectionSettings","checkboxOnly","persistSelection","selectRows","selectRow","refreshRowIdx","tooltipDestroy","trigger","rowRenderer","isInstertedRemoved","getRowElementByUID","uid","getForeignKeyColumns","data","changes","edit","refresh","aggregates","type","editType","refreshFooterRenderer","groupSettings","columns","groupAggregates","deleteRecord","fieldname","bulkDelete","isReact","isVue","addRecord","bulkAddRow","endEdit","batchSave","editModule","formObj","validate","deletedRecords","checkAllBox","pageSettings","totalRecordsCount","currentViewData","removeSelectedData","original","changedRecords","filter","map","beforeBatchSave","beforeBatchSaveArgs","showSpinner","bulkSave","addedRecords","_i","rows_1","push","removeRowObjectFromUID","len","addRowObject","isTop","editSettings","newRowPosition","rowClone","clone","unshift","_this","selectedRowIndex","selectedRows","getSelectedRows","primaryKey","getPrimaryKeyFieldNames","rowData","getSelectedRecords","deleteRowUid","getRows","getCurrentViewRecords","beforeBatchDelete","beforeBatchDeleteArgs","Array","isArray","rowObj","getRowObjectFromUID","getHeaderTable","tbody","appendChild","getRowByIndex","uniqueid","selectedRow","batchDelete","getAllDataRows","dataObjects","isDetailRow","j","setAttribute","removeAttribute","allowAdding","visibleColumns","getVisibleColumns","validationRules","obj","defaultData","getDefaultData","beforeBatchAdd","beforeBatchAddArgs","model","modelData","generateRows","render","insertBefore","createElement","className","firstChild","cellType","Indent","emptyRow","parentNode","removeChild","forgetPrevious","batchAdd","btmIdx","getBottomIndex","findNextEditableCell","args1","columnObject","columnIndex","cell","isAdd","isValOnly","cols","endIndex","validation","template","isIdentity","isPrimaryKey","dValues","columnModel","Object","keys","defaultValue","gLen","allowGrouping","getColumnByField","visibleRows","style","display","lastRowIndex","checkEdit","editCellExtend","getDataByIndex","commands","apply","columnName","isForeignKey","foreignKeyValue","value","foreignKeyData","getColIndex","getCellIdx","cellEdit","cellEditArgs","isColored","checkSelect","isPersistSelection","update","batchEditFormRendered","applyFormValidation","updateCell","getColumnIndexByField","isInsertedBatchRow","td_1","isSpan","rowObj_1","Date","refreshTD","isReactChild","parentDetails","parentInstObj","requireTemplateRef","thisRef_1","newReactTd_1","newReactTd","renderTemplates","queryCellInfo","setChanges","sanitize","updateRow","keys_1","cIdx","getColumnIndexByUid","detailTemplate","childGrid","td","parseFloat","rowcell","m","insertedRows","isSingleInsert","nextCellIndex","innerHTML","escapeCellEdit","generateCellArgs","previousValue","successCallBack","editedData","getCurrentEditedData","cloneEditedData","isForceSave","cellSave","batchForm","cellSaveArgs","isEscapeCellEdit","destroyWidgets","destroyForm","isReactCompiler","cellSaved","editedBatchCellMatrix","editedBatchCell","addCancelWhilePaging"],"sources":["D:/weektable/frontend/node_modules/@syncfusion/ej2-grids/src/grid/actions/batch-edit.js"],"sourcesContent":["import { extend, addClass, removeClass, setValue, closest, select, EventHandler } from '@syncfusion/ej2-base';\nimport { remove, classList } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, refreshForeignData, getObject, addRemoveEventListener, getCellFromRow } from '../base/util';\nimport { getCellByColAndRowIndex, addFixedColumnBorder } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\nimport * as literals from '../base/string-literals';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n *\n * @hidden\n */\nvar BatchEdit = /** @class */ (function () {\n    function BatchEdit(parent, serviceLocator, renderer) {\n        this.cellDetails = {};\n        this.originalCell = {};\n        this.cloneCell = {};\n        this.editNext = false;\n        this.preventSaveCell = false;\n        this.initialRender = true;\n        this.validationColObj = [];\n        /** @hidden */\n        this.addBatchRow = false;\n        this.prevEditedBatchCell = false;\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.renderer = renderer;\n        this.focus = serviceLocator.getService('focus');\n        this.addEventListener();\n    }\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.evtHandlers = [{ event: events.click, handler: this.clickHandler },\n            { event: events.dblclick, handler: this.dblClickHandler },\n            { event: events.beforeCellFocused, handler: this.onBeforeCellFocused },\n            { event: events.cellFocused, handler: this.onCellFocused },\n            { event: events.doubleTap, handler: this.dblClickHandler },\n            { event: events.keyPressed, handler: this.keyDownHandler },\n            { event: events.editNextValCell, handler: this.editNextValCell },\n            { event: events.destroy, handler: this.destroy }];\n        addRemoveEventListener(this.parent, this.evtHandlers, true, this);\n        EventHandler.add(this.parent.element, 'mousedown', this.mouseDownHandler, this);\n        this.dataBoundFunction = this.dataBound.bind(this);\n        this.batchCancelFunction = this.batchCancel.bind(this);\n        this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        addRemoveEventListener(this.parent, this.evtHandlers, false);\n        EventHandler.remove(this.parent.element, 'mousedown', this.mouseDownHandler);\n        this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n    };\n    BatchEdit.prototype.batchCancel = function () {\n        this.parent.focusModule.restoreFocus({ requestType: 'batchCancel' });\n    };\n    BatchEdit.prototype.dataBound = function () {\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    BatchEdit.prototype.mouseDownHandler = function (e) {\n        if (!isNullOrUndefined(this.parent.element.querySelector('.e-gridform'))) {\n            this.mouseDownElement = e.target;\n        }\n        else {\n            this.mouseDownElement = undefined;\n        }\n    };\n    BatchEdit.prototype.clickHandler = function (e) {\n        if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n            if ((this.parent.isEdit && closest(this.form, 'td') !== closest(e.target, 'td'))\n                && isNullOrUndefined(this.mouseDownElement) || this.mouseDownElement === e.target) {\n                this.saveCell();\n                this.editNextValCell();\n            }\n            if (parentsUntil(e.target, literals.rowCell) && !this.parent.isEdit) {\n                this.setCellIdx(e.target);\n            }\n        }\n    };\n    BatchEdit.prototype.dblClickHandler = function (e) {\n        var target = parentsUntil(e.target, literals.rowCell);\n        var tr = parentsUntil(e.target, literals.row);\n        var rowIndex = tr && parseInt(tr.getAttribute(literals.ariaRowIndex), 10) - 1;\n        var colIndex = target && parseInt(target.getAttribute(literals.ariaColIndex), 10) - 1;\n        if (!isNullOrUndefined(target) && !isNullOrUndefined(rowIndex) && !isNaN(colIndex)\n            && !target.parentElement.classList.contains(literals.editedRow) &&\n            this.parent.getColumns()[parseInt(colIndex.toString(), 10)].allowEditing) {\n            this.editCell(rowIndex, this.parent.getColumns()[parseInt(colIndex.toString(), 10)].field, this.isAddRow(rowIndex));\n        }\n    };\n    BatchEdit.prototype.onBeforeCellFocused = function (e) {\n        if (this.parent.isEdit && this.validateFormObj() &&\n            (e.byClick || (['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1))) {\n            e.cancel = true;\n            if (e.byClick) {\n                e.clickArgs.preventDefault();\n            }\n            else {\n                e.keyArgs.preventDefault();\n            }\n        }\n    };\n    BatchEdit.prototype.onCellFocused = function (e) {\n        var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n        if (this.parent.focusModule.active) {\n            this.prevEditedBatchCell = this.parent.focusModule.active.matrix.current.toString() === this.prevEditedBatchCellMatrix()\n                .toString();\n            this.crtRowIndex = [].slice.call(this.parent.focusModule.active.getTable().rows).indexOf(closest(e.element, 'tr'));\n        }\n        if (!e.byKey || clear) {\n            if ((this.parent.isEdit && clear)) {\n                this.saveCell();\n            }\n            return;\n        }\n        var _a = e.container.indexes, rowIndex = _a[0], cellIndex = _a[1];\n        var actualIndex = e.element.getAttribute('aria-colindex') ? parseInt(e.element.getAttribute('aria-colindex'), 10) - 1 : cellIndex;\n        if (actualIndex !== cellIndex) {\n            cellIndex = actualIndex;\n        }\n        if (this.parent.frozenRows && e.container.isContent) {\n            rowIndex += ((this.parent.getContent().querySelector('.e-hiddenrow') ? 0 : this.parent.frozenRows) +\n                this.parent.getHeaderContent().querySelectorAll('.e-insertedrow').length);\n        }\n        var isEdit = this.parent.isEdit;\n        if (!this.parent.element.getElementsByClassName('e-popup-open').length) {\n            isEdit = isEdit && !this.validateFormObj();\n            switch (e.keyArgs.action) {\n                case 'tab':\n                case 'shiftTab':\n                    // eslint-disable-next-line no-case-declarations\n                    var indent = this.parent.isRowDragable() && this.parent.isDetail() ? 2 :\n                        this.parent.isRowDragable() || this.parent.isDetail() ? 1 : 0;\n                    // eslint-disable-next-line no-case-declarations\n                    var col = this.parent.getColumns()[cellIndex - indent];\n                    if (col && !this.parent.isEdit) {\n                        this.editCell(rowIndex, col.field);\n                    }\n                    if (isEdit || this.parent.isLastCellPrimaryKey) {\n                        this.editCellFromIndex(rowIndex, cellIndex);\n                    }\n                    break;\n                case 'enter':\n                case 'shiftEnter':\n                    e.keyArgs.preventDefault();\n                    // eslint-disable-next-line no-case-declarations\n                    var args = { cancel: false, keyArgs: e.keyArgs };\n                    this.parent.notify('beforeFocusCellEdit', args);\n                    if (!args.cancel && isEdit) {\n                        this.editCell(rowIndex, this.cellDetails.column.field);\n                    }\n                    break;\n                case 'f2':\n                    this.editCellFromIndex(rowIndex, cellIndex);\n                    this.focus.focus();\n                    break;\n            }\n        }\n    };\n    BatchEdit.prototype.isAddRow = function (index) {\n        return this.parent.getDataRows()[parseInt(index.toString(), 10)].classList.contains('e-insertedrow');\n    };\n    BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n        this.cellDetails.rowIndex = rowIdx;\n        this.cellDetails.cellIndex = cellIdx;\n        this.editCell(rowIdx, this.parent.getColumns()[parseInt(cellIdx.toString(), 10)].field, this.isAddRow(rowIdx));\n    };\n    BatchEdit.prototype.closeEdit = function () {\n        var gObj = this.parent;\n        var rows = this.parent.getRowsObject();\n        var argument = { cancel: false, batchChanges: this.getBatchChanges() };\n        gObj.notify(events.beforeBatchCancel, argument);\n        if (argument.cancel) {\n            return;\n        }\n        if (gObj.isEdit) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        var selectedIndexes = [];\n        if (gObj.selectionModule) {\n            selectedIndexes = gObj.selectionModule.selectedRowIndexes;\n        }\n        gObj.clearSelection();\n        for (var i = 0; i < rows.length; i++) {\n            var isInsert = false;\n            var isDirty = rows[parseInt(i.toString(), 10)].isDirty;\n            isInsert = this.removeBatchElementChanges(rows[parseInt(i.toString(), 10)], isDirty);\n            if (isInsert) {\n                rows.splice(i, 1);\n            }\n            if (isInsert) {\n                i--;\n            }\n        }\n        if (!gObj.getContentTable().querySelector('tr.e-row')) {\n            gObj.renderModule.renderEmptyRow();\n        }\n        var args = {\n            requestType: 'batchCancel', rows: this.parent.getRowsObject()\n        };\n        gObj.notify(events.batchCancel, {\n            rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() :\n                [new Row({ isDataRow: true, cells: [new Cell({ isDataCell: true, visible: true })] })]\n        });\n        if (gObj.isCheckBoxSelection && (gObj.selectionSettings.checkboxOnly || gObj.selectionSettings.persistSelection)) {\n            gObj.selectRows(selectedIndexes);\n        }\n        else {\n            gObj.selectRow(this.cellDetails.rowIndex);\n        }\n        this.refreshRowIdx();\n        gObj.notify(events.toolbarRefresh, {});\n        this.parent.notify(events.tooltipDestroy, {});\n        args = { requestType: 'batchCancel', rows: this.parent.getRowsObject() };\n        gObj.trigger(events.batchCancel, args);\n    };\n    BatchEdit.prototype.removeBatchElementChanges = function (row, isDirty) {\n        var gObj = this.parent;\n        var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n        var isInstertedRemoved = false;\n        if (isDirty) {\n            row.isDirty = isDirty;\n            var tr = gObj.getRowElementByUID(row.uid);\n            if (tr) {\n                if (tr.classList.contains('e-insertedrow')) {\n                    remove(tr);\n                    isInstertedRemoved = true;\n                }\n                else {\n                    refreshForeignData(row, this.parent.getForeignKeyColumns(), row.data);\n                    delete row.changes;\n                    delete row.edit;\n                    row.isDirty = false;\n                    classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n                    rowRenderer.refresh(row, gObj.getColumns(), false);\n                }\n                if (this.parent.aggregates.length > 0) {\n                    var type = 'type';\n                    var editType = [];\n                    editType[\"\" + type] = 'cancel';\n                    this.parent.notify(events.refreshFooterRenderer, editType);\n                    if (this.parent.groupSettings.columns.length > 0) {\n                        this.parent.notify(events.groupAggregates, editType);\n                    }\n                }\n            }\n        }\n        return isInstertedRemoved;\n    };\n    BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n        this.saveCell();\n        if (this.validateFormObj()) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        this.bulkDelete(fieldname, data);\n        if (this.parent.aggregates.length > 0) {\n            if (!(this.parent.isReact || this.parent.isVue)) {\n                this.parent.notify(events.refreshFooterRenderer, {});\n            }\n            if (this.parent.groupSettings.columns.length > 0) {\n                this.parent.notify(events.groupAggregates, {});\n            }\n            if (this.parent.isReact || this.parent.isVue) {\n                this.parent.notify(events.refreshFooterRenderer, {});\n            }\n        }\n    };\n    BatchEdit.prototype.addRecord = function (data) {\n        this.bulkAddRow(data);\n    };\n    BatchEdit.prototype.endEdit = function () {\n        if (this.parent.isEdit && this.validateFormObj()) {\n            return;\n        }\n        this.batchSave();\n    };\n    BatchEdit.prototype.validateFormObj = function () {\n        return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n    };\n    BatchEdit.prototype.batchSave = function () {\n        var gObj = this.parent;\n        var deletedRecords = 'deletedRecords';\n        if (gObj.isCheckBoxSelection) {\n            var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n            if (checkAllBox.classList.contains('e-checkbox-disabled') &&\n                gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n                removeClass([checkAllBox], ['e-checkbox-disabled']);\n            }\n        }\n        this.saveCell();\n        if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n            return;\n        }\n        var changes = this.getBatchChanges();\n        if (this.parent.selectionSettings.type === 'Multiple' && changes[\"\" + deletedRecords].length &&\n            this.parent.selectionSettings.persistSelection) {\n            changes[\"\" + deletedRecords] = this.removeSelectedData;\n            this.removeSelectedData = [];\n        }\n        var original = {\n            changedRecords: this.parent.getRowsObject()\n                .filter(function (row) { return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1; })\n                .map(function (row) { return row.data; })\n        };\n        var args = { batchChanges: changes, cancel: false };\n        gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n            if (beforeBatchSaveArgs.cancel) {\n                return;\n            }\n            gObj.showSpinner();\n            gObj.notify(events.bulkSave, { changes: changes, original: original });\n        });\n    };\n    BatchEdit.prototype.getBatchChanges = function () {\n        var changes = {\n            addedRecords: [],\n            deletedRecords: [],\n            changedRecords: []\n        };\n        var rows = this.parent.getRowsObject();\n        for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n            var row = rows_1[_i];\n            if (row.isDirty) {\n                switch (row.edit) {\n                    case 'add':\n                        changes.addedRecords.push(row.changes);\n                        break;\n                    case 'delete':\n                        changes.deletedRecords.push(row.data);\n                        break;\n                    default:\n                        changes.changedRecords.push(row.changes);\n                }\n            }\n        }\n        return changes;\n    };\n    /**\n     * @param {string} uid - specifes the uid\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n        var rows = this.parent.getRowsObject();\n        var i = 0;\n        for (var len = rows.length; i < len; i++) {\n            if (rows[parseInt(i.toString(), 10)].uid === uid) {\n                break;\n            }\n        }\n        rows.splice(i, 1);\n    };\n    /**\n     * @param {Row<Column>} row - specifies the row object\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.addRowObject = function (row) {\n        var gObj = this.parent;\n        var isTop = gObj.editSettings.newRowPosition === 'Top';\n        var rowClone = row.clone();\n        if (isTop) {\n            gObj.getRowsObject().unshift(rowClone);\n        }\n        else {\n            gObj.getRowsObject().push(rowClone);\n        }\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n        var _this = this;\n        this.removeSelectedData = [];\n        var gObj = this.parent;\n        var index = gObj.selectedRowIndex;\n        var selectedRows = gObj.getSelectedRows();\n        var args = {\n            primaryKey: this.parent.getPrimaryKeyFieldNames(),\n            rowIndex: index,\n            rowData: data ? data : gObj.getSelectedRecords(),\n            cancel: false\n        };\n        if (data) {\n            args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid)\n                : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n        }\n        else {\n            args.row = selectedRows;\n        }\n        if (!args.row) {\n            return;\n        }\n        // tslint:disable-next-line:max-func-body-length\n        gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n            if (beforeBatchDeleteArgs.cancel) {\n                return;\n            }\n            _this.removeSelectedData = gObj.getSelectedRecords();\n            gObj.clearSelection();\n            beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ?\n                beforeBatchDeleteArgs.row : data ? gObj.getRows()[parseInt(index.toString(), 10)] :\n                selectedRows;\n            if (selectedRows.length === 1 || data) {\n                if (Array.isArray(beforeBatchDeleteArgs.row)) {\n                    beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row[0];\n                }\n                var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n                uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n                if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n                    _this.removeRowObjectFromUID(uid);\n                    remove(beforeBatchDeleteArgs.row);\n                }\n                else {\n                    var rowObj = gObj.getRowObjectFromUID(uid);\n                    rowObj.isDirty = true;\n                    rowObj.edit = 'delete';\n                    classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n                    if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n                        gObj.getHeaderTable().querySelector(literals.tbody).appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                    }\n                }\n                delete beforeBatchDeleteArgs.row;\n            }\n            else {\n                if (data) {\n                    index = parseInt(beforeBatchDeleteArgs.row.getAttribute(literals.ariaRowIndex), 10) - 1;\n                }\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uniqueid = selectedRows[parseInt(i.toString(), 10)].getAttribute('data-uid');\n                    if (selectedRows[parseInt(i.toString(), 10)].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uniqueid);\n                        remove(selectedRows[parseInt(i.toString(), 10)]);\n                    }\n                    else {\n                        classList(selectedRows[parseInt(i.toString(), 10)], ['e-hiddenrow', 'e-updatedtd'], []);\n                        var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n                        selectedRow.isDirty = true;\n                        selectedRow.edit = 'delete';\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderTable().querySelector(literals.tbody).appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                    }\n                }\n                delete beforeBatchDeleteArgs.row;\n            }\n            _this.refreshRowIdx();\n            if (data) {\n                gObj.editModule.deleteRowUid = undefined;\n            }\n            if (!gObj.isCheckBoxSelection) {\n                gObj.selectRow(index);\n            }\n            gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n            gObj.notify(events.batchDelete, { rows: _this.parent.getRowsObject() });\n            gObj.focusModule.restoreFocus({ requestType: 'batchDelete' });\n            gObj.notify(events.toolbarRefresh, {});\n            if (!gObj.getContentTable().querySelector('tr.e-row')) {\n                gObj.renderModule.renderEmptyRow();\n            }\n        });\n    };\n    BatchEdit.prototype.refreshRowIdx = function () {\n        var gObj = this.parent;\n        var rows = gObj.getAllDataRows(true);\n        var dataObjects = gObj.getRowsObject().filter(function (row) { return !row.isDetailRow; });\n        for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n            if (rows[parseInt(i.toString(), 10)].classList.contains(literals.row) && !rows[parseInt(i.toString(), 10)].classList.contains('e-hiddenrow')) {\n                rows[parseInt(i.toString(), 10)].setAttribute(literals.ariaRowIndex, (j + 1).toString());\n                dataObjects[parseInt(i.toString(), 10)].index = j;\n                j++;\n            }\n            else {\n                rows[parseInt(i.toString(), 10)].removeAttribute(literals.ariaRowIndex);\n                dataObjects[parseInt(i.toString(), 10)].index = -1;\n            }\n        }\n    };\n    BatchEdit.prototype.bulkAddRow = function (data) {\n        var _this = this;\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowAdding) {\n            if (gObj.isEdit) {\n                this.saveCell();\n            }\n            return;\n        }\n        if (gObj.isEdit) {\n            this.saveCell();\n            this.parent.notify(events.editNextValCell, {});\n        }\n        if (this.validateFormObj()) {\n            return;\n        }\n        if (this.initialRender) {\n            var visibleColumns = gObj.getVisibleColumns();\n            for (var i = 0; i < visibleColumns.length; i++) {\n                if (visibleColumns[parseInt(i.toString(), 10)].validationRules &&\n                    visibleColumns[parseInt(i.toString(), 10)].validationRules['required']) {\n                    var obj = { field: (visibleColumns[parseInt(i.toString(), 10)]['field']).slice(), cellIdx: i };\n                    this.validationColObj.push(obj);\n                }\n            }\n            this.initialRender = false;\n        }\n        this.parent.element.classList.add('e-editing');\n        var defaultData = data ? data : this.getDefaultData();\n        var args = {\n            defaultData: defaultData,\n            primaryKey: gObj.getPrimaryKeyFieldNames(),\n            cancel: false\n        };\n        gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n            if (beforeBatchAddArgs.cancel) {\n                return;\n            }\n            _this.isAdded = true;\n            gObj.clearSelection();\n            var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n            var model = new RowModelGenerator(_this.parent);\n            var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n            var tr = row.render(modelData[0], gObj.getColumns());\n            addFixedColumnBorder(tr);\n            var col;\n            var index;\n            for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n                tr.insertBefore(_this.parent.createElement('td', { className: 'e-indentcell' }), tr.firstChild);\n                modelData[0].cells.unshift(new Cell({ cellType: CellType.Indent }));\n            }\n            var tbody = gObj.getContentTable().querySelector(literals.tbody);\n            tr.classList.add('e-insertedrow');\n            if (tbody.querySelector('.e-emptyrow')) {\n                var emptyRow = tbody.querySelector('.e-emptyrow');\n                emptyRow.parentNode.removeChild(emptyRow);\n                if (gObj.frozenRows && gObj.element.querySelector('.e-frozenrow-empty')) {\n                    gObj.element.querySelector('.e-frozenrow-empty').classList.remove('e-frozenrow-empty');\n                }\n            }\n            if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                tbody = gObj.getHeaderTable().querySelector(literals.tbody);\n            }\n            else {\n                tbody = gObj.getContentTable().querySelector(literals.tbody);\n            }\n            if (_this.parent.editSettings.newRowPosition === 'Top') {\n                tbody.insertBefore(tr, tbody.firstChild);\n            }\n            else {\n                tbody.appendChild(tr);\n            }\n            addClass([].slice.call(tr.getElementsByClassName(literals.rowCell)), ['e-updatedtd']);\n            modelData[0].isDirty = true;\n            modelData[0].changes = extend({}, {}, modelData[0].data, true);\n            modelData[0].edit = 'add';\n            _this.addRowObject(modelData[0]);\n            _this.refreshRowIdx();\n            _this.focus.forgetPrevious();\n            gObj.notify(events.batchAdd, { rows: _this.parent.getRowsObject() });\n            var changes = _this.getBatchChanges();\n            var btmIdx = _this.getBottomIndex();\n            if (_this.parent.editSettings.newRowPosition === 'Top') {\n                gObj.selectRow(0);\n            }\n            else {\n                gObj.selectRow(btmIdx);\n            }\n            if (!data) {\n                index = _this.findNextEditableCell(0, true);\n                col = gObj.getColumns()[parseInt(index.toString(), 10)];\n                if (_this.parent.editSettings.newRowPosition === 'Top') {\n                    _this.editCell(0, col.field, true);\n                }\n                else {\n                    _this.editCell(btmIdx, col.field, true);\n                }\n            }\n            if (_this.parent.aggregates.length > 0 && (data || changes[literals.addedRecords].length)) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n            }\n            var args1 = {\n                defaultData: beforeBatchAddArgs.defaultData, row: tr,\n                columnObject: col, columnIndex: index, primaryKey: beforeBatchAddArgs.primaryKey,\n                cell: !isNullOrUndefined(index) ? tr.cells[parseInt(index.toString(), 10)] : undefined\n            };\n            gObj.trigger(events.batchAdd, args1);\n        });\n    };\n    BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n        var cols = this.parent.getColumns();\n        var endIndex = cols.length;\n        var validation;\n        for (var i = columnIndex; i < endIndex; i++) {\n            validation = isValOnly ? isNullOrUndefined(cols[parseInt(i.toString(), 10)].validationRules) : false;\n            // if (!isAdd && this.checkNPCell(cols[parseInt(i.toString(), 10)])) {\n            //     return i;\n            // } else\n            if (isAdd && (!cols[parseInt(i.toString(), 10)].template || cols[parseInt(i.toString(), 10)].field)\n                && cols[parseInt(i.toString(), 10)].allowEditing && cols[parseInt(i.toString(), 10)].visible &&\n                !(cols[parseInt(i.toString(), 10)].isIdentity && cols[parseInt(i.toString(), 10)].isPrimaryKey) && !validation) {\n                return i;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.getDefaultData = function () {\n        var gObj = this.parent;\n        var data = {};\n        var dValues = { 'number': 0, 'string': null, 'boolean': false, 'date': null, 'datetime': null, 'dateonly': null };\n        for (var _i = 0, _a = (gObj.columnModel); _i < _a.length; _i++) {\n            var col = _a[_i];\n            if (col.field) {\n                setValue(col.field, Object.keys(col).indexOf('defaultValue') >= 0 ? col.defaultValue : dValues[col.type], data);\n            }\n        }\n        return data;\n    };\n    BatchEdit.prototype.setCellIdx = function (target) {\n        var gLen = 0;\n        if (this.parent.allowGrouping) {\n            gLen = this.parent.groupSettings.columns.length;\n        }\n        this.cellDetails.cellIndex = target.cellIndex - gLen;\n        this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n    };\n    BatchEdit.prototype.editCell = function (index, field, isAdd) {\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        this.index = index;\n        this.field = field;\n        this.isAdd = isAdd;\n        var visibleRows = gObj.getDataRows();\n        visibleRows = visibleRows.filter(function (row) { return row.style.display !== 'none' && !row.classList.contains('e-childrow-hidden'); });\n        var lastRowIndex = parseInt(visibleRows[visibleRows.length - 1].getAttribute('aria-rowindex'), 10) - 1;\n        var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field\n            && (this.cellDetails.rowIndex === index && lastRowIndex !== index && this.prevEditedBatchCell));\n        if (gObj.editSettings.allowEditing) {\n            if (!checkEdit && (col.allowEditing || (!col.allowEditing && gObj.focusModule.active\n                && gObj.focusModule.active.getTable().rows[this.crtRowIndex]\n                && gObj.focusModule.active.getTable().rows[this.crtRowIndex].classList.contains('e-insertedrow')))) {\n                this.editCellExtend(index, field, isAdd);\n            }\n            else if (checkEdit) {\n                this.editNext = true;\n                this.saveCell();\n            }\n        }\n    };\n    BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n        var _this = this;\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var keys = gObj.getPrimaryKeyFieldNames();\n        if (gObj.isEdit) {\n            return;\n        }\n        var rowData = extend({}, {}, this.getDataByIndex(index), true);\n        var row = gObj.getDataRows()[parseInt(index.toString(), 10)];\n        rowData = extend({}, {}, this.getDataByIndex(index), true);\n        if ((keys[0] === col.field && !row.classList.contains('e-insertedrow')) || col.columns ||\n            (col.isPrimaryKey && col.isIdentity) || col.commands) {\n            this.parent.isLastCellPrimaryKey = true;\n            return;\n        }\n        this.parent.isLastCellPrimaryKey = false;\n        this.parent.element.classList.add('e-editing');\n        var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n        var cells = [].slice.apply(row.cells);\n        var args = {\n            columnName: col.field, isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n            primaryKey: keys, rowData: rowData,\n            validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n            value: getObject(col.field, rowData),\n            type: !isAdd ? 'edit' : 'add', cancel: false,\n            foreignKeyData: rowObj && rowObj.foreignKeyData\n        };\n        args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n        args.row = row;\n        args.columnObject = col;\n        if (!args.cell) {\n            return;\n        }\n        gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n            if (cellEditArgs.cancel) {\n                return;\n            }\n            cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n            cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n            cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n            // cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n            _this.cellDetails = {\n                rowData: rowData, column: col, value: cellEditArgs.value, isForeignKey: cellEditArgs.isForeignKey, rowIndex: index,\n                cellIndex: parseInt(cellEditArgs.cell.getAttribute(literals.ariaColIndex), 10) - 1,\n                foreignKeyData: cellEditArgs.foreignKeyData\n            };\n            if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n                _this.isColored = true;\n                cellEditArgs.cell.classList.remove('e-updatedtd');\n            }\n            gObj.isEdit = true;\n            var checkSelect = !isNullOrUndefined(cellEditArgs.row.querySelector('.e-selectionbackground')) ? true : false;\n            gObj.clearSelection();\n            if ((!gObj.isCheckBoxSelection || !gObj.isPersistSelection) && (checkSelect || !gObj.selectionSettings.checkboxOnly)) {\n                gObj.selectRow(_this.cellDetails.rowIndex, true);\n            }\n            _this.renderer.update(cellEditArgs);\n            _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n            _this.form = select('#' + gObj.element.id + 'EditForm', gObj.element);\n            gObj.editModule.applyFormValidation([col]);\n            _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n        });\n    };\n    BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var index = gObj.getColumnIndexByField(field);\n        var isInsertedBatchRow = gObj.getRowByIndex(rowIndex).classList.contains('e-insertedrow') &&\n            gObj.getRowByIndex(rowIndex).classList.contains('e-batchrow');\n        if (col && (!col.isPrimaryKey || isInsertedBatchRow) && col.allowEditing) {\n            var td_1 = this.parent.isSpan ? getCellFromRow(gObj, rowIndex, index) :\n                getCellByColAndRowIndex(this.parent, col, rowIndex, index);\n            if (this.parent.isSpan && !td_1) {\n                return;\n            }\n            var rowObj_1 = gObj.getRowObjectFromUID(td_1.parentElement.getAttribute('data-uid'));\n            if (gObj.isEdit ||\n                (!rowObj_1.changes && ((!(value instanceof Date) && rowObj_1.data['' + field] !== value) ||\n                    ((value instanceof Date) && new Date(rowObj_1.data['' + field]).toString() !== new Date(value).toString()))) ||\n                (rowObj_1.changes && ((!(value instanceof Date) && rowObj_1.changes['' + field] !== value) ||\n                    ((value instanceof Date) && new Date(rowObj_1.changes['' + field]).toString() !== new Date(value).toString())))) {\n                this.refreshTD(td_1, col, rowObj_1, value);\n                var isReactChild = this.parent.parentDetails && this.parent.parentDetails.parentInstObj &&\n                    this.parent.parentDetails.parentInstObj.isReact;\n                if (((this.parent.isReact && this.parent.requireTemplateRef) || (isReactChild &&\n                    this.parent.parentDetails.parentInstObj.requireTemplateRef)) && col.template) {\n                    // eslint-disable-next-line @typescript-eslint/no-this-alias\n                    var thisRef_1 = this;\n                    var newReactTd_1 = this.newReactTd;\n                    thisRef_1.parent.renderTemplates(function () {\n                        thisRef_1.parent.trigger(events.queryCellInfo, {\n                            cell: newReactTd_1 || td_1, column: col, data: rowObj_1.changes\n                        });\n                    });\n                }\n                else if ((this.parent.isReact || isReactChild) && col.template) {\n                    this.parent.renderTemplates();\n                    this.parent.trigger(events.queryCellInfo, {\n                        cell: this.newReactTd || td_1, column: col, data: rowObj_1.changes\n                    });\n                }\n                else {\n                    this.parent.trigger(events.queryCellInfo, {\n                        cell: this.newReactTd || td_1, column: col, data: rowObj_1.changes\n                    });\n                }\n            }\n        }\n    };\n    BatchEdit.prototype.setChanges = function (rowObj, field, value) {\n        if (!rowObj.changes) {\n            rowObj.changes = extend({}, {}, rowObj.data, true);\n        }\n        if (!isNullOrUndefined(field)) {\n            if (typeof value === 'string') {\n                value = this.parent.sanitize(value);\n            }\n            DataUtil.setValue(field, value, rowObj.changes);\n        }\n        if (rowObj.data[\"\" + field] !== value) {\n            var type = this.parent.getColumnByField(field).type;\n            if ((type === 'date' || type === 'datetime')) {\n                if (new Date(rowObj.data[\"\" + field]).toString() !== new Date(value).toString()) {\n                    rowObj.isDirty = true;\n                }\n            }\n            else {\n                rowObj.isDirty = true;\n            }\n        }\n    };\n    BatchEdit.prototype.updateRow = function (index, data) {\n        var keys = Object.keys(data);\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var col = keys_1[_i];\n            this.updateCell(index, col, data[\"\" + col]);\n        }\n    };\n    BatchEdit.prototype.getCellIdx = function (uid) {\n        var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        return cIdx;\n    };\n    BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n        var cell = new CellRenderer(this.parent, this.serviceLocator);\n        value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n        if (rowObj) {\n            this.setChanges(rowObj, column.field, value);\n            refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n        }\n        var rowcell = rowObj ? rowObj.cells : undefined;\n        var parentElement;\n        var cellIndex;\n        if (this.parent.isReact) {\n            parentElement = td.parentElement;\n            cellIndex = td.cellIndex;\n        }\n        var index = 0;\n        if (rowObj) {\n            cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - index], rowObj.changes, { 'index': this.getCellIdx(column.uid) });\n        }\n        if (this.parent.isReact) {\n            this.newReactTd = parentElement.cells[parseInt(cellIndex.toString(), 10)];\n            parentElement.cells[parseInt(cellIndex.toString(), 10)].classList.add('e-updatedtd');\n        }\n        else {\n            td.classList.add('e-updatedtd');\n        }\n        td.classList.add('e-updatedtd');\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    BatchEdit.prototype.getColIndex = function (cells, index) {\n        var cIdx = 0;\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n            cIdx = this.parent.groupSettings.columns.length;\n        }\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        for (var m = 0; m < cells.length; m++) {\n            var colIndex = parseInt(cells[parseInt(m.toString(), 10)].getAttribute(literals.ariaColIndex), 10) - 1;\n            if (colIndex === index - cIdx) {\n                return m;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.editNextValCell = function () {\n        var gObj = this.parent;\n        var insertedRows = gObj.element.querySelectorAll('.e-insertedrow');\n        var isSingleInsert = insertedRows.length === 1 ? true : false;\n        if (isSingleInsert && this.isAdded && !gObj.isEdit) {\n            var btmIdx = this.getBottomIndex();\n            for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n                if (gObj.isEdit) {\n                    return;\n                }\n                var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n                var col = gObj.getColumns()[parseInt(index.toString(), 10)];\n                if (col) {\n                    if (this.parent.editSettings.newRowPosition === 'Bottom') {\n                        this.editCell(btmIdx, col.field, true);\n                    }\n                    else {\n                        var args = { index: 0, column: col };\n                        this.parent.notify(events.nextCellIndex, args);\n                        this.editCell(args.index, col.field, true);\n                    }\n                    this.saveCell();\n                }\n            }\n            if (!gObj.isEdit) {\n                this.isAdded = false;\n            }\n        }\n        else if (!isSingleInsert && this.isAdded && !gObj.isEdit) {\n            for (var i = 0; i < insertedRows.length; i++) {\n                if (!gObj.isEdit) {\n                    for (var j = 0; j < this.validationColObj.length; j++) {\n                        if (gObj.isEdit) {\n                            break;\n                        }\n                        else if (insertedRows[parseInt(i.toString(), 10)].querySelectorAll('td:not(.e-hide, .e-rowdragdrop, .e-detailrowcollapse, .e-detailrowexpand, .e-indentcell)')[this.validationColObj[parseInt(j.toString(), 10)].cellIdx].innerHTML === '') {\n                            this.editCell(parseInt(insertedRows[parseInt(i.toString(), 10)].getAttribute('aria-rowindex'), 10) - 1, this.validationColObj[parseInt(j.toString(), 10)].field);\n                            if (this.validateFormObj()) {\n                                this.saveCell();\n                            }\n                        }\n                    }\n                }\n                else {\n                    break;\n                }\n            }\n            if (!gObj.isEdit) {\n                this.isAdded = false;\n            }\n        }\n    };\n    BatchEdit.prototype.escapeCellEdit = function () {\n        var args = this.generateCellArgs();\n        args.value = args.previousValue;\n        if (args.value || !this.cellDetails.column.validationRules) {\n            this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n        }\n    };\n    BatchEdit.prototype.generateCellArgs = function () {\n        var gObj = this.parent;\n        this.parent.element.classList.remove('e-editing');\n        var column = this.cellDetails.column;\n        var obj = {};\n        obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n        var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n        var cloneEditedData = extend({}, editedData);\n        editedData = extend({}, editedData, this.cellDetails.rowData);\n        var value = getObject(column.field, cloneEditedData);\n        if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n            setValue(column.field, value, editedData);\n        }\n        var args = {\n            columnName: column.field,\n            value: getObject(column.field, editedData),\n            rowData: this.cellDetails.rowData,\n            column: column,\n            previousValue: this.cellDetails.value,\n            isForeignKey: this.cellDetails.isForeignKey,\n            cancel: false\n        };\n        args.cell = this.form.parentElement;\n        args.columnObject = column;\n        return args;\n    };\n    BatchEdit.prototype.saveCell = function (isForceSave) {\n        if (this.preventSaveCell || !this.form) {\n            return;\n        }\n        var gObj = this.parent;\n        if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n            return;\n        }\n        this.preventSaveCell = true;\n        var args = this.generateCellArgs();\n        var tr = args.cell.parentElement;\n        var col = args.column;\n        args.cell.removeAttribute('aria-label');\n        if (!isForceSave) {\n            gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n            gObj.notify(events.batchForm, { formObj: this.form });\n        }\n        else {\n            this.successCallBack(args, tr, col)(args);\n        }\n    };\n    BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n        var _this = this;\n        return function (cellSaveArgs) {\n            var gObj = _this.parent;\n            cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n            cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n            // cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n            if (cellSaveArgs.cancel) {\n                _this.preventSaveCell = false;\n                if (_this.editNext) {\n                    _this.editNext = false;\n                    if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                        return;\n                    }\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n                return;\n            }\n            gObj.editModule.destroyWidgets([column]);\n            gObj.isEdit = false;\n            gObj.editModule.destroyForm();\n            _this.parent.notify(events.tooltipDestroy, {});\n            var rowObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n            _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n            if (_this.parent.isReact) {\n                cellSaveArgs.cell = _this.newReactTd;\n            }\n            removeClass([tr], [literals.editedRow, 'e-batchrow']);\n            removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n            if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() ===\n                (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored\n                || (isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(rowObj.data[column.field]) &&\n                    isNullOrUndefined(_this.cellDetails.value) && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow'))) {\n                cellSaveArgs.cell.classList.remove('e-updatedtd');\n            }\n            if (isNullOrUndefined(isEscapeCellEdit)) {\n                var isReactCompiler = gObj.isReact && column.template && typeof (column.template) !== 'string';\n                var isReactChild = gObj.parentDetails && gObj.parentDetails.parentInstObj\n                    && gObj.parentDetails.parentInstObj.isReact;\n                if (isReactCompiler || isReactChild) {\n                    if (gObj.requireTemplateRef) {\n                        gObj.renderTemplates(function () {\n                            gObj.trigger(events.cellSaved, cellSaveArgs);\n                        });\n                    }\n                    else {\n                        gObj.renderTemplates();\n                        gObj.trigger(events.cellSaved, cellSaveArgs);\n                    }\n                }\n                else {\n                    gObj.trigger(events.cellSaved, cellSaveArgs);\n                }\n            }\n            gObj.notify(events.toolbarRefresh, {});\n            _this.isColored = false;\n            if (_this.parent.aggregates.length > 0) {\n                if (!(_this.parent.isReact || _this.parent.isVue)) {\n                    _this.parent.notify(events.refreshFooterRenderer, {});\n                }\n                if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n                    _this.parent.notify(events.groupAggregates, {});\n                }\n                if (_this.parent.isReact || _this.parent.isVue) {\n                    _this.parent.notify(events.refreshFooterRenderer, {});\n                }\n            }\n            _this.preventSaveCell = false;\n            if (_this.editNext) {\n                _this.editNext = false;\n                if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field && _this.prevEditedBatchCell) {\n                    return;\n                }\n                var col = gObj.getColumnByField(_this.field);\n                if (col && (col.allowEditing || (!col.allowEditing && gObj.focusModule.active\n                    && gObj.focusModule.active.getTable().rows[_this.crtRowIndex]\n                    && gObj.focusModule.active.getTable().rows[_this.crtRowIndex].classList.contains('e-insertedrow')))) {\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n            }\n            if (isEscapeCellEdit) {\n                gObj.notify(events.restoreFocus, {});\n            }\n        };\n    };\n    BatchEdit.prototype.prevEditedBatchCellMatrix = function () {\n        var editedBatchCellMatrix = [];\n        var gObj = this.parent;\n        var editedBatchCell = gObj.focusModule.active.getTable().querySelector('.e-editedbatchcell');\n        if (editedBatchCell) {\n            var tr = editedBatchCell.parentElement;\n            var rowIndex = [].slice.call(this.parent.focusModule.active.getTable().rows).indexOf(tr);\n            var cellIndex = [].slice.call(tr.cells).indexOf(editedBatchCell);\n            editedBatchCellMatrix = [rowIndex, cellIndex];\n        }\n        return editedBatchCellMatrix;\n    };\n    BatchEdit.prototype.getDataByIndex = function (index) {\n        var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[parseInt(index.toString(), 10)].getAttribute('data-uid'));\n        return row.changes ? row.changes : row.data;\n    };\n    BatchEdit.prototype.keyDownHandler = function (e) {\n        if (this.addBatchRow || ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit)) {\n            var gObj = this.parent;\n            var btmIdx = this.getBottomIndex();\n            var rowcell = parentsUntil(e.target, literals.rowCell);\n            if (this.addBatchRow || (rowcell && !this.parent.isReact)) {\n                var cell = void 0;\n                if (rowcell) {\n                    cell = rowcell.querySelector('.e-field');\n                }\n                if (this.addBatchRow || cell) {\n                    var visibleColumns = this.parent.getVisibleColumns();\n                    var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n                    if (this.addBatchRow\n                        || visibleColumns[parseInt(columnIndex.toString(), 10)].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n                        if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n                            if (gObj.editSettings.newRowPosition === 'Top') {\n                                gObj.editSettings.newRowPosition = 'Bottom';\n                                this.addRecord();\n                                gObj.editSettings.newRowPosition = 'Top';\n                            }\n                            else {\n                                this.addRecord();\n                            }\n                            this.addBatchRow = false;\n                        }\n                        else {\n                            this.saveCell();\n                        }\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.addCancelWhilePaging = function () {\n        if (this.validateFormObj()) {\n            this.parent.notify(events.destroyForm, {});\n            this.parent.isEdit = false;\n            this.editNext = false;\n            this.mouseDownElement = undefined;\n            this.isColored = false;\n        }\n    };\n    BatchEdit.prototype.getBottomIndex = function () {\n        var changes = this.getBatchChanges();\n        return this.parent.getCurrentViewRecords().length + changes[literals.addedRecords].length -\n            changes[literals.deletedRecords].length - 1;\n    };\n    return BatchEdit;\n}());\nexport { BatchEdit };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}