{"ast":null,"code":"import { Draggable, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList, extend } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport { resetRowIndex, resetCachedRowIndex, groupReorderRowObject } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport * as literals from '../base/string-literals';\n// eslint-disable-next-line valid-jsdoc, jsdoc/require-param, jsdoc/require-returns\n/**\n *\n * Reorder module is used to handle row reordering.\n *\n * @hidden\n */\nvar RowDD = /** @class */function () {\n  /**\n   * Constructor for the Grid print module\n   *\n   * @param {IGrid} parent - specifies the IGrid\n   * @hidden\n   */\n  function RowDD(parent) {\n    var _this = this;\n    this.selectedRows = [];\n    this.isOverflowBorder = true;\n    this.selectedRowColls = [];\n    this.isRefresh = true;\n    this.isReplaceDragEle = true;\n    this.istargetGrid = false;\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = _this.draggable.currentStateTarget;\n      if (!isNullOrUndefined(target) && gObj.rowDropSettings.targetID && !isNullOrUndefined(target.classList) && !target.classList.contains('e-rowcell')) {\n        target = parentsUntil(target, 'e-rowcell');\n      }\n      var visualElement = _this.parent.createElement('div', {\n        className: 'e-cloneproperties e-draganddrop e-grid e-dragclone'\n      });\n      visualElement.style.height = 'auto';\n      var table = _this.parent.createElement('table', {\n        attrs: {\n          role: 'grid'\n        }\n      });\n      var tbody = _this.parent.createElement(literals.tbody, {\n        attrs: {\n          role: 'rowgroup'\n        }\n      });\n      if (document.getElementsByClassName('e-griddragarea').length || gObj.rowDropSettings.targetID && (!isNullOrUndefined(target) && !target.classList.contains('e-selectionbackground') && gObj.selectionSettings.type !== 'Single' || !parentsUntil(target, 'e-rowcell')) || !gObj.rowDropSettings.targetID && !parentsUntil(target, 'e-rowdragdrop')) {\n        return false;\n      }\n      if (gObj.rowDropSettings.targetID && gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n        gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute(literals.ariaRowIndex), 10) - 1);\n      }\n      _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n      if (_this.parent.isFrozenGrid()) {\n        var nodes = [].slice.call(_this.startedRow.querySelectorAll('.e-rowcell'));\n        for (var i = 0; i < nodes.length; i++) {\n          removeClass([nodes[parseInt(i.toString(), 10)]], ['e-leftfreeze', 'e-freezeleftborder', 'e-fixedfreeze', 'e-freezerightborder', 'e-rightfreeze', 'e-unfreeze']);\n          nodes[parseInt(i.toString(), 10)].removeAttribute('style');\n        }\n      }\n      _this.processArgs(target);\n      var args = {\n        selectedRow: _this.rows,\n        dragelement: target,\n        cloneElement: visualElement,\n        cancel: false,\n        data: _this.rowData\n      };\n      var selectedRows = gObj.getSelectedRows();\n      gObj.trigger(events.rowDragStartHelper, args);\n      var cancel = 'cancel';\n      if (args[\"\" + cancel]) {\n        return false;\n      }\n      removeElement(_this.startedRow, '.e-indentcell');\n      removeElement(_this.startedRow, '.e-detailrowcollapse');\n      removeElement(_this.startedRow, '.e-detailrowexpand');\n      if (!(gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache)) {\n        _this.removeCell(_this.startedRow, literals.gridChkBox);\n      }\n      var activeCells = _this.startedRow.querySelectorAll('.e-active');\n      activeCells.forEach(function (cell) {\n        return cell.classList.remove('e-active');\n      });\n      tbody.appendChild(_this.startedRow);\n      if (gObj.getSelectedRowIndexes().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n        var dropCountEle = _this.parent.createElement('span', {\n          className: 'e-dropitemscount',\n          innerHTML: '' + selectedRows.length\n        });\n        visualElement.appendChild(dropCountEle);\n      }\n      var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n      if (ele) {\n        ele.classList.add('e-dragstartrow');\n      }\n      table.appendChild(tbody);\n      visualElement.appendChild(table);\n      gObj.element.appendChild(visualElement);\n      return visualElement;\n    };\n    this.dragStart = function (e) {\n      var gObj = _this.parent;\n      if ((gObj.enableVirtualization || gObj.infiniteScrollSettings.enableCache) && gObj.allowGrouping && gObj.groupSettings.columns.length && !isNullOrUndefined(e.target.closest('tr'))) {\n        var dragTrs = e.dragElement.querySelectorAll('tr');\n        var indentCells = e.target.closest('tr').querySelectorAll('.e-indentcell');\n        for (var i = 0; i < dragTrs.length; i++) {\n          for (var j = 0; j < indentCells.length; j++) {\n            var cloneIndentCell = indentCells[parseInt(j.toString(), 10)].cloneNode(true);\n            dragTrs[parseInt(i.toString(), 10)].insertBefore(cloneIndentCell, dragTrs[parseInt(i.toString(), 10)].firstElementChild);\n          }\n        }\n      }\n      if (gObj.element.classList.contains('e-childgrid')) {\n        var parentGrid = _this.getParentGrid(gObj.element);\n        parentGrid.appendChild(e.dragElement);\n        gObj.element.appendChild(gObj.createElement('div', {\n          className: 'e-drag-ref'\n        }));\n      }\n      document.body.classList.add('e-prevent-select');\n      if (document.getElementsByClassName('e-griddragarea').length) {\n        return;\n      }\n      var target = e.target;\n      var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n      if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n        spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table').offsetWidth - 5 + 'px';\n      }\n      _this.processArgs(target);\n      gObj.trigger(events.rowDragStart, {\n        rows: _this.rows,\n        target: e.target,\n        draggableType: 'rows',\n        fromIndex: parseInt(_this.rows[0].getAttribute(literals.ariaRowIndex), 10) - 1,\n        data: _this.rowData[0] && Object.keys(_this.rowData[0]).length > 0 ? _this.rowData : _this.currentViewData()\n      });\n      _this.dragStartData = _this.rowData;\n      var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n      if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances && dropElem.ej2_instances[0].getModuleName() === 'grid') {\n        dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n      }\n    };\n    this.drag = function (e) {\n      var gObj = _this.parent;\n      _this.isDropGrid = _this.parent;\n      _this.istargetGrid = false;\n      if (_this.parent.rowDropSettings.targetID) {\n        var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n        _this.isDropGrid = dropElement.ej2_instances[0];\n        if (parentsUntil(e.target, 'e-grid')) {\n          _this.istargetGrid = _this.parent.rowDropSettings.targetID === parentsUntil(e.target, 'e-grid').id;\n        }\n      }\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n      if (gObj.element.classList.contains('e-childgrid')) {\n        var parentGrid = _this.getParentGrid(gObj.element);\n        cloneElement = parentGrid.querySelector('.e-cloneproperties');\n      }\n      var target = _this.getElementFromPosition(cloneElement, e.event);\n      classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur', 'e-grabcur']);\n      _this.isOverflowBorder = true;\n      _this.hoverState = gObj.enableHover;\n      var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n      if (!e.target) {\n        return;\n      }\n      _this.processArgs(target);\n      if (gObj.enableVirtualization && isNullOrUndefined(_this.rows[0])) {\n        classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n      }\n      var args = {\n        rows: _this.rows,\n        target: target,\n        draggableType: 'rows',\n        data: _this.rowData,\n        originalEvent: e,\n        cancel: false\n      };\n      gObj.trigger(events.rowDrag, args);\n      _this.stopTimer();\n      if (args.cancel) {\n        return;\n      }\n      gObj.element.classList.add('e-rowdrag');\n      if (trElement && (parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id || parentsUntil(target, 'e-grid').id)) {\n        if (_this.isDropGrid.element.querySelector('.e-emptyrow')) {\n          _this.dragTarget = 0;\n        } else {\n          _this.dragTarget = parseInt(trElement.getAttribute('aria-rowindex'), 10) - 1;\n        }\n      } else {\n        _this.dragTarget = parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) - 1;\n      }\n      if (gObj.rowDropSettings.targetID) {\n        var dragParentElement = document.querySelector('.e-drag-ref');\n        if (!parentsUntil(target, 'e-grid') || dragParentElement && parentsUntil(dragParentElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id || parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n          classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-grabcur'], ['e-notallowedcur']);\n        }\n      } else {\n        var element = parentsUntil(target, 'e-grid');\n        if (element && element.id === cloneElement.parentElement.id && parentsUntil(target, 'e-row') && !parentsUntil(target, 'e-addedrow')) {\n          classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n        }\n      }\n      if (parentsUntil(_this.isDropGrid.element, 'e-grid')) {\n        if ((!_this.isDropGrid.groupSettings.columns.length || _this.isDropGrid.groupSettings.columns.length) && !_this.isDropGrid.element.querySelector('.e-emptyrow')) {\n          if (parentsUntil(target, 'e-grid') && parentsUntil(target, 'e-grid').id === _this.isDropGrid.element.id) {\n            _this.updateScrollPostion(e.event);\n          }\n          if ((_this.isOverflowBorder || _this.parent.frozenRows > _this.dragTarget) && (parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10) - 1 !== _this.dragTarget || _this.istargetGrid) || _this.istargetGrid && trElement && _this.isDropGrid.getRowByIndex(_this.isDropGrid.getCurrentViewRecords().length - 1).getAttribute('data-uid') === trElement.getAttribute('data-uid')) {\n            _this.moveDragRows(e, _this.startedRow, trElement);\n          } else {\n            var islastRowIndex = void 0;\n            if (_this.parent.enableVirtualization) {\n              islastRowIndex = trElement && parseInt(trElement.getAttribute(literals.ariaRowIndex), 10) - 1 === _this.parent.renderModule.data.dataManager.dataSource.json.length - 1;\n            } else {\n              var rowIndex = _this.parent.enableInfiniteScrolling && _this.parent.infiniteScrollSettings.enableCache && !_this.parent.groupSettings.enableLazyLoading ? _this.parent.pageSettings.currentPage * _this.parent.pageSettings.pageSize - 1 : _this.parent.getCurrentViewRecords().length - 1;\n              var lastRow = _this.parent.getRowByIndex(rowIndex);\n              islastRowIndex = trElement && lastRow && lastRow.getAttribute('data-uid') === trElement.getAttribute('data-uid') && lastRow.getAttribute('data-uid') !== _this.startedRow.getAttribute('data-uid');\n              if (_this.isNewRowAdded() && _this.parent.editSettings.newRowPosition === 'Bottom') {\n                islastRowIndex = false;\n              }\n            }\n            if (islastRowIndex && !_this.parent.rowDropSettings.targetID) {\n              var bottomborder = _this.parent.createElement('div', {\n                className: 'e-lastrow-dragborder'\n              });\n              var gridcontentEle = _this.parent.getContent();\n              bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n              if (_this.parent.enableVirtualization) {\n                bottomborder.style.zIndex = '1';\n              }\n              if (!gridcontentEle.getElementsByClassName('e-lastrow-dragborder').length && (!(gObj.allowGrouping && gObj.groupSettings.columns.length) || isNullOrUndefined(trElement.nextSibling))) {\n                gridcontentEle.classList.add('e-grid-relative');\n                gridcontentEle.appendChild(bottomborder);\n                bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n              }\n            }\n            _this.removeBorder(trElement);\n          }\n        }\n        if (target && target.classList.contains(literals.content) && !_this.isDropGrid.element.querySelector('.e-emptyrow') && _this.istargetGrid) {\n          _this.removeBorder(trElement);\n          var rowIndex = _this.isDropGrid.getCurrentViewRecords().length - 1;\n          var selector = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n          var groupSelector = '.e-rowcell:not(.e-hide),.e-rowdragdrop:not(.e-hide),.e-detailrowcollapse:not(.e-hide)';\n          var rowElement = [];\n          if (_this.parent.allowGrouping && _this.parent.groupSettings.columns && _this.parent.groupSettings.columns.length) {\n            rowElement = [].slice.call(_this.isDropGrid.getRowByIndex(rowIndex).querySelectorAll(groupSelector));\n          } else {\n            rowElement = [].slice.call(_this.isDropGrid.getRowByIndex(rowIndex).querySelectorAll(selector));\n          }\n          if (rowElement.length > 0) {\n            if (_this.parent.allowGrouping && _this.parent.groupSettings.columns && _this.parent.groupSettings.columns.length) {\n              _this.groupRowDDIndicator(rowElement, true);\n            } else {\n              addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n            }\n          }\n        }\n      }\n    };\n    this.dragStop = function (e) {\n      if (_this.parent.isCheckBoxSelection && _this.parent.enableInfiniteScrolling) {\n        window.getSelection().removeAllRanges();\n      }\n      document.body.classList.remove('e-prevent-select');\n      if (isActionPrevent(_this.parent)) {\n        _this.parent.notify(events.preventBatch, {\n          instance: _this,\n          handler: _this.processDragStop,\n          arg1: e\n        });\n      } else {\n        _this.processDragStop(e);\n      }\n    };\n    this.processDragStop = function (e) {\n      var gObj = _this.parent;\n      if (_this.parent.isDestroyed) {\n        return;\n      }\n      var targetEle = _this.getElementFromPosition(e.helper, e.event);\n      var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ? targetEle : e.target;\n      gObj.element.classList.remove('e-rowdrag');\n      var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n      if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances && dropElement.ej2_instances[0].getModuleName() === 'grid') {\n        dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n      }\n      if (parentsUntil(_this.isDropGrid.element, 'e-grid')) {\n        _this.stopTimer();\n        _this.isDropGrid.enableHover = _this.hoverState;\n        _this.isDropGrid.getContent().classList.remove('e-grid-relative');\n        _this.removeBorder(targetEle);\n        var stRow = _this.isDropGrid.element.querySelector('.e-dragstartrow');\n        if (stRow) {\n          stRow.classList.remove('e-dragstartrow');\n        }\n      }\n      _this.processArgs(target);\n      if (gObj.enableVirtualization && isNullOrUndefined(_this.rows[0])) {\n        return;\n      }\n      var args = {\n        target: target,\n        draggableType: 'rows',\n        cancel: false,\n        fromIndex: parseInt(_this.rows[0].getAttribute(literals.ariaRowIndex), 10) - 1,\n        dropIndex: _this.dragTarget,\n        rows: _this.rows,\n        data: Object.keys(_this.dragStartData[0]).length > 0 ? _this.dragStartData : _this.currentViewData()\n      };\n      gObj.trigger(events.rowDrop, args, function () {\n        if (!(parentsUntil(target, literals.row) || parentsUntil(target, 'e-emptyrow') || parentsUntil(target, literals.gridContent)) || args.cancel) {\n          _this.dragTarget = null;\n          remove(e.helper);\n          return;\n        }\n        _this.isRefresh = false;\n        var selectedIndexes = _this.parent.getSelectedRowIndexes();\n        if (gObj.isRowDragable()) {\n          if (!_this.parent.rowDropSettings.targetID && _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 && selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n            _this.reorderRows(selectedIndexes, args.dropIndex);\n          } else {\n            _this.reorderRows([parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10) - 1], _this.dragTarget);\n          }\n          _this.dragTarget = null;\n          if (!gObj.rowDropSettings.targetID) {\n            if (e.helper.classList.contains('e-cloneproperties') && document.querySelector('.' + e.helper.classList[0])) {\n              remove(e.helper);\n            }\n            if (gObj.enableVirtualization && !gObj.sortSettings.columns.length && !gObj.filterSettings.columns.length && (!_this.parent.allowGrouping || !gObj.groupSettings.columns.length)) {\n              gObj.refresh();\n              gObj.contentModule.vgenerator.startIndex = null;\n            } else {\n              _this.rowOrder(args);\n            }\n          }\n          if (_this.parent.getContentTable().scrollHeight < _this.parent.getContent().clientHeight) {\n            _this.parent.scrollModule.setLastRowCell();\n          }\n        }\n        _this.isRefresh = true;\n      });\n    };\n    this.removeCell = function (targetRow, className) {\n      return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n        if (cell.classList.contains(className)) {\n          targetRow.deleteCell(cell.cellIndex);\n        }\n      });\n    };\n    this.parent = parent;\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.on(events.initialEnd, this.initializeDrag, this);\n    this.parent.on(events.columnDrop, this.columnDrop, this);\n    this.parent.on(events.rowDragAndDropComplete, this.onActionComplete, this);\n    this.onDataBoundFn = this.onDataBound.bind(this);\n    this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    this.parent.on(events.destroy, this.destroy, this);\n  }\n  RowDD.prototype.getParentGrid = function (childGrid) {\n    var parentGrid = childGrid;\n    var parentGridObtained = false;\n    while (!parentGridObtained) {\n      if (parentGrid.ej2_instances[0].parentDetails) {\n        parentGrid = document.getElementById(parentGrid.ej2_instances[0].parentDetails.parentID);\n      }\n      if (!parentGrid.classList.contains('e-childgrid')) {\n        parentGridObtained = true;\n      }\n    }\n    return parentGrid;\n  };\n  RowDD.prototype.isNewRowAdded = function () {\n    return this.parent.editSettings && this.parent.editSettings.showAddNewRow && !(this.parent.enableInfiniteScrolling || this.parent.enableVirtualization);\n  };\n  RowDD.prototype.groupRowDDIndicator = function (rowElement, isAdd) {\n    addRemoveActiveClasses([rowElement[0]], isAdd, 'e-dragleft');\n    addRemoveActiveClasses(rowElement, isAdd, 'e-dragtop', 'e-dragbottom');\n    addRemoveActiveClasses([rowElement[rowElement.length - 1]], isAdd, 'e-dragright');\n  };\n  RowDD.prototype.refreshRow = function (args, tbody, target) {\n    var gObj = this.parent;\n    var tbodyContent = gObj.getContentTable().querySelector(literals.tbody);\n    var tbodyHeader = gObj.getHeaderTable().querySelector(literals.tbody);\n    for (var i = 0, len = args.rows.length; i < len; i++) {\n      var row = args.rows[parseInt(i.toString(), 10)];\n      if ((gObj.enableVirtualization && gObj.allowGrouping && gObj.groupSettings.columns.length || gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache) && args.rows.length === 1) {\n        var removeElem = gObj.getRowElementByUID(row.getAttribute('data-uid'));\n        if (!isNullOrUndefined(removeElem)) {\n          remove(removeElem);\n        }\n      }\n      var dragstartrow = row.querySelector('.e-dragstartrow');\n      if (dragstartrow) {\n        dragstartrow.classList.remove('e-dragstartrow');\n      }\n      tbody.insertBefore(row, target);\n      if (gObj.allowGrouping && gObj.groupSettings.columns.length) {\n        var dragRowUid = row.getAttribute('data-uid');\n        var dropRowUid = args.target.parentElement.getAttribute('data-uid');\n        var dragRowObject = gObj.getRowObjectFromUID(dragRowUid);\n        var dropRowObject = gObj.getRowObjectFromUID(dropRowUid);\n        if (dragRowObject.parentUid !== dropRowObject.parentUid) {\n          gObj['groupModule'].groupReorderHandler(dragRowObject, dropRowObject);\n        }\n      }\n    }\n    var tr = [].slice.call(gObj.editSettings.showAddNewRow ? tbody.querySelectorAll('.e-row:not(.e-addedrow)') : tbody.getElementsByClassName(literals.row));\n    if (gObj.allowGrouping && gObj.groupSettings.columns.length) {\n      if (gObj.groupSettings.enableLazyLoading || gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache && tr.length > gObj.pageSettings.pageSize * 3) {\n        gObj.refresh();\n      } else {\n        groupReorderRowObject(this.parent, args, tr);\n        if (gObj.enableVirtualization || gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache) {\n          resetCachedRowIndex(gObj);\n        } else {\n          resetRowIndex(this.parent, gObj.getRowsObject().filter(function (data) {\n            return data.isDataRow;\n          }), tr);\n        }\n        this.parent.notify(events.refreshExpandandCollapse, {\n          rows: gObj.enableVirtualization ? this.parent.vRows : this.parent.getRowsObject()\n        });\n      }\n    } else if (gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache && !gObj.groupSettings.columns.length) {\n      if (tr.length > gObj.pageSettings.pageSize * 3) {\n        gObj.refresh();\n      } else {\n        groupReorderRowObject(this.parent, args, tr);\n        resetCachedRowIndex(gObj);\n      }\n    } else {\n      this.refreshData(tr);\n    }\n    if (this.parent.frozenRows) {\n      for (var i = 0, len = tr.length; i < len; i++) {\n        if (i < this.parent.frozenRows) {\n          tbodyHeader.appendChild(tr[parseInt(i.toString(), 10)]);\n        } else {\n          tbodyContent.appendChild(tr[parseInt(i.toString(), 10)]);\n        }\n      }\n    }\n  };\n  RowDD.prototype.updateFrozenRowreOrder = function (args) {\n    var gObj = this.parent;\n    var tbodyC = gObj.getContentTable().querySelector(literals.tbody);\n    var tbodyH = gObj.getHeaderTable().querySelector(literals.tbody);\n    var tr = [].slice.call(tbodyH.getElementsByClassName(literals.row)).concat([].slice.call(tbodyC.getElementsByClassName(literals.row)));\n    var tbody = gObj.createElement(literals.tbody, {\n      attrs: {\n        role: 'rowgroup'\n      }\n    });\n    if (!gObj.selectionSettings.persistSelection && Object.keys(gObj.selectionModule.selectedRowState).length === 0) {\n      this.parent.clearSelection();\n    } else {\n      this.parent.clearRowSelection();\n    }\n    var targetRow = this.refreshRowTarget(args);\n    for (var i = 0, len = tr.length; i < len; i++) {\n      tbody.appendChild(tr[parseInt(i.toString(), 10)]);\n    }\n    this.refreshRow(args, tbody, targetRow);\n  };\n  RowDD.prototype.refreshRowTarget = function (args) {\n    var gObj = this.parent;\n    var targetIdx = parseInt(args.target.parentElement.getAttribute(literals.ariaRowIndex), 10) - 1;\n    if (gObj.enableVirtualization && gObj.allowGrouping && gObj.groupSettings.columns.length) {\n      targetIdx = this.parent.getDataRows().indexOf(args.target.parentElement);\n    }\n    if ((args.fromIndex < args.dropIndex || args.fromIndex === args.dropIndex) && (!gObj.allowGrouping || !gObj.groupSettings.columns.length)) {\n      targetIdx = targetIdx + 1;\n    }\n    var targetTR = gObj.getRowByIndex(targetIdx);\n    if (targetIdx === gObj.getRows().length && this.isNewRowAdded() && this.parent.editSettings.newRowPosition === 'Bottom') {\n      targetTR = this.parent.element.querySelector('.e-row.e-addedrow');\n    }\n    var tr = gObj.allowGrouping && gObj.groupSettings.columns.length && targetIdx !== -1 && args.fromIndex < args.dropIndex && targetTR ? targetTR.nextSibling : targetTR;\n    return tr;\n  };\n  RowDD.prototype.updateFrozenColumnreOrder = function (args) {\n    var gObj = this.parent;\n    var tbody = gObj.getContentTable().querySelector(literals.tbody);\n    if (!gObj.selectionSettings.persistSelection && Object.keys(gObj.selectionModule.selectedRowState).length === 0) {\n      this.parent.clearSelection();\n    } else {\n      this.parent.clearRowSelection();\n    }\n    var targetRow = this.refreshRowTarget(args);\n    this.refreshRow(args, tbody, targetRow);\n  };\n  RowDD.prototype.refreshData = function (tr) {\n    var rowObj = {};\n    var recordobj = {};\n    var rowObjects = this.parent.getRowsObject();\n    var currentViewData = this.parent.getCurrentViewRecords();\n    for (var i = 0, len = tr.length; i < len; i++) {\n      var index = parseInt(tr[parseInt(i.toString(), 10)].getAttribute(literals.ariaRowIndex), 10) - 1;\n      rowObj[parseInt(i.toString(), 10)] = rowObjects[parseInt(index.toString(), 10)];\n      recordobj[parseInt(i.toString(), 10)] = currentViewData[parseInt(index.toString(), 10)];\n    }\n    var rows = this.parent.getRows();\n    for (var i = 0, len = tr.length; i < len; i++) {\n      rows[parseInt(i.toString(), 10)] = tr[parseInt(i.toString(), 10)];\n      rowObjects[parseInt(i.toString(), 10)] = rowObj[parseInt(i.toString(), 10)];\n      currentViewData[parseInt(i.toString(), 10)] = recordobj[parseInt(i.toString(), 10)];\n    }\n    resetRowIndex(this.parent, rowObjects, tr);\n  };\n  RowDD.prototype.rowOrder = function (args) {\n    if (args.dropIndex === args.fromIndex || isNaN(args.dropIndex) || parentsUntil(args.target, 'e-groupcaption')) {\n      return;\n    }\n    if (this.parent.isDetail()) {\n      this.parent.detailCollapseAll();\n      var rows = [].slice.call(this.parent.getContentTable().querySelector(literals.tbody).children);\n      var rowObjects = this.parent.getRowsObject();\n      rows.filter(function (row) {\n        if (row.classList.contains('e-detailrow')) {\n          row.remove();\n        }\n      });\n      for (var i = 0, len = rowObjects.length; i < len; i++) {\n        if (!rowObjects[parseInt(i.toString(), 10)]) {\n          break;\n        }\n        if (rowObjects[parseInt(i.toString(), 10)].isDetailRow) {\n          this.parent.getRowsObject().splice(i, 1);\n          i--;\n        }\n      }\n    }\n    if (args.target.classList.contains('e-rowcelldrag') || args.target.classList.contains('e-dtdiagonalright') || args.target.classList.contains('e-dtdiagonaldown')) {\n      args.target = args.target.parentElement;\n    }\n    if (!args.target.classList.contains('e-rowcell') && parentsUntil(args.target, 'e-rowcell')) {\n      args.target = parentsUntil(args.target, 'e-rowcell');\n    }\n    if (this.parent.frozenRows) {\n      this.updateFrozenRowreOrder(args);\n    } else {\n      this.updateFrozenColumnreOrder(args);\n    }\n    if ((!this.parent.allowGrouping || !this.parent.groupSettings.columns.length) && this.selectedRowColls.length > 0) {\n      this.parent.selectRows(this.selectedRowColls);\n      var indexes = [];\n      if (this.parent.filterSettings.columns.length || this.parent.sortSettings.columns.length) {\n        for (var i = 0, len = args.rows.length; i < len; i++) {\n          indexes.push(parseInt(args.rows[parseInt(i.toString(), 10)].getAttribute(literals.ariaRowIndex), 10) - 1);\n        }\n        this.selectedRowColls = indexes;\n      }\n      this.selectedRowColls = [];\n    } else {\n      this.selectedRowColls = [];\n    }\n  };\n  RowDD.prototype.currentViewData = function () {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var currentVdata = [];\n    var fromIdx = parseInt(this.startedRow.getAttribute(literals.ariaRowIndex), 10) - 1;\n    for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n      var currentV = 'currentViewData';\n      currentVdata[parseInt(i.toString(), 10)] = this.parent[\"\" + currentV][selectedIndexes[parseInt(i.toString(), 10)]];\n    }\n    if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n      currentVdata[0] = this.parent.currentViewData[parseInt(fromIdx.toString(), 10)];\n    }\n    return currentVdata;\n  };\n  // private saveChange(changeRecords: object, query: Query): void {\n  //     this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query)\n  //         .then(() => {\n  //             this.parent.notify(events.modelChanged, {\n  //                 type: events.actionBegin, requestType: 'rowdraganddrop'\n  //             });\n  //         }).catch((e: Error) => {\n  //             const error: string = 'error';\n  //             const message: string = 'message';\n  //             if (!isNullOrUndefined(e[`${error}`]) && !isNullOrUndefined(e[`${error}`][`${message}`])) {\n  //                 e[`${error}`] = e[`${error}`][`${message}`];\n  //             }\n  //             this.parent.trigger(events.actionFailure, e);\n  //         });\n  // }\n  RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var selectedRecords = [];\n    var draggedRecords = [];\n    var currentViewData = this.parent.getDataModule().isRemote() ? this.parent.getCurrentViewRecords() : this.parent.renderModule.data.dataManager.dataSource.json;\n    var skip = this.parent.allowPaging ? this.parent.pageSettings.currentPage * this.parent.pageSettings.pageSize - this.parent.pageSettings.pageSize : 0;\n    var dropIdx = toIndex + skip;\n    var actualIdx = fromIndexes[0] + skip;\n    for (var i = 0, len = fromIndexes.length; i < len; i++) {\n      draggedRecords[parseInt(i.toString(), 10)] = currentViewData[fromIndexes[parseInt(i.toString(), 10)] + skip];\n    }\n    for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n      selectedRecords[parseInt(i.toString(), 10)] = currentViewData[selectedIndexes[parseInt(i.toString(), 10)] + skip];\n    }\n    for (var i = 0, len = draggedRecords.length; i < len; i++) {\n      if (i !== 0) {\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(currentViewData[parseInt(j.toString(), 10)]) === JSON.stringify(draggedRecords[parseInt(i.toString(), 10)])) {\n            actualIdx = j;\n            break;\n          }\n        }\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(currentViewData[parseInt(j.toString(), 10)]) === JSON.stringify(draggedRecords[i - 1])) {\n            if (actualIdx > j) {\n              dropIdx = j + 1;\n            }\n            break;\n          }\n        }\n      }\n      this.reorderRow(actualIdx - skip, dropIdx - skip);\n    }\n    if (this.isRefresh) {\n      this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }\n    for (var i = 0, len = selectedRecords.length; i < len; i++) {\n      for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n        if (JSON.stringify(currentViewData[parseInt(j.toString(), 10)]) === JSON.stringify(selectedRecords[parseInt(i.toString(), 10)])) {\n          selectedIndexes[parseInt(i.toString(), 10)] = j - skip;\n          break;\n        }\n      }\n    }\n    this.selectedRowColls = selectedIndexes;\n  };\n  RowDD.prototype.stopTimer = function () {\n    window.clearInterval(this.timer);\n  };\n  /**\n   * To trigger action complete event.\n   *\n   * @param {NotifyArgs} e - specifies the NotifyArgs\n   * @returns {void}\n   * @hidden\n   */\n  RowDD.prototype.onActionComplete = function (e) {\n    this.parent.trigger(events.actionComplete, extend(e, {\n      type: events.actionComplete,\n      requestType: 'rowdraganddrop'\n    }));\n  };\n  RowDD.prototype.initializeDrag = function () {\n    var gObj = this.parent;\n    this.draggable = new Draggable(gObj.element, {\n      dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n      distance: 5,\n      helper: this.helper,\n      dragStart: this.dragStart,\n      drag: this.drag,\n      dragStop: this.dragStop,\n      isReplaceDragEle: this.isReplaceDragEle,\n      isPreventSelect: false,\n      isPreventScroll: true\n    });\n  };\n  RowDD.prototype.updateScrollPostion = function (e) {\n    var _this = this;\n    var y = getPosition(e).y;\n    var cliRect = this.isDropGrid.getContent().getBoundingClientRect();\n    var rowHeight = this.isDropGrid.getRowHeight() - 15;\n    var scrollElem = this.isDropGrid.getContent().firstElementChild;\n    var virtualScrollbtm = this.parent.enableVirtualization ? 20 : 0;\n    if (cliRect.top >= y) {\n      var scrollPixel_1 = -this.isDropGrid.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_1);\n      }, 200);\n    } else if (cliRect.top + this.isDropGrid.getContent().clientHeight - rowHeight - 33 - virtualScrollbtm <= y) {\n      var scrollPixel_2 = this.isDropGrid.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_2);\n      }, 200);\n    }\n  };\n  RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel) {\n    scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n  };\n  RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    if (this.parent.element.classList.contains('e-childgrid')) {\n      var parentGrid = this.getParentGrid(this.parent.element);\n      cloneElement = parentGrid.querySelector('.e-cloneproperties');\n    }\n    var element = closestElement(e.target, 'tr');\n    if (parentsUntil(element, 'e-grid') && (!this.parent.rowDropSettings.targetID && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id || this.istargetGrid)) {\n      var targetElement = element;\n      if (!element) {\n        targetElement = startedRow;\n      }\n      this.setBorder(targetElement, e.event, startedRow, targetRow);\n    }\n  };\n  RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n    var node = this.parent.element;\n    if (this.istargetGrid) {\n      node = this.isDropGrid.element;\n    }\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n      this.removeBorder(element);\n    } else {\n      this.removeFirstRowBorder(element);\n      this.removeLastRowBorder(element);\n    }\n    if (parentsUntil(element, 'e-grid') && element.classList.contains(literals.row) && (!this.parent.rowDropSettings.targetID && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id || this.istargetGrid)) {\n      if (this.parent.allowGrouping && this.parent.groupSettings.columns && this.parent.groupSettings.columns.length) {\n        removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'), ['e-dragtop', 'e-dragright', 'e-dragbottom', 'e-dragleft']);\n      } else {\n        removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'), ['e-dragborder']);\n      }\n      var rowElement = [];\n      var targetRowIndex = parseInt(targetRow.getAttribute(literals.ariaRowIndex), 10) - 1;\n      if (targetRow && targetRowIndex === 0 && !(this.isNewRowAdded() && this.parent.editSettings.newRowPosition === 'Top')) {\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n          element = targetRow;\n          rowElement = [].slice.call(element.querySelectorAll('.e-groupcaption,.e-summarycell,.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n        } else {\n          var div = this.parent.createElement('div', {\n            className: 'e-firstrow-dragborder'\n          });\n          var gridheaderEle = this.isDropGrid.getHeaderContent();\n          gridheaderEle.classList.add('e-grid-relative');\n          div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n          if (!gridheaderEle.getElementsByClassName('e-firstrow-dragborder').length) {\n            if (this.parent.frozenRows) {\n              if (this.parent.isFrozenGrid()) {\n                div.style.width = this.parent.getContent().firstElementChild.scrollWidth + 'px';\n              }\n              gridheaderEle.querySelector('thead').appendChild(div);\n              div.style.position = 'relative';\n            } else {\n              gridheaderEle.appendChild(div);\n            }\n          }\n        }\n      } else if (this.parent.rowDropSettings.targetID && targetRow) {\n        element = this.isDropGrid.getRowByIndex(targetRowIndex - 1);\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      } else if (targetRow && parseInt(startedRow.getAttribute(literals.ariaRowIndex), 10) - 1 > targetRowIndex) {\n        if (this.parent.enableVirtualization && this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n          targetRowIndex = this.parent.getDataRows().indexOf(targetRow);\n        }\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n          element = targetRow;\n          rowElement = [].slice.call(element.querySelectorAll(\".e-groupcaption,.e-summarycell,.e-rowcell:not(.e-hide),.e-rowdragdrop:not(.e-hide),\\n                        .e-detailrowcollapse:not(.e-hide)\"));\n        } else {\n          if (targetRowIndex === 0 && this.isNewRowAdded() && this.parent.editSettings.newRowPosition === 'Top') {\n            element = this.parent.element.querySelector('.e-row.e-addedrow tr');\n          } else {\n            element = this.parent.getRowByIndex(targetRowIndex - 1);\n          }\n          rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse,.e-dragindentcell'));\n        }\n      } else {\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      }\n      if (rowElement.length > 0) {\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns && this.parent.groupSettings.columns.length) {\n          this.groupRowDDIndicator(rowElement, true);\n        } else {\n          addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n        }\n      }\n    }\n  };\n  RowDD.prototype.getScrollWidth = function () {\n    var scrollElem = this.parent.getContent().firstElementChild;\n    return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n  };\n  RowDD.prototype.removeFirstRowBorder = function (element) {\n    if (this.isDropGrid.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element && (element.rowIndex !== 0 || element.classList.contains('e-columnheader'))) {\n      remove(this.isDropGrid.element.getElementsByClassName('e-firstrow-dragborder')[0]);\n    } else {\n      var addNewRow = this.parent.element.querySelector('.e-row.e-addedrow tr');\n      if (addNewRow && addNewRow.querySelector('.e-dragborder')) {\n        var rowElement = [].slice.call(addNewRow.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse,.e-dragindentcell'));\n        addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n      }\n    }\n  };\n  RowDD.prototype.removeLastRowBorder = function (element) {\n    var islastRowIndex;\n    if (this.parent.enableVirtualization) {\n      islastRowIndex = element && parseInt(element.getAttribute(literals.ariaRowIndex), 10) - 1 !== this.parent.renderModule.data.dataManager.dataSource.json.length - 1;\n    } else {\n      var rowIndex = this.parent.enableInfiniteScrolling && this.parent.infiniteScrollSettings.enableCache && !this.parent.groupSettings.enableLazyLoading ? this.parent.pageSettings.currentPage * this.parent.pageSettings.pageSize - 1 : this.parent.getCurrentViewRecords().length - 1;\n      var lastRow = this.parent.getRowByIndex(rowIndex);\n      islastRowIndex = element && lastRow && lastRow.getAttribute('data-uid') !== element.getAttribute('data-uid');\n    }\n    if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n      remove(this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0]);\n    }\n  };\n  RowDD.prototype.removeBorder = function (element) {\n    this.removeFirstRowBorder(element);\n    if (!this.parent.rowDropSettings.targetID) {\n      this.removeLastRowBorder(element);\n    }\n    if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n      element = [].slice.call(this.isDropGrid.getContentTable().querySelectorAll('tr')).filter(function (row) {\n        return row.querySelector('td.e-dragtop.e-dragbottom');\n      })[0];\n    } else {\n      element = this.isDropGrid.getRows().filter(function (row) {\n        return row.querySelector('td.e-dragborder');\n      })[0];\n    }\n    if (element) {\n      var rowElement = this.parent.allowGrouping && this.parent.groupSettings.columns.length ? [].slice.call(element.querySelectorAll('.e-dragtop.e-dragbottom')) : [].slice.call(element.getElementsByClassName('e-dragborder'));\n      if (this.parent.allowGrouping && this.parent.groupSettings.columns && this.parent.groupSettings.columns.length) {\n        this.groupRowDDIndicator(rowElement, false);\n      } else {\n        addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n      }\n    }\n  };\n  RowDD.prototype.getElementFromPosition = function (element, event) {\n    var position = getPosition(event);\n    element.style.display = 'none';\n    var target = document.elementFromPoint(position.x, position.y);\n    element.style.display = '';\n    return target;\n  };\n  RowDD.prototype.onDataBound = function () {\n    if (this.selectedRowColls.length > 0 && (this.parent.enableVirtualization || this.parent.allowRowDragAndDrop)) {\n      this.parent.selectRows(this.selectedRowColls);\n      this.selectedRowColls = [];\n    }\n  };\n  RowDD.prototype.getTargetIdx = function (targetRow) {\n    return targetRow ? parseInt(targetRow.getAttribute(literals.ariaRowIndex), 10) - 1 : 0;\n  };\n  RowDD.prototype.singleRowDrop = function (e) {\n    var targetRow = closestElement(e.target, 'tr');\n    var srcControl = e.droppedElement.parentElement.ej2_instances[0];\n    var currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n    this.reorderRow(this.startedRowIndex, currentIndex);\n  };\n  RowDD.prototype.columnDrop = function (e) {\n    var gObj = this.parent;\n    if (e.droppedElement.getAttribute('action') !== 'grouping' && (parentsUntil(e.target, literals.row) || parentsUntil(e.target, 'e-emptyrow') || parentsUntil(e.target, literals.gridContent))) {\n      var targetRow = closestElement(e.target, 'tr');\n      var srcControl = void 0;\n      var currentIndex = void 0;\n      var dragParentElement = document.querySelector('.e-drag-ref');\n      if (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' && (e.droppedElement.parentElement.id === gObj.element.id || dragParentElement && dragParentElement.parentElement.id === gObj.element.id) || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' && e.droppedElement.parentElement.id !== gObj.element.id) {\n        return;\n      }\n      if (e.droppedElement.parentElement.id !== gObj.element.id) {\n        if (dragParentElement) {\n          srcControl = dragParentElement.parentElement.ej2_instances[0];\n          remove(dragParentElement);\n        } else {\n          srcControl = e.droppedElement.parentElement.ej2_instances[0];\n        }\n      } else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n        this.singleRowDrop(e);\n        return;\n      }\n      if (srcControl.element.id !== gObj.element.id && srcControl.rowDropSettings.targetID !== gObj.element.id) {\n        return;\n      }\n      var records = srcControl.getSelectedRecords();\n      var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n      if (e.target && e.target.classList.contains('e-content') && gObj.getCurrentViewRecords().length) {\n        var lastrow = gObj.getContentTable().querySelector('tr:last-child');\n        if (lastrow) {\n          targetIndex = currentIndex = parseInt(lastrow.getAttribute(literals.ariaRowIndex), 10);\n        }\n      }\n      if (isNaN(targetIndex)) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        targetIndex = currentIndex = 0;\n      }\n      if (gObj.allowPaging) {\n        targetIndex = targetIndex + gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize;\n      }\n      //Todo: drag and drop mapper & BatchChanges\n      gObj.notify(events.rowsAdded, {\n        toIndex: targetIndex,\n        records: records\n      });\n      gObj.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n      var selectedRows = srcControl.getSelectedRowIndexes();\n      var skip = srcControl.allowPaging ? srcControl.pageSettings.currentPage * srcControl.pageSettings.pageSize - srcControl.pageSettings.pageSize : 0;\n      this.selectedRows = [];\n      for (var i = 0, len = records.length; i < len; i++) {\n        this.selectedRows.push(skip + selectedRows[parseInt(i.toString(), 10)]);\n      }\n      srcControl.notify(events.rowsRemoved, {\n        indexes: this.selectedRows,\n        records: records\n      });\n      if (srcControl.dataSource instanceof DataManager && srcControl.dataSource.dataSource.offline) {\n        srcControl.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n      }\n    }\n  };\n  RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n    var gObj = this.parent;\n    if (!gObj.groupSettings.columns.length) {\n      //Todo: drag and drop mapper & BatchChanges\n      var skip = gObj.allowPaging ? gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize : 0;\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      var fromIndex = fromIndexes;\n      toIndex = toIndex + skip;\n      this.selectedRows = gObj.getSelectedRowIndexes();\n      gObj.notify(events.rowPositionChanged, {\n        fromIndex: fromIndexes + skip,\n        toIndex: toIndex\n      });\n    }\n  };\n  RowDD.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.initializeDrag();\n    }\n  };\n  /**\n   * To destroy the print\n   *\n   * @returns {void}\n   * @hidden\n   */\n  RowDD.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n    if (this.parent.isDestroyed || !gridElement || !gridElement.querySelector('.' + literals.gridHeader) && !gridElement.querySelector('.' + literals.gridContent)) {\n      return;\n    }\n    this.draggable.destroy();\n    this.parent.off(events.initialEnd, this.initializeDrag);\n    this.parent.off(events.columnDrop, this.columnDrop);\n    this.parent.off(events.rowDragAndDropComplete, this.onActionComplete);\n    this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.off(events.uiUpdate, this.enableAfterRender);\n    this.parent.off(events.destroy, this.destroy);\n    //destory ejdrag and drop\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {string} returns the module name\n   * @private\n   */\n  RowDD.prototype.getModuleName = function () {\n    return 'rowDragAndDrop';\n  };\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  RowDD.prototype.processArgs = function (target) {\n    var gObj = this.parent;\n    var dragIdx = parseInt(this.startedRow.getAttribute(literals.ariaRowIndex), 10) - 1;\n    if (gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false || gObj.getSelectedRecords().length === 0) {\n      if (gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache) {\n        this.rows = [this.startedRow];\n      } else {\n        this.rows = [gObj.getRowByIndex(dragIdx)];\n      }\n      this.rowData = [gObj.getRowInfo(this.startedRow.querySelector('.' + literals.rowCell)).rowData];\n      if ((gObj.enableVirtualization || gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache) && gObj.allowGrouping && gObj.groupSettings.columns.length && gObj.getSelectedRows().length) {\n        this.rows = gObj.getSelectedRows();\n        this.rowData = Array.from(this.rows, function (row) {\n          return gObj.getRowObjectFromUID(row.getAttribute('data-uid')).data;\n        });\n      }\n    } else {\n      this.rows = gObj.getSelectedRows();\n      this.rowData = Array.from(this.rows, function (row) {\n        return gObj.getRowObjectFromUID(row.getAttribute('data-uid')).data;\n      });\n    }\n  };\n  return RowDD;\n}();\nexport { RowDD };","map":{"version":3,"names":["Draggable","isNullOrUndefined","removeClass","remove","closest","closestElement","classList","extend","parentsUntil","removeElement","getPosition","addRemoveActiveClasses","isActionPrevent","resetRowIndex","resetCachedRowIndex","groupReorderRowObject","events","Scroll","DataManager","literals","RowDD","parent","_this","selectedRows","isOverflowBorder","selectedRowColls","isRefresh","isReplaceDragEle","istargetGrid","helper","e","gObj","target","draggable","currentStateTarget","rowDropSettings","targetID","contains","visualElement","createElement","className","style","height","table","attrs","role","tbody","document","getElementsByClassName","length","selectionSettings","type","mode","selectRow","parseInt","parentElement","getAttribute","ariaRowIndex","startedRow","cloneNode","isFrozenGrid","nodes","slice","call","querySelectorAll","i","toString","removeAttribute","processArgs","args","selectedRow","rows","dragelement","cloneElement","cancel","data","rowData","getSelectedRows","trigger","rowDragStartHelper","enableInfiniteScrolling","infiniteScrollSettings","enableCache","removeCell","gridChkBox","activeCells","forEach","cell","appendChild","getSelectedRowIndexes","hasAttribute","dropCountEle","innerHTML","ele","querySelector","add","element","dragStart","enableVirtualization","allowGrouping","groupSettings","columns","dragTrs","dragElement","indentCells","j","cloneIndentCell","insertBefore","firstElementChild","parentGrid","getParentGrid","body","spanCssEle","getSelectedRecords","left","offsetWidth","rowDragStart","draggableType","fromIndex","Object","keys","currentViewData","dragStartData","dropElem","getElementById","ej2_instances","getModuleName","getContent","drag","isDropGrid","dropElement","id","getElementFromPosition","event","hoverState","enableHover","trElement","originalEvent","rowDrag","stopTimer","dragTarget","dragParentElement","updateScrollPostion","frozenRows","getRowByIndex","getCurrentViewRecords","moveDragRows","islastRowIndex","renderModule","dataManager","dataSource","json","rowIndex","enableLazyLoading","pageSettings","currentPage","pageSize","lastRow","isNewRowAdded","editSettings","newRowPosition","bottomborder","gridcontentEle","width","getScrollWidth","zIndex","nextSibling","bottom","removeBorder","content","selector","groupSelector","rowElement","groupRowDDIndicator","dragStop","isCheckBoxSelection","window","getSelection","removeAllRanges","notify","preventBatch","instance","handler","processDragStop","arg1","isDestroyed","targetEle","stRow","dropIndex","rowDrop","row","gridContent","selectedIndexes","isRowDragable","reorderRows","sortSettings","filterSettings","refresh","contentModule","vgenerator","startIndex","rowOrder","getContentTable","scrollHeight","clientHeight","scrollModule","setLastRowCell","targetRow","filter","deleteCell","cellIndex","on","initialEnd","initializeDrag","columnDrop","rowDragAndDropComplete","onActionComplete","onDataBoundFn","onDataBound","bind","addEventListener","dataBound","uiUpdate","enableAfterRender","destroy","prototype","childGrid","parentGridObtained","parentDetails","parentID","showAddNewRow","isAdd","refreshRow","tbodyContent","tbodyHeader","getHeaderTable","len","removeElem","getRowElementByUID","dragstartrow","dragRowUid","dropRowUid","dragRowObject","getRowObjectFromUID","dropRowObject","parentUid","groupReorderHandler","tr","getRowsObject","isDataRow","refreshExpandandCollapse","vRows","refreshData","updateFrozenRowreOrder","tbodyC","tbodyH","concat","persistSelection","selectionModule","selectedRowState","clearSelection","clearRowSelection","refreshRowTarget","targetIdx","getDataRows","indexOf","targetTR","getRows","updateFrozenColumnreOrder","rowObj","recordobj","rowObjects","index","isNaN","isDetail","detailCollapseAll","children","isDetailRow","splice","selectRows","indexes","push","currentVdata","fromIdx","n","currentV","fromIndexes","toIndex","selectedRecords","draggedRecords","getDataModule","isRemote","skip","allowPaging","dropIdx","actualIdx","len1","JSON","stringify","reorderRow","modelChanged","actionBegin","requestType","clearInterval","timer","actionComplete","distance","isPreventSelect","isPreventScroll","y","cliRect","getBoundingClientRect","rowHeight","getRowHeight","scrollElem","virtualScrollbtm","top","scrollPixel_1","setInterval","setScrollDown","scrollPixel_2","scrollPixel","scrollTop","targetElement","setBorder","node","removeFirstRowBorder","removeLastRowBorder","targetRowIndex","div","gridheaderEle","getHeaderContent","scrollWidth","position","getScrollBarWidth","addNewRow","display","elementFromPoint","x","allowRowDragAndDrop","getTargetIdx","singleRowDrop","srcControl","droppedElement","currentIndex","startedRowIndex","isSingleRowDragDrop","records","targetIndex","lastrow","rowsAdded","rowsRemoved","offline","rowPositionChanged","module","enable","gridElement","gridHeader","off","removeEventListener","dragIdx","cells","getRowInfo","rowCell","Array","from"],"sources":["D:/weektable/frontend/node_modules/@syncfusion/ej2-grids/src/grid/actions/row-reorder.js"],"sourcesContent":["import { Draggable, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList, extend } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport { resetRowIndex, resetCachedRowIndex, groupReorderRowObject } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport * as literals from '../base/string-literals';\n// eslint-disable-next-line valid-jsdoc, jsdoc/require-param, jsdoc/require-returns\n/**\n *\n * Reorder module is used to handle row reordering.\n *\n * @hidden\n */\nvar RowDD = /** @class */ (function () {\n    /**\n     * Constructor for the Grid print module\n     *\n     * @param {IGrid} parent - specifies the IGrid\n     * @hidden\n     */\n    function RowDD(parent) {\n        var _this = this;\n        this.selectedRows = [];\n        this.isOverflowBorder = true;\n        this.selectedRowColls = [];\n        this.isRefresh = true;\n        this.isReplaceDragEle = true;\n        this.istargetGrid = false;\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = _this.draggable.currentStateTarget;\n            if (!isNullOrUndefined(target) && gObj.rowDropSettings.targetID && !isNullOrUndefined(target.classList) && !target.classList.contains('e-rowcell')) {\n                target = parentsUntil(target, 'e-rowcell');\n            }\n            var visualElement = _this.parent.createElement('div', {\n                className: 'e-cloneproperties e-draganddrop e-grid e-dragclone'\n            });\n            visualElement.style.height = 'auto';\n            var table = _this.parent.createElement('table', { attrs: { role: 'grid' } });\n            var tbody = _this.parent.createElement(literals.tbody, { attrs: { role: 'rowgroup' } });\n            if (document.getElementsByClassName('e-griddragarea').length ||\n                (gObj.rowDropSettings.targetID && ((!isNullOrUndefined(target) && !target.classList.contains('e-selectionbackground')\n                    && gObj.selectionSettings.type !== 'Single') || !parentsUntil(target, 'e-rowcell'))) ||\n                (!gObj.rowDropSettings.targetID && !parentsUntil(target, 'e-rowdragdrop'))) {\n                return false;\n            }\n            if (gObj.rowDropSettings.targetID &&\n                gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n                gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement\n                    .getAttribute(literals.ariaRowIndex), 10) - 1);\n            }\n            _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n            if (_this.parent.isFrozenGrid()) {\n                var nodes = [].slice.call(_this.startedRow.querySelectorAll('.e-rowcell'));\n                for (var i = 0; i < nodes.length; i++) {\n                    removeClass([nodes[parseInt(i.toString(), 10)]], ['e-leftfreeze', 'e-freezeleftborder', 'e-fixedfreeze', 'e-freezerightborder', 'e-rightfreeze', 'e-unfreeze']);\n                    nodes[parseInt(i.toString(), 10)].removeAttribute('style');\n                }\n            }\n            _this.processArgs(target);\n            var args = {\n                selectedRow: _this.rows, dragelement: target,\n                cloneElement: visualElement, cancel: false, data: _this.rowData\n            };\n            var selectedRows = gObj.getSelectedRows();\n            gObj.trigger(events.rowDragStartHelper, args);\n            var cancel = 'cancel';\n            if (args[\"\" + cancel]) {\n                return false;\n            }\n            removeElement(_this.startedRow, '.e-indentcell');\n            removeElement(_this.startedRow, '.e-detailrowcollapse');\n            removeElement(_this.startedRow, '.e-detailrowexpand');\n            if (!(gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache)) {\n                _this.removeCell(_this.startedRow, literals.gridChkBox);\n            }\n            var activeCells = _this.startedRow.querySelectorAll('.e-active');\n            activeCells.forEach(function (cell) { return cell.classList.remove('e-active'); });\n            tbody.appendChild(_this.startedRow);\n            if (gObj.getSelectedRowIndexes().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n                var dropCountEle = _this.parent.createElement('span', {\n                    className: 'e-dropitemscount', innerHTML: '' + selectedRows.length\n                });\n                visualElement.appendChild(dropCountEle);\n            }\n            var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n            if (ele) {\n                ele.classList.add('e-dragstartrow');\n            }\n            table.appendChild(tbody);\n            visualElement.appendChild(table);\n            gObj.element.appendChild(visualElement);\n            return visualElement;\n        };\n        this.dragStart = function (e) {\n            var gObj = _this.parent;\n            if ((gObj.enableVirtualization || gObj.infiniteScrollSettings.enableCache) && gObj.allowGrouping &&\n                gObj.groupSettings.columns.length && !isNullOrUndefined(e.target.closest('tr'))) {\n                var dragTrs = e.dragElement.querySelectorAll('tr');\n                var indentCells = e.target.closest('tr').querySelectorAll('.e-indentcell');\n                for (var i = 0; i < dragTrs.length; i++) {\n                    for (var j = 0; j < indentCells.length; j++) {\n                        var cloneIndentCell = indentCells[parseInt(j.toString(), 10)].cloneNode(true);\n                        dragTrs[parseInt(i.toString(), 10)].insertBefore(cloneIndentCell, dragTrs[parseInt(i.toString(), 10)].firstElementChild);\n                    }\n                }\n            }\n            if (gObj.element.classList.contains('e-childgrid')) {\n                var parentGrid = _this.getParentGrid(gObj.element);\n                parentGrid.appendChild(e.dragElement);\n                gObj.element.appendChild(gObj.createElement('div', { className: 'e-drag-ref' }));\n            }\n            document.body.classList.add('e-prevent-select');\n            if (document.getElementsByClassName('e-griddragarea').length) {\n                return;\n            }\n            var target = e.target;\n            var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n            if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n                spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table')\n                    .offsetWidth - 5 + 'px';\n            }\n            _this.processArgs(target);\n            gObj.trigger(events.rowDragStart, {\n                rows: _this.rows, target: e.target,\n                draggableType: 'rows', fromIndex: parseInt(_this.rows[0].getAttribute(literals.ariaRowIndex), 10) - 1,\n                data: (_this.rowData[0] && Object.keys(_this.rowData[0]).length > 0) ? _this.rowData : _this.currentViewData()\n            });\n            _this.dragStartData = _this.rowData;\n            var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances &&\n                dropElem.ej2_instances[0].getModuleName() === 'grid') {\n                dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n            }\n        };\n        this.drag = function (e) {\n            var gObj = _this.parent;\n            _this.isDropGrid = _this.parent;\n            _this.istargetGrid = false;\n            if (_this.parent.rowDropSettings.targetID) {\n                var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n                _this.isDropGrid = dropElement.ej2_instances[0];\n                if (parentsUntil(e.target, 'e-grid')) {\n                    _this.istargetGrid = _this.parent.rowDropSettings.targetID === parentsUntil(e.target, 'e-grid').id;\n                }\n            }\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            if (gObj.element.classList.contains('e-childgrid')) {\n                var parentGrid = _this.getParentGrid(gObj.element);\n                cloneElement = parentGrid.querySelector('.e-cloneproperties');\n            }\n            var target = _this.getElementFromPosition(cloneElement, e.event);\n            classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur', 'e-grabcur']);\n            _this.isOverflowBorder = true;\n            _this.hoverState = gObj.enableHover;\n            var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n            if (!e.target) {\n                return;\n            }\n            _this.processArgs(target);\n            if (gObj.enableVirtualization && isNullOrUndefined(_this.rows[0])) {\n                classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n            }\n            var args = {\n                rows: _this.rows, target: target, draggableType: 'rows',\n                data: _this.rowData, originalEvent: e, cancel: false\n            };\n            gObj.trigger(events.rowDrag, args);\n            _this.stopTimer();\n            if (args.cancel) {\n                return;\n            }\n            gObj.element.classList.add('e-rowdrag');\n            if (trElement && (parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id || parentsUntil(target, 'e-grid').id)) {\n                if (_this.isDropGrid.element.querySelector('.e-emptyrow')) {\n                    _this.dragTarget = 0;\n                }\n                else {\n                    _this.dragTarget = parseInt(trElement.getAttribute('aria-rowindex'), 10) - 1;\n                }\n            }\n            else {\n                _this.dragTarget = parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) - 1;\n            }\n            if (gObj.rowDropSettings.targetID) {\n                var dragParentElement = document.querySelector('.e-drag-ref');\n                if (!parentsUntil(target, 'e-grid') || (dragParentElement\n                    && parentsUntil(dragParentElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) ||\n                    parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-grabcur'], ['e-notallowedcur']);\n                }\n            }\n            else {\n                var element = parentsUntil(target, 'e-grid');\n                if (element && element.id === cloneElement.parentElement.id && parentsUntil(target, 'e-row') &&\n                    !parentsUntil(target, 'e-addedrow')) {\n                    classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n                }\n            }\n            if (parentsUntil(_this.isDropGrid.element, 'e-grid')) {\n                if ((!_this.isDropGrid.groupSettings.columns.length || _this.isDropGrid.groupSettings.columns.length)\n                    && !_this.isDropGrid.element.querySelector('.e-emptyrow')) {\n                    if (parentsUntil(target, 'e-grid') && parentsUntil(target, 'e-grid').id === _this.isDropGrid.element.id) {\n                        _this.updateScrollPostion(e.event);\n                    }\n                    if (((_this.isOverflowBorder || _this.parent.frozenRows > _this.dragTarget) &&\n                        (parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10) - 1 !== _this.dragTarget || _this.istargetGrid))\n                        || (_this.istargetGrid && trElement && _this.isDropGrid.getRowByIndex(_this.isDropGrid.getCurrentViewRecords().length - 1).\n                            getAttribute('data-uid') === trElement.getAttribute('data-uid'))) {\n                        _this.moveDragRows(e, _this.startedRow, trElement);\n                    }\n                    else {\n                        var islastRowIndex = void 0;\n                        if (_this.parent.enableVirtualization) {\n                            islastRowIndex = trElement && parseInt(trElement.getAttribute(literals.ariaRowIndex), 10) - 1 ===\n                                _this.parent.renderModule.data.dataManager.dataSource.json.length - 1;\n                        }\n                        else {\n                            var rowIndex = _this.parent.enableInfiniteScrolling && _this.parent.infiniteScrollSettings.enableCache &&\n                                !_this.parent.groupSettings.enableLazyLoading ?\n                                _this.parent.pageSettings.currentPage * _this.parent.pageSettings.pageSize - 1 :\n                                _this.parent.getCurrentViewRecords().length - 1;\n                            var lastRow = _this.parent.getRowByIndex(rowIndex);\n                            islastRowIndex = trElement && lastRow && lastRow.getAttribute('data-uid') === trElement.getAttribute('data-uid') &&\n                                lastRow.getAttribute('data-uid') !== _this.startedRow.getAttribute('data-uid');\n                            if (_this.isNewRowAdded() && _this.parent.editSettings.newRowPosition === 'Bottom') {\n                                islastRowIndex = false;\n                            }\n                        }\n                        if (islastRowIndex && !_this.parent.rowDropSettings.targetID) {\n                            var bottomborder = _this.parent.createElement('div', { className: 'e-lastrow-dragborder' });\n                            var gridcontentEle = _this.parent.getContent();\n                            bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n                            if (_this.parent.enableVirtualization) {\n                                bottomborder.style.zIndex = '1';\n                            }\n                            if (!gridcontentEle.getElementsByClassName('e-lastrow-dragborder').length &&\n                                (!(gObj.allowGrouping && gObj.groupSettings.columns.length) || isNullOrUndefined(trElement.nextSibling))) {\n                                gridcontentEle.classList.add('e-grid-relative');\n                                gridcontentEle.appendChild(bottomborder);\n                                bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n                            }\n                        }\n                        _this.removeBorder(trElement);\n                    }\n                }\n                if (target && target.classList.contains(literals.content)\n                    && !_this.isDropGrid.element.querySelector('.e-emptyrow') && _this.istargetGrid) {\n                    _this.removeBorder(trElement);\n                    var rowIndex = _this.isDropGrid.getCurrentViewRecords().length - 1;\n                    var selector = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n                    var groupSelector = '.e-rowcell:not(.e-hide),.e-rowdragdrop:not(.e-hide),.e-detailrowcollapse:not(.e-hide)';\n                    var rowElement = [];\n                    if (_this.parent.allowGrouping && _this.parent.groupSettings.columns && _this.parent.groupSettings.columns.length) {\n                        rowElement = [].slice.call(_this.isDropGrid.getRowByIndex(rowIndex).querySelectorAll(groupSelector));\n                    }\n                    else {\n                        rowElement = [].slice.call(_this.isDropGrid.getRowByIndex(rowIndex).querySelectorAll(selector));\n                    }\n                    if (rowElement.length > 0) {\n                        if (_this.parent.allowGrouping && _this.parent.groupSettings.columns && _this.parent.groupSettings.columns.length) {\n                            _this.groupRowDDIndicator(rowElement, true);\n                        }\n                        else {\n                            addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n                        }\n                    }\n                }\n            }\n        };\n        this.dragStop = function (e) {\n            if (_this.parent.isCheckBoxSelection && _this.parent.enableInfiniteScrolling) {\n                window.getSelection().removeAllRanges();\n            }\n            document.body.classList.remove('e-prevent-select');\n            if (isActionPrevent(_this.parent)) {\n                _this.parent.notify(events.preventBatch, {\n                    instance: _this, handler: _this.processDragStop, arg1: e\n                });\n            }\n            else {\n                _this.processDragStop(e);\n            }\n        };\n        this.processDragStop = function (e) {\n            var gObj = _this.parent;\n            if (_this.parent.isDestroyed) {\n                return;\n            }\n            var targetEle = _this.getElementFromPosition(e.helper, e.event);\n            var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ?\n                targetEle : e.target;\n            gObj.element.classList.remove('e-rowdrag');\n            var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances &&\n                dropElement.ej2_instances[0].getModuleName() === 'grid') {\n                dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n            }\n            if (parentsUntil(_this.isDropGrid.element, 'e-grid')) {\n                _this.stopTimer();\n                _this.isDropGrid.enableHover = _this.hoverState;\n                _this.isDropGrid.getContent().classList.remove('e-grid-relative');\n                _this.removeBorder(targetEle);\n                var stRow = _this.isDropGrid.element.querySelector('.e-dragstartrow');\n                if (stRow) {\n                    stRow.classList.remove('e-dragstartrow');\n                }\n            }\n            _this.processArgs(target);\n            if (gObj.enableVirtualization && isNullOrUndefined(_this.rows[0])) {\n                return;\n            }\n            var args = {\n                target: target, draggableType: 'rows',\n                cancel: false,\n                fromIndex: parseInt(_this.rows[0].getAttribute(literals.ariaRowIndex), 10) - 1,\n                dropIndex: _this.dragTarget, rows: _this.rows,\n                data: (Object.keys(_this.dragStartData[0]).length > 0) ? _this.dragStartData : _this.currentViewData()\n            };\n            gObj.trigger(events.rowDrop, args, function () {\n                if (!(parentsUntil(target, literals.row) || parentsUntil(target, 'e-emptyrow')\n                    || parentsUntil(target, literals.gridContent)) || args.cancel) {\n                    _this.dragTarget = null;\n                    remove(e.helper);\n                    return;\n                }\n                _this.isRefresh = false;\n                var selectedIndexes = _this.parent.getSelectedRowIndexes();\n                if (gObj.isRowDragable()) {\n                    if (!_this.parent.rowDropSettings.targetID &&\n                        _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 &&\n                        selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n                        _this.reorderRows(selectedIndexes, args.dropIndex);\n                    }\n                    else {\n                        _this.reorderRows([parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10) - 1], _this.dragTarget);\n                    }\n                    _this.dragTarget = null;\n                    if (!gObj.rowDropSettings.targetID) {\n                        if (e.helper.classList.contains('e-cloneproperties') && document.querySelector('.' + e.helper.classList[0])) {\n                            remove(e.helper);\n                        }\n                        if (gObj.enableVirtualization && !gObj.sortSettings.columns.length && !gObj.filterSettings.columns.length &&\n                            (!_this.parent.allowGrouping || !gObj.groupSettings.columns.length)) {\n                            gObj.refresh();\n                            gObj.contentModule.vgenerator.startIndex = null;\n                        }\n                        else {\n                            _this.rowOrder(args);\n                        }\n                    }\n                    if (_this.parent.getContentTable().scrollHeight < _this.parent.getContent().clientHeight) {\n                        _this.parent.scrollModule.setLastRowCell();\n                    }\n                }\n                _this.isRefresh = true;\n            });\n        };\n        this.removeCell = function (targetRow, className) {\n            return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n                if (cell.classList.contains(className)) {\n                    targetRow.deleteCell(cell.cellIndex);\n                }\n            });\n        };\n        this.parent = parent;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initialEnd, this.initializeDrag, this);\n        this.parent.on(events.columnDrop, this.columnDrop, this);\n        this.parent.on(events.rowDragAndDropComplete, this.onActionComplete, this);\n        this.onDataBoundFn = this.onDataBound.bind(this);\n        this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n        this.parent.on(events.destroy, this.destroy, this);\n    }\n    RowDD.prototype.getParentGrid = function (childGrid) {\n        var parentGrid = childGrid;\n        var parentGridObtained = false;\n        while (!parentGridObtained) {\n            if (parentGrid.ej2_instances[0].parentDetails) {\n                parentGrid = document.getElementById(parentGrid.ej2_instances[0].parentDetails.parentID);\n            }\n            if (!parentGrid.classList.contains('e-childgrid')) {\n                parentGridObtained = true;\n            }\n        }\n        return parentGrid;\n    };\n    RowDD.prototype.isNewRowAdded = function () {\n        return this.parent.editSettings && this.parent.editSettings.showAddNewRow &&\n            !(this.parent.enableInfiniteScrolling || this.parent.enableVirtualization);\n    };\n    RowDD.prototype.groupRowDDIndicator = function (rowElement, isAdd) {\n        addRemoveActiveClasses([rowElement[0]], isAdd, 'e-dragleft');\n        addRemoveActiveClasses(rowElement, isAdd, 'e-dragtop', 'e-dragbottom');\n        addRemoveActiveClasses([rowElement[rowElement.length - 1]], isAdd, 'e-dragright');\n    };\n    RowDD.prototype.refreshRow = function (args, tbody, target) {\n        var gObj = this.parent;\n        var tbodyContent = gObj.getContentTable().querySelector(literals.tbody);\n        var tbodyHeader = gObj.getHeaderTable().querySelector(literals.tbody);\n        for (var i = 0, len = args.rows.length; i < len; i++) {\n            var row = args.rows[parseInt(i.toString(), 10)];\n            if (((gObj.enableVirtualization && gObj.allowGrouping && gObj.groupSettings.columns.length) ||\n                (gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache)) &&\n                args.rows.length === 1) {\n                var removeElem = gObj.getRowElementByUID(row.getAttribute('data-uid'));\n                if (!isNullOrUndefined(removeElem)) {\n                    remove(removeElem);\n                }\n            }\n            var dragstartrow = row.querySelector('.e-dragstartrow');\n            if (dragstartrow) {\n                dragstartrow.classList.remove('e-dragstartrow');\n            }\n            tbody.insertBefore(row, target);\n            if (gObj.allowGrouping && gObj.groupSettings.columns.length) {\n                var dragRowUid = row.getAttribute('data-uid');\n                var dropRowUid = args.target.parentElement.getAttribute('data-uid');\n                var dragRowObject = gObj.getRowObjectFromUID(dragRowUid);\n                var dropRowObject = gObj.getRowObjectFromUID(dropRowUid);\n                if (dragRowObject.parentUid !== dropRowObject.parentUid) {\n                    gObj['groupModule'].groupReorderHandler(dragRowObject, dropRowObject);\n                }\n            }\n        }\n        var tr = [].slice.call(gObj.editSettings.showAddNewRow ?\n            tbody.querySelectorAll('.e-row:not(.e-addedrow)') : tbody.getElementsByClassName(literals.row));\n        if (gObj.allowGrouping && gObj.groupSettings.columns.length) {\n            if (gObj.groupSettings.enableLazyLoading || (gObj.enableInfiniteScrolling &&\n                gObj.infiniteScrollSettings.enableCache && tr.length > gObj.pageSettings.pageSize * 3)) {\n                gObj.refresh();\n            }\n            else {\n                groupReorderRowObject(this.parent, args, tr);\n                if (gObj.enableVirtualization || (gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache)) {\n                    resetCachedRowIndex(gObj);\n                }\n                else {\n                    resetRowIndex(this.parent, gObj.getRowsObject().filter(function (data) { return data.isDataRow; }), tr);\n                }\n                this.parent.notify(events.refreshExpandandCollapse, {\n                    rows: gObj.enableVirtualization ? this.parent.vRows : this.parent.getRowsObject()\n                });\n            }\n        }\n        else if (gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache &&\n            !gObj.groupSettings.columns.length) {\n            if (tr.length > gObj.pageSettings.pageSize * 3) {\n                gObj.refresh();\n            }\n            else {\n                groupReorderRowObject(this.parent, args, tr);\n                resetCachedRowIndex(gObj);\n            }\n        }\n        else {\n            this.refreshData(tr);\n        }\n        if (this.parent.frozenRows) {\n            for (var i = 0, len = tr.length; i < len; i++) {\n                if (i < this.parent.frozenRows) {\n                    tbodyHeader.appendChild(tr[parseInt(i.toString(), 10)]);\n                }\n                else {\n                    tbodyContent.appendChild(tr[parseInt(i.toString(), 10)]);\n                }\n            }\n        }\n    };\n    RowDD.prototype.updateFrozenRowreOrder = function (args) {\n        var gObj = this.parent;\n        var tbodyC = gObj.getContentTable().querySelector(literals.tbody);\n        var tbodyH = gObj.getHeaderTable().querySelector(literals.tbody);\n        var tr = [].slice.call(tbodyH.getElementsByClassName(literals.row)).concat([].slice.call(tbodyC.getElementsByClassName(literals.row)));\n        var tbody = gObj.createElement(literals.tbody, { attrs: { role: 'rowgroup' } });\n        if (!gObj.selectionSettings.persistSelection && Object.keys(gObj.selectionModule.selectedRowState).length === 0) {\n            this.parent.clearSelection();\n        }\n        else {\n            this.parent.clearRowSelection();\n        }\n        var targetRow = this.refreshRowTarget(args);\n        for (var i = 0, len = tr.length; i < len; i++) {\n            tbody.appendChild(tr[parseInt(i.toString(), 10)]);\n        }\n        this.refreshRow(args, tbody, targetRow);\n    };\n    RowDD.prototype.refreshRowTarget = function (args) {\n        var gObj = this.parent;\n        var targetIdx = parseInt(args.target.parentElement.getAttribute(literals.ariaRowIndex), 10) - 1;\n        if (gObj.enableVirtualization && gObj.allowGrouping && gObj.groupSettings.columns.length) {\n            targetIdx = this.parent.getDataRows().indexOf(args.target.parentElement);\n        }\n        if ((args.fromIndex < args.dropIndex || args.fromIndex === args.dropIndex) && (!gObj.allowGrouping ||\n            !gObj.groupSettings.columns.length)) {\n            targetIdx = targetIdx + 1;\n        }\n        var targetTR = gObj.getRowByIndex(targetIdx);\n        if (targetIdx === gObj.getRows().length && this.isNewRowAdded() && this.parent.editSettings.newRowPosition === 'Bottom') {\n            targetTR = this.parent.element.querySelector('.e-row.e-addedrow');\n        }\n        var tr = gObj.allowGrouping && gObj.groupSettings.columns.length && targetIdx !== -1 &&\n            args.fromIndex < args.dropIndex && targetTR ? targetTR.nextSibling : targetTR;\n        return tr;\n    };\n    RowDD.prototype.updateFrozenColumnreOrder = function (args) {\n        var gObj = this.parent;\n        var tbody = gObj.getContentTable().querySelector(literals.tbody);\n        if (!gObj.selectionSettings.persistSelection && Object.keys(gObj.selectionModule.selectedRowState).length === 0) {\n            this.parent.clearSelection();\n        }\n        else {\n            this.parent.clearRowSelection();\n        }\n        var targetRow = this.refreshRowTarget(args);\n        this.refreshRow(args, tbody, targetRow);\n    };\n    RowDD.prototype.refreshData = function (tr) {\n        var rowObj = {};\n        var recordobj = {};\n        var rowObjects = this.parent.getRowsObject();\n        var currentViewData = this.parent.getCurrentViewRecords();\n        for (var i = 0, len = tr.length; i < len; i++) {\n            var index = parseInt(tr[parseInt(i.toString(), 10)].getAttribute(literals.ariaRowIndex), 10) - 1;\n            rowObj[parseInt(i.toString(), 10)] = rowObjects[parseInt(index.toString(), 10)];\n            recordobj[parseInt(i.toString(), 10)] = currentViewData[parseInt(index.toString(), 10)];\n        }\n        var rows = this.parent.getRows();\n        for (var i = 0, len = tr.length; i < len; i++) {\n            rows[parseInt(i.toString(), 10)] = tr[parseInt(i.toString(), 10)];\n            rowObjects[parseInt(i.toString(), 10)] = rowObj[parseInt(i.toString(), 10)];\n            currentViewData[parseInt(i.toString(), 10)] = recordobj[parseInt(i.toString(), 10)];\n        }\n        resetRowIndex(this.parent, rowObjects, tr);\n    };\n    RowDD.prototype.rowOrder = function (args) {\n        if (args.dropIndex === args.fromIndex || isNaN(args.dropIndex) || parentsUntil(args.target, 'e-groupcaption')) {\n            return;\n        }\n        if (this.parent.isDetail()) {\n            this.parent.detailCollapseAll();\n            var rows = [].slice.call(this.parent.getContentTable().querySelector(literals.tbody).children);\n            var rowObjects = this.parent.getRowsObject();\n            rows.filter(function (row) {\n                if (row.classList.contains('e-detailrow')) {\n                    row.remove();\n                }\n            });\n            for (var i = 0, len = rowObjects.length; i < len; i++) {\n                if (!rowObjects[parseInt(i.toString(), 10)]) {\n                    break;\n                }\n                if (rowObjects[parseInt(i.toString(), 10)].isDetailRow) {\n                    this.parent.getRowsObject().splice(i, 1);\n                    i--;\n                }\n            }\n        }\n        if (args.target.classList.contains('e-rowcelldrag') || args.target.classList.contains('e-dtdiagonalright')\n            || args.target.classList.contains('e-dtdiagonaldown')) {\n            args.target = args.target.parentElement;\n        }\n        if (!args.target.classList.contains('e-rowcell') && parentsUntil(args.target, 'e-rowcell')) {\n            args.target = parentsUntil(args.target, 'e-rowcell');\n        }\n        if (this.parent.frozenRows) {\n            this.updateFrozenRowreOrder(args);\n        }\n        else {\n            this.updateFrozenColumnreOrder(args);\n        }\n        if ((!this.parent.allowGrouping || !this.parent.groupSettings.columns.length) && this.selectedRowColls.length > 0) {\n            this.parent.selectRows(this.selectedRowColls);\n            var indexes = [];\n            if (this.parent.filterSettings.columns.length || this.parent.sortSettings.columns.length) {\n                for (var i = 0, len = args.rows.length; i < len; i++) {\n                    indexes.push(parseInt(args.rows[parseInt(i.toString(), 10)].getAttribute(literals.ariaRowIndex), 10) - 1);\n                }\n                this.selectedRowColls = indexes;\n            }\n            this.selectedRowColls = [];\n        }\n        else {\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.currentViewData = function () {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var currentVdata = [];\n        var fromIdx = parseInt(this.startedRow.getAttribute(literals.ariaRowIndex), 10) - 1;\n        for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n            var currentV = 'currentViewData';\n            currentVdata[parseInt(i.toString(), 10)] = this.parent[\"\" + currentV][selectedIndexes[parseInt(i.toString(), 10)]];\n        }\n        if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n            currentVdata[0] = this.parent.currentViewData[parseInt(fromIdx.toString(), 10)];\n        }\n        return currentVdata;\n    };\n    // private saveChange(changeRecords: object, query: Query): void {\n    //     this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query)\n    //         .then(() => {\n    //             this.parent.notify(events.modelChanged, {\n    //                 type: events.actionBegin, requestType: 'rowdraganddrop'\n    //             });\n    //         }).catch((e: Error) => {\n    //             const error: string = 'error';\n    //             const message: string = 'message';\n    //             if (!isNullOrUndefined(e[`${error}`]) && !isNullOrUndefined(e[`${error}`][`${message}`])) {\n    //                 e[`${error}`] = e[`${error}`][`${message}`];\n    //             }\n    //             this.parent.trigger(events.actionFailure, e);\n    //         });\n    // }\n    RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var selectedRecords = [];\n        var draggedRecords = [];\n        var currentViewData = this.parent.getDataModule().isRemote() ? this.parent.getCurrentViewRecords() :\n            this.parent.renderModule.data.dataManager.dataSource.json;\n        var skip = this.parent.allowPaging ?\n            (this.parent.pageSettings.currentPage * this.parent.pageSettings.pageSize) - this.parent.pageSettings.pageSize : 0;\n        var dropIdx = toIndex + skip;\n        var actualIdx = fromIndexes[0] + skip;\n        for (var i = 0, len = fromIndexes.length; i < len; i++) {\n            draggedRecords[parseInt(i.toString(), 10)] = currentViewData[fromIndexes[parseInt(i.toString(), 10)] + skip];\n        }\n        for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n            selectedRecords[parseInt(i.toString(), 10)] = currentViewData[selectedIndexes[parseInt(i.toString(), 10)] + skip];\n        }\n        for (var i = 0, len = draggedRecords.length; i < len; i++) {\n            if (i !== 0) {\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(currentViewData[parseInt(j.toString(), 10)]) ===\n                        JSON.stringify(draggedRecords[parseInt(i.toString(), 10)])) {\n                        actualIdx = j;\n                        break;\n                    }\n                }\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(currentViewData[parseInt(j.toString(), 10)]) === JSON\n                        .stringify(draggedRecords[i - 1])) {\n                        if (actualIdx > j) {\n                            dropIdx = j + 1;\n                        }\n                        break;\n                    }\n                }\n            }\n            this.reorderRow(actualIdx - skip, dropIdx - skip);\n        }\n        if (this.isRefresh) {\n            this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }\n        for (var i = 0, len = selectedRecords.length; i < len; i++) {\n            for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                if (JSON.stringify(currentViewData[parseInt(j.toString(), 10)]) === JSON\n                    .stringify(selectedRecords[parseInt(i.toString(), 10)])) {\n                    selectedIndexes[parseInt(i.toString(), 10)] = j - skip;\n                    break;\n                }\n            }\n        }\n        this.selectedRowColls = selectedIndexes;\n    };\n    RowDD.prototype.stopTimer = function () {\n        window.clearInterval(this.timer);\n    };\n    /**\n     * To trigger action complete event.\n     *\n     * @param {NotifyArgs} e - specifies the NotifyArgs\n     * @returns {void}\n     * @hidden\n     */\n    RowDD.prototype.onActionComplete = function (e) {\n        this.parent.trigger(events.actionComplete, extend(e, { type: events.actionComplete, requestType: 'rowdraganddrop' }));\n    };\n    RowDD.prototype.initializeDrag = function () {\n        var gObj = this.parent;\n        this.draggable = new Draggable(gObj.element, {\n            dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n            distance: 5,\n            helper: this.helper,\n            dragStart: this.dragStart,\n            drag: this.drag,\n            dragStop: this.dragStop,\n            isReplaceDragEle: this.isReplaceDragEle,\n            isPreventSelect: false,\n            isPreventScroll: true\n        });\n    };\n    RowDD.prototype.updateScrollPostion = function (e) {\n        var _this = this;\n        var y = getPosition(e).y;\n        var cliRect = this.isDropGrid.getContent().getBoundingClientRect();\n        var rowHeight = this.isDropGrid.getRowHeight() - 15;\n        var scrollElem = this.isDropGrid.getContent().firstElementChild;\n        var virtualScrollbtm = this.parent.enableVirtualization ? 20 : 0;\n        if (cliRect.top >= y) {\n            var scrollPixel_1 = -(this.isDropGrid.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_1); }, 200);\n        }\n        else if (cliRect.top + this.isDropGrid.getContent().clientHeight - rowHeight - 33 - virtualScrollbtm <= y) {\n            var scrollPixel_2 = (this.isDropGrid.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_2); }, 200);\n        }\n    };\n    RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel) {\n        scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n    };\n    RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        if (this.parent.element.classList.contains('e-childgrid')) {\n            var parentGrid = this.getParentGrid(this.parent.element);\n            cloneElement = parentGrid.querySelector('.e-cloneproperties');\n        }\n        var element = closestElement(e.target, 'tr');\n        if (parentsUntil(element, 'e-grid') &&\n            ((!this.parent.rowDropSettings.targetID &&\n                parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) || this.istargetGrid)) {\n            var targetElement = element;\n            if (!element) {\n                targetElement = startedRow;\n            }\n            this.setBorder(targetElement, e.event, startedRow, targetRow);\n        }\n    };\n    RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n        var node = this.parent.element;\n        if (this.istargetGrid) {\n            node = this.isDropGrid.element;\n        }\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n            this.removeBorder(element);\n        }\n        else {\n            this.removeFirstRowBorder(element);\n            this.removeLastRowBorder(element);\n        }\n        if (parentsUntil(element, 'e-grid') && element.classList.contains(literals.row) && ((!this.parent.rowDropSettings.targetID &&\n            parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) || this.istargetGrid)) {\n            if (this.parent.allowGrouping && this.parent.groupSettings.columns && this.parent.groupSettings.columns.length) {\n                removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'), ['e-dragtop', 'e-dragright',\n                    'e-dragbottom', 'e-dragleft']);\n            }\n            else {\n                removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'), ['e-dragborder']);\n            }\n            var rowElement = [];\n            var targetRowIndex = parseInt(targetRow.getAttribute(literals.ariaRowIndex), 10) - 1;\n            if (targetRow && targetRowIndex === 0 &&\n                !(this.isNewRowAdded() && this.parent.editSettings.newRowPosition === 'Top')) {\n                if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n                    element = targetRow;\n                    rowElement = [].slice.call(element\n                        .querySelectorAll('.e-groupcaption,.e-summarycell,.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n                }\n                else {\n                    var div = this.parent.createElement('div', { className: 'e-firstrow-dragborder' });\n                    var gridheaderEle = this.isDropGrid.getHeaderContent();\n                    gridheaderEle.classList.add('e-grid-relative');\n                    div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n                    if (!gridheaderEle.getElementsByClassName('e-firstrow-dragborder').length) {\n                        if (this.parent.frozenRows) {\n                            if (this.parent.isFrozenGrid()) {\n                                div.style.width = this.parent.getContent().firstElementChild.scrollWidth + 'px';\n                            }\n                            gridheaderEle.querySelector('thead').appendChild(div);\n                            div.style.position = 'relative';\n                        }\n                        else {\n                            gridheaderEle.appendChild(div);\n                        }\n                    }\n                }\n            }\n            else if (this.parent.rowDropSettings.targetID && targetRow) {\n                element = this.isDropGrid.getRowByIndex(targetRowIndex - 1);\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            else if (targetRow && parseInt(startedRow.getAttribute(literals.ariaRowIndex), 10) - 1 > targetRowIndex) {\n                if (this.parent.enableVirtualization && this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n                    targetRowIndex = this.parent.getDataRows().indexOf(targetRow);\n                }\n                if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n                    element = targetRow;\n                    rowElement = [].slice.call(element\n                        .querySelectorAll(\".e-groupcaption,.e-summarycell,.e-rowcell:not(.e-hide),.e-rowdragdrop:not(.e-hide),\\n                        .e-detailrowcollapse:not(.e-hide)\"));\n                }\n                else {\n                    if (targetRowIndex === 0 && this.isNewRowAdded() && this.parent.editSettings.newRowPosition === 'Top') {\n                        element = this.parent.element.querySelector('.e-row.e-addedrow tr');\n                    }\n                    else {\n                        element = this.parent.getRowByIndex(targetRowIndex - 1);\n                    }\n                    rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse,.e-dragindentcell'));\n                }\n            }\n            else {\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            if (rowElement.length > 0) {\n                if (this.parent.allowGrouping && this.parent.groupSettings.columns && this.parent.groupSettings.columns.length) {\n                    this.groupRowDDIndicator(rowElement, true);\n                }\n                else {\n                    addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n                }\n            }\n        }\n    };\n    RowDD.prototype.getScrollWidth = function () {\n        var scrollElem = this.parent.getContent().firstElementChild;\n        return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n    };\n    RowDD.prototype.removeFirstRowBorder = function (element) {\n        if (this.isDropGrid.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element &&\n            (element.rowIndex !== 0 || element.classList.contains('e-columnheader'))) {\n            remove(this.isDropGrid.element.getElementsByClassName('e-firstrow-dragborder')[0]);\n        }\n        else {\n            var addNewRow = this.parent.element.querySelector('.e-row.e-addedrow tr');\n            if (addNewRow && addNewRow.querySelector('.e-dragborder')) {\n                var rowElement = [].slice.call(addNewRow.\n                    querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse,.e-dragindentcell'));\n                addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n            }\n        }\n    };\n    RowDD.prototype.removeLastRowBorder = function (element) {\n        var islastRowIndex;\n        if (this.parent.enableVirtualization) {\n            islastRowIndex = element && parseInt(element.getAttribute(literals.ariaRowIndex), 10) - 1 !==\n                this.parent.renderModule.data.dataManager.dataSource.json.length - 1;\n        }\n        else {\n            var rowIndex = this.parent.enableInfiniteScrolling && this.parent.infiniteScrollSettings.enableCache &&\n                !this.parent.groupSettings.enableLazyLoading ?\n                this.parent.pageSettings.currentPage * this.parent.pageSettings.pageSize - 1 :\n                this.parent.getCurrentViewRecords().length - 1;\n            var lastRow = this.parent.getRowByIndex(rowIndex);\n            islastRowIndex = element && lastRow && lastRow.getAttribute('data-uid') !== element.getAttribute('data-uid');\n        }\n        if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n            remove(this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0]);\n        }\n    };\n    RowDD.prototype.removeBorder = function (element) {\n        this.removeFirstRowBorder(element);\n        if (!this.parent.rowDropSettings.targetID) {\n            this.removeLastRowBorder(element);\n        }\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n            element = ([].slice.call(this.isDropGrid.getContentTable().querySelectorAll('tr'))).filter(function (row) {\n                return row.querySelector('td.e-dragtop.e-dragbottom');\n            })[0];\n        }\n        else {\n            element = (this.isDropGrid.getRows()).filter(function (row) { return row.querySelector('td.e-dragborder'); })[0];\n        }\n        if (element) {\n            var rowElement = this.parent.allowGrouping && this.parent.groupSettings.columns.length ? [].slice.call(element\n                .querySelectorAll('.e-dragtop.e-dragbottom')) : [].slice.call(element.getElementsByClassName('e-dragborder'));\n            if (this.parent.allowGrouping && this.parent.groupSettings.columns && this.parent.groupSettings.columns.length) {\n                this.groupRowDDIndicator(rowElement, false);\n            }\n            else {\n                addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n            }\n        }\n    };\n    RowDD.prototype.getElementFromPosition = function (element, event) {\n        var position = getPosition(event);\n        element.style.display = 'none';\n        var target = document.elementFromPoint(position.x, position.y);\n        element.style.display = '';\n        return target;\n    };\n    RowDD.prototype.onDataBound = function () {\n        if (this.selectedRowColls.length > 0 && (this.parent.enableVirtualization || this.parent.allowRowDragAndDrop)) {\n            this.parent.selectRows(this.selectedRowColls);\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.getTargetIdx = function (targetRow) {\n        return targetRow ? parseInt(targetRow.getAttribute(literals.ariaRowIndex), 10) - 1 : 0;\n    };\n    RowDD.prototype.singleRowDrop = function (e) {\n        var targetRow = closestElement(e.target, 'tr');\n        var srcControl = e.droppedElement.parentElement.ej2_instances[0];\n        var currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n        this.reorderRow(this.startedRowIndex, currentIndex);\n    };\n    RowDD.prototype.columnDrop = function (e) {\n        var gObj = this.parent;\n        if (e.droppedElement.getAttribute('action') !== 'grouping' &&\n            (parentsUntil(e.target, literals.row) || parentsUntil(e.target, 'e-emptyrow') || parentsUntil(e.target, literals.gridContent))) {\n            var targetRow = closestElement(e.target, 'tr');\n            var srcControl = void 0;\n            var currentIndex = void 0;\n            var dragParentElement = document.querySelector('.e-drag-ref');\n            if ((e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' &&\n                (e.droppedElement.parentElement.id === gObj.element.id || (dragParentElement\n                    && dragParentElement.parentElement.id === gObj.element.id)))\n                || (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' &&\n                    e.droppedElement.parentElement.id !== gObj.element.id)) {\n                return;\n            }\n            if (e.droppedElement.parentElement.id !== gObj.element.id) {\n                if (dragParentElement) {\n                    srcControl = dragParentElement.parentElement.ej2_instances[0];\n                    remove(dragParentElement);\n                }\n                else {\n                    srcControl = e.droppedElement.parentElement.ej2_instances[0];\n                }\n            }\n            else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n                this.singleRowDrop(e);\n                return;\n            }\n            if (srcControl.element.id !== gObj.element.id && srcControl.rowDropSettings.targetID !== gObj.element.id) {\n                return;\n            }\n            var records = srcControl.getSelectedRecords();\n            var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n            if (e.target && e.target.classList.contains('e-content') && gObj.getCurrentViewRecords().length) {\n                var lastrow = gObj.getContentTable().querySelector('tr:last-child');\n                if (lastrow) {\n                    targetIndex = currentIndex = parseInt(lastrow.getAttribute(literals.ariaRowIndex), 10);\n                }\n            }\n            if (isNaN(targetIndex)) {\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                targetIndex = currentIndex = 0;\n            }\n            if (gObj.allowPaging) {\n                targetIndex = targetIndex + (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize;\n            }\n            //Todo: drag and drop mapper & BatchChanges\n            gObj.notify(events.rowsAdded, { toIndex: targetIndex, records: records });\n            gObj.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n            var selectedRows = srcControl.getSelectedRowIndexes();\n            var skip = srcControl.allowPaging ?\n                (srcControl.pageSettings.currentPage * srcControl.pageSettings.pageSize) - srcControl.pageSettings.pageSize : 0;\n            this.selectedRows = [];\n            for (var i = 0, len = records.length; i < len; i++) {\n                this.selectedRows.push(skip + selectedRows[parseInt(i.toString(), 10)]);\n            }\n            srcControl.notify(events.rowsRemoved, { indexes: this.selectedRows, records: records });\n            if (srcControl.dataSource instanceof DataManager && srcControl.dataSource.dataSource.offline) {\n                srcControl.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n            }\n        }\n    };\n    RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n        var gObj = this.parent;\n        if (!gObj.groupSettings.columns.length) {\n            //Todo: drag and drop mapper & BatchChanges\n            var skip = gObj.allowPaging ?\n                (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize : 0;\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            var fromIndex = fromIndexes;\n            toIndex = toIndex + skip;\n            this.selectedRows = gObj.getSelectedRowIndexes();\n            gObj.notify(events.rowPositionChanged, {\n                fromIndex: fromIndexes + skip,\n                toIndex: toIndex\n            });\n        }\n    };\n    RowDD.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.initializeDrag();\n        }\n    };\n    /**\n     * To destroy the print\n     *\n     * @returns {void}\n     * @hidden\n     */\n    RowDD.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (this.parent.isDestroyed || !gridElement || (!gridElement.querySelector('.' + literals.gridHeader) &&\n            !gridElement.querySelector('.' + literals.gridContent))) {\n            return;\n        }\n        this.draggable.destroy();\n        this.parent.off(events.initialEnd, this.initializeDrag);\n        this.parent.off(events.columnDrop, this.columnDrop);\n        this.parent.off(events.rowDragAndDropComplete, this.onActionComplete);\n        this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        this.parent.off(events.destroy, this.destroy);\n        //destory ejdrag and drop\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {string} returns the module name\n     * @private\n     */\n    RowDD.prototype.getModuleName = function () {\n        return 'rowDragAndDrop';\n    };\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    RowDD.prototype.processArgs = function (target) {\n        var gObj = this.parent;\n        var dragIdx = parseInt(this.startedRow.getAttribute(literals.ariaRowIndex), 10) - 1;\n        if ((gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false)\n            || gObj.getSelectedRecords().length === 0) {\n            if (gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache) {\n                this.rows = [this.startedRow];\n            }\n            else {\n                this.rows = [gObj.getRowByIndex(dragIdx)];\n            }\n            this.rowData = [gObj.getRowInfo((this.startedRow).querySelector('.' + literals.rowCell)).rowData];\n            if ((gObj.enableVirtualization || (gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings.enableCache))\n                && gObj.allowGrouping && gObj.groupSettings.columns.length && gObj.getSelectedRows().length) {\n                this.rows = gObj.getSelectedRows();\n                this.rowData = Array.from(this.rows, function (row) { return gObj.getRowObjectFromUID(row.getAttribute('data-uid')).data; });\n            }\n        }\n        else {\n            this.rows = gObj.getSelectedRows();\n            this.rowData = Array.from(this.rows, function (row) { return gObj.getRowObjectFromUID(row.getAttribute('data-uid')).data; });\n        }\n    };\n    return RowDD;\n}());\nexport { RowDD };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}