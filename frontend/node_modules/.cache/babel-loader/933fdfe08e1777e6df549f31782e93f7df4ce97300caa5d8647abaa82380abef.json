{"ast":null,"code":"import { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { Query, DataManager, Predicate, Deferred, UrlAdaptor, RemoteSaveAdaptor } from '@syncfusion/ej2-data';\nimport { setFormatter, isGroupAdaptive, getColumnByForeignKeyValue, refreshFilteredColsUid } from '../base/util';\nimport * as events from '../base/constant';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { CheckBoxFilterBase } from '../common/checkbox-filter-base';\n/**\n * Grid data module is used to generate query and data source.\n *\n * @hidden\n */\nvar Data = /** @class */function () {\n  /**\n   * Constructor for data module.\n   *\n   * @param {IGrid} parent - specifies the IGrid\n   * @param {ServiceLocator} serviceLocator - specifies the service locator\n   * @hidden\n   */\n  function Data(parent, serviceLocator) {\n    this.dataState = {\n      isPending: false,\n      resolver: null,\n      group: []\n    };\n    this.foreignKeyDataState = {\n      isPending: false,\n      resolver: null\n    };\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.initDataManager();\n    if (this.parent.isDestroyed || this.getModuleName() === 'foreignKey') {\n      return;\n    }\n    this.parent.on(events.rowsAdded, this.addRows, this);\n    this.parent.on(events.rowPositionChanged, this.reorderRows, this);\n    this.parent.on(events.rowsRemoved, this.removeRows, this);\n    this.parent.on(events.dataSourceModified, this.initDataManager, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on(events.updateData, this.crudActions, this);\n    this.parent.on(events.addDeleteAction, this.getData, this);\n    this.parent.on(events.autoCol, this.refreshFilteredCols, this);\n    this.parent.on(events.columnsPrepared, this.refreshFilteredCols, this);\n  }\n  Data.prototype.reorderRows = function (e) {\n    if (this.parent.getDataModule().isRemote()) {\n      this.parent.getCurrentViewRecords().splice(e.toIndex, 0, this.parent.getCurrentViewRecords().splice(e.fromIndex, 1)[0]);\n    } else {\n      this.dataManager.dataSource.json.splice(e.toIndex, 0, this.dataManager.dataSource.json.splice(e.fromIndex, 1)[0]);\n    }\n  };\n  Data.prototype.getModuleName = function () {\n    return 'data';\n  };\n  /**\n   * The function used to initialize dataManager and external query\n   *\n   * @returns {void}\n   */\n  Data.prototype.initDataManager = function () {\n    var gObj = this.parent;\n    this.dataManager = gObj.dataSource instanceof DataManager ? gObj.dataSource : isNullOrUndefined(gObj.dataSource) ? new DataManager() : new DataManager(gObj.dataSource);\n    if (gObj.isAngular && !(gObj.query instanceof Query)) {\n      gObj.setProperties({\n        query: new Query()\n      }, true);\n    } else {\n      this.isQueryInvokedFromData = true;\n      if (!(gObj.query instanceof Query)) {\n        gObj.query = new Query();\n      }\n    }\n  };\n  /**\n   * Generates a query based on the current grid configuration.\n   *\n   * @param {boolean} skipPage - If `true`, the query will exclude paging information.\n   * @param {boolean} skipGroup - If `true`, the query will exclude grouping information.\n   *\n   * @returns {Query} A query object reflecting the current grid state.\n   */\n  Data.prototype.generateQuery = function (skipPage, skipGroup) {\n    var gObj = this.parent;\n    var query = !isNullOrUndefined(gObj.getQuery()) ? gObj.getQuery().clone() : new Query();\n    if (this.parent.columnQueryMode === 'ExcludeHidden') {\n      query.select(this.parent.getColumns().filter(function (column) {\n        return !(column.isPrimaryKey !== true && column.visible === false || column.field === undefined);\n      }).map(function (column) {\n        return column.field;\n      }));\n    } else if (this.parent.columnQueryMode === 'Schema') {\n      var selectQueryFields = [];\n      var columns = this.parent.columns;\n      for (var i = 0; i < columns.length; i++) {\n        selectQueryFields.push(columns[parseInt(i.toString(), 10)].field);\n      }\n      query.select(selectQueryFields);\n    }\n    this.filterQuery(query);\n    this.searchQuery(query);\n    this.aggregateQuery(query);\n    this.sortQuery(query);\n    if (isGroupAdaptive(this.parent)) {\n      this.virtualGroupPageQuery(query);\n    } else {\n      this.pageQuery(query, skipPage);\n    }\n    if (isNullOrUndefined(skipGroup) || !skipGroup) {\n      this.groupQuery(query);\n    }\n    return query;\n  };\n  /**\n   * @param {Query} query - specifies the query\n   * @returns {Query} - returns the query\n   * @hidden\n   */\n  Data.prototype.aggregateQuery = function (query) {\n    var rows = this.parent.aggregates;\n    for (var i = 0; i < rows.length; i++) {\n      var row = rows[parseInt(i.toString(), 10)];\n      for (var j = 0; j < row.columns.length; j++) {\n        var cols = row.columns[parseInt(j.toString(), 10)];\n        var types = cols.type instanceof Array ? cols.type : [cols.type];\n        for (var k = 0; k < types.length; k++) {\n          query.aggregate(types[parseInt(k.toString(), 10)].toLowerCase(), cols.field);\n        }\n      }\n    }\n    return query;\n  };\n  Data.prototype.virtualGroupPageQuery = function (query) {\n    var fName = 'fn';\n    if (query.queries.length) {\n      for (var i = 0; i < query.queries.length; i++) {\n        if (query.queries[parseInt(i.toString(), 10)][\"\" + fName] === 'onPage') {\n          query.queries.splice(i, 1);\n        }\n      }\n    }\n    return query;\n  };\n  Data.prototype.pageQuery = function (query, skipPage) {\n    var gObj = this.parent;\n    var fName = 'fn';\n    var args = {\n      query: query,\n      skipPage: false\n    };\n    gObj.notify(events.setVirtualPageQuery, args);\n    if (args.skipPage) {\n      return query;\n    }\n    if ((gObj.allowPaging || gObj.enableVirtualization || gObj.enableInfiniteScrolling) && skipPage !== true) {\n      gObj.pageSettings.currentPage = Math.max(1, gObj.pageSettings.currentPage);\n      if (gObj.pageSettings.pageCount <= 0) {\n        gObj.pageSettings.pageCount = 8;\n      }\n      if (gObj.pageSettings.pageSize <= 0) {\n        gObj.pageSettings.pageSize = 12;\n      }\n      if (query.queries.length) {\n        for (var i = 0; i < query.queries.length; i++) {\n          if (query.queries[parseInt(i.toString(), 10)][\"\" + fName] === 'onPage') {\n            query.queries.splice(i, 1);\n          }\n        }\n      }\n      if (!isNullOrUndefined(gObj.infiniteScrollModule) && gObj.enableInfiniteScrolling) {\n        this.parent.notify(events.infinitePageQuery, query);\n      } else {\n        query.page(gObj.pageSettings.currentPage, gObj.allowPaging && gObj.pagerModule && gObj.pagerModule.pagerObj.isAllPage && !gObj.isManualRefresh && !this.dataManager.dataSource.offline && !(this.dataManager.adaptor instanceof RemoteSaveAdaptor) ? null : gObj.pageSettings.pageSize);\n      }\n    }\n    return query;\n  };\n  Data.prototype.groupQuery = function (query) {\n    var gObj = this.parent;\n    if (gObj.allowGrouping && gObj.groupSettings.columns.length) {\n      if (this.parent.groupSettings.enableLazyLoading) {\n        query.lazyLoad.push({\n          key: 'isLazyLoad',\n          value: this.parent.groupSettings.enableLazyLoading\n        });\n      }\n      var columns = gObj.groupSettings.columns;\n      for (var i = 0, len = columns.length; i < len; i++) {\n        var column = this.getColumnByField(columns[parseInt(i.toString(), 10)]);\n        if (!column) {\n          this.parent.log('initial_action', {\n            moduleName: 'group',\n            columnName: columns[parseInt(i.toString(), 10)]\n          });\n        }\n        var isGrpFmt = column.enableGroupByFormat;\n        var format = column.format;\n        if (isGrpFmt) {\n          query.group(columns[parseInt(i.toString(), 10)], this.formatGroupColumn.bind(this), format);\n        } else {\n          query.group(columns[parseInt(i.toString(), 10)], null);\n        }\n      }\n    }\n    return query;\n  };\n  Data.prototype.sortQuery = function (query) {\n    var gObj = this.parent;\n    if ((gObj.allowSorting || gObj.allowGrouping) && gObj.sortSettings.columns.length) {\n      var columns = gObj.sortSettings.columns;\n      var sortGrp = [];\n      for (var i = columns.length - 1; i > -1; i--) {\n        var col = this.getColumnByField(columns[parseInt(i.toString(), 10)].field);\n        if (col) {\n          col.setSortDirection(columns[parseInt(i.toString(), 10)].direction);\n        } else {\n          this.parent.log('initial_action', {\n            moduleName: 'sort',\n            columnName: columns[parseInt(i.toString(), 10)].field\n          });\n          return query;\n        }\n        var fn = columns[parseInt(i.toString(), 10)].direction;\n        if (col.sortComparer) {\n          this.parent.log('grid_sort_comparer');\n          fn = !this.isRemote() ? col.sortComparer.bind(col) : columns[parseInt(i.toString(), 10)].direction;\n        }\n        if (gObj.groupSettings.columns.indexOf(columns[parseInt(i.toString(), 10)].field) === -1) {\n          if (col.isForeignColumn() || col.sortComparer) {\n            query.sortByForeignKey(col.field, fn, undefined, columns[parseInt(i.toString(), 10)].direction.toLowerCase());\n          } else {\n            query.sortBy(col.field, fn);\n          }\n        } else {\n          sortGrp.push({\n            direction: fn,\n            field: col.field\n          });\n        }\n      }\n      for (var i = 0, len = sortGrp.length; i < len; i++) {\n        if (typeof sortGrp[parseInt(i.toString(), 10)].direction === 'string') {\n          query.sortBy(sortGrp[parseInt(i.toString(), 10)].field, sortGrp[parseInt(i.toString(), 10)].direction);\n        } else {\n          var col = this.getColumnByField(sortGrp[parseInt(i.toString(), 10)].field);\n          query.sortByForeignKey(sortGrp[parseInt(i.toString(), 10)].field, sortGrp[parseInt(i.toString(), 10)].direction, undefined, col.getSortDirection().toLowerCase());\n        }\n      }\n    }\n    return query;\n  };\n  /**\n   * @param {Query} query - specifies the query\n   * @param {Column} fcolumn - specifies the forein key column model\n   * @param {boolean} isForeignKey - Confirms whether the column is a foreign key or not\n   * @returns {Query} - returns the query\n   * @hidden\n   */\n  Data.prototype.searchQuery = function (query, fcolumn, isForeignKey) {\n    var sSettings = this.parent.searchSettings;\n    var fields = !isNullOrUndefined(sSettings.fields) && sSettings.fields.length ? sSettings.fields : this.getSearchColumnFieldNames();\n    var predicateList = [];\n    var needForeignKeySearch = false;\n    if (!isNullOrUndefined(this.parent.searchSettings.key) && this.parent.searchSettings.key.length) {\n      needForeignKeySearch = this.parent.getForeignKeyColumns().some(function (col) {\n        return fields.indexOf(col.field) > -1;\n      });\n      var adaptor = !isForeignKey ? this.dataManager.adaptor : fcolumn.dataSource.adaptor;\n      if (needForeignKeySearch || adaptor.getModuleName && adaptor.getModuleName() === 'ODataV4Adaptor') {\n        fields = isForeignKey ? [fcolumn.foreignKeyValue] : fields;\n        for (var i = 0; i < fields.length; i++) {\n          var column = isForeignKey ? fcolumn : this.getColumnByField(fields[parseInt(i.toString(), 10)]);\n          if (column.isForeignColumn() && !isForeignKey) {\n            predicateList = this.fGeneratePredicate(column, predicateList);\n          } else {\n            predicateList.push(new Predicate(fields[parseInt(i.toString(), 10)], sSettings.operator, sSettings.key, sSettings.ignoreCase, sSettings.ignoreAccent));\n          }\n        }\n        var predList = Predicate.or(predicateList);\n        predList.key = sSettings.key;\n        query.where(predList);\n      } else {\n        query.search(sSettings.key, fields, sSettings.operator, sSettings.ignoreCase, sSettings.ignoreAccent);\n      }\n    }\n    return query;\n  };\n  Data.prototype.filterQuery = function (query, column, skipFoerign) {\n    var gObj = this.parent;\n    var predicateList = [];\n    var actualFilter = [];\n    var foreignColumn = this.parent.getForeignKeyColumns();\n    var foreignColEmpty;\n    if (gObj.allowFiltering && gObj.filterSettings.columns.length) {\n      var columns = column ? column : gObj.filterSettings.columns;\n      var colType = {};\n      for (var _i = 0, _a = gObj.getColumns(); _i < _a.length; _i++) {\n        var col = _a[_i];\n        colType[col.field] = col.filter.type ? col.filter.type : gObj.filterSettings.type;\n      }\n      var foreignCols = [];\n      var defaultFltrCols = [];\n      for (var _b = 0, columns_1 = columns; _b < columns_1.length; _b++) {\n        var col = columns_1[_b];\n        var gridColumn = col.isForeignKey ? gObj.getColumnByUid(col.uid) : gObj.getColumnByField(col.field);\n        if (isNullOrUndefined(col.type) && gridColumn && (gridColumn.type === 'date' || gridColumn.type === 'datetime' || gridColumn.type === 'dateonly')) {\n          col.type = col.isForeignKey ? gObj.getColumnByUid(col.uid).type : gObj.getColumnByField(col.field).type;\n        }\n        if (col.isForeignKey) {\n          foreignCols.push(col);\n        } else {\n          defaultFltrCols.push(col);\n        }\n      }\n      if (defaultFltrCols.length) {\n        for (var i = 0, len = defaultFltrCols.length; i < len; i++) {\n          defaultFltrCols[parseInt(i.toString(), 10)].uid = defaultFltrCols[parseInt(i.toString(), 10)].uid || this.parent.grabColumnByFieldFromAllCols(defaultFltrCols[parseInt(i.toString(), 10)].field, defaultFltrCols[parseInt(i.toString(), 10)].isForeignKey).uid;\n        }\n        var excelPredicate = CheckBoxFilterBase.getPredicate(defaultFltrCols);\n        for (var _c = 0, _d = Object.keys(excelPredicate); _c < _d.length; _c++) {\n          var prop = _d[_c];\n          predicateList.push(excelPredicate[\"\" + prop]);\n        }\n      }\n      if (foreignCols.length) {\n        for (var _e = 0, foreignCols_1 = foreignCols; _e < foreignCols_1.length; _e++) {\n          var col = foreignCols_1[_e];\n          col.uid = col.uid || this.parent.grabColumnByFieldFromAllCols(col.field, col.isForeignKey).uid;\n          var column_1 = this.parent.grabColumnByUidFromAllCols(col.uid);\n          if (!column_1) {\n            this.parent.log('initial_action', {\n              moduleName: 'filter',\n              columnName: col.field\n            });\n          }\n          if (column_1.isForeignColumn() && getColumnByForeignKeyValue(col.field, foreignColumn) && !skipFoerign) {\n            actualFilter.push(col);\n            if (!column_1.columnData.length) {\n              foreignColEmpty = true;\n            }\n            predicateList = this.fGeneratePredicate(column_1, predicateList);\n          } else {\n            var excelPredicate = CheckBoxFilterBase.getPredicate(columns);\n            for (var _f = 0, _g = Object.keys(excelPredicate); _f < _g.length; _f++) {\n              var prop = _g[_f];\n              predicateList.push(excelPredicate[\"\" + prop]);\n            }\n          }\n        }\n      }\n      if (predicateList.length && !foreignColEmpty) {\n        query.where(Predicate.and(predicateList));\n      } else {\n        this.parent.notify(events.showEmptyGrid, {});\n      }\n    }\n    return query;\n  };\n  Data.prototype.fGeneratePredicate = function (col, predicateList) {\n    var fPredicate = {};\n    if (col) {\n      this.parent.notify(events.generateQuery, {\n        predicate: fPredicate,\n        column: col\n      });\n      if (fPredicate.predicate.predicates.length) {\n        predicateList.push(fPredicate.predicate);\n      }\n    }\n    return predicateList;\n  };\n  /**\n   * The function is used to get dataManager promise by executing given Query.\n   *\n   * @param {object} args - specifies the object\n   * @param {string} args.requestType - Defines the request type\n   * @param {string[]} args.foreignKeyData - Defines the foreignKeyData.string\n   * @param {Object} args.data - Defines the data.\n   * @param {number} args.index - Defines the index .\n   * @param {Query} query - Defines the query which will execute along with data processing.\n   * @returns {Promise<Object>} - returns the object\n   * @hidden\n   */\n  Data.prototype.getData = function (args, query) {\n    var _this = this;\n    if (args === void 0) {\n      args = {\n        requestType: ''\n      };\n    }\n    var key = this.getKey(args.foreignKeyData && Object.keys(args.foreignKeyData).length ? args.foreignKeyData : this.parent.getPrimaryKeyFieldNames());\n    this.parent.log('datasource_syntax_mismatch', {\n      dataState: this.parent\n    });\n    if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n      var def = this.eventPromise(args, query, key);\n      return def.promise;\n    } else {\n      var crud = void 0;\n      switch (args.requestType) {\n        case 'delete':\n          query = query ? query : this.generateQuery();\n          // eslint-disable-next-line no-case-declarations\n          var len = Object.keys(args.data).length;\n          if (len === 1) {\n            crud = this.dataManager.remove(key, args.data[0], query.fromTable, query);\n          } else {\n            var changes = {\n              addedRecords: [],\n              deletedRecords: [],\n              changedRecords: []\n            };\n            changes.deletedRecords = args.data;\n            crud = this.dataManager.saveChanges(changes, key, query.fromTable, query.requiresCount());\n          }\n          break;\n        case 'save':\n          query = query ? query : this.generateQuery();\n          args.index = isNullOrUndefined(args.index) ? 0 : args.index;\n          crud = this.dataManager.insert(args.data, query.fromTable, query, args.index);\n          break;\n      }\n      var promise = 'promise';\n      args[\"\" + promise] = crud;\n      // eslint-disable-next-line no-prototype-builtins\n      if (crud && !Array.isArray(crud) && !crud.hasOwnProperty('deletedRecords')) {\n        return crud.then(function () {\n          return _this.insert(query, args);\n        });\n      } else {\n        return this.insert(query, args);\n      }\n    }\n  };\n  Data.prototype.insert = function (query, args) {\n    if (args.requestType === 'save') {\n      args.query = query;\n      this.parent.notify(events.recordAdded, args);\n    }\n    return this.executeQuery(query);\n  };\n  Data.prototype.executeQuery = function (query) {\n    var _this = this;\n    if (this.dataManager.ready) {\n      var deferred_1 = new Deferred();\n      var ready = this.dataManager.ready;\n      ready.then(function () {\n        _this.dataManager.executeQuery(query).then(function (result) {\n          deferred_1.resolve(result);\n        });\n      }).catch(function (e) {\n        deferred_1.reject(e);\n      });\n      return deferred_1.promise;\n    } else {\n      return this.dataManager.executeQuery(query);\n    }\n  };\n  Data.prototype.formatGroupColumn = function (value, field) {\n    var serviceLocator = this.serviceLocator;\n    var column = this.getColumnByField(field);\n    var date = value;\n    if (!column.type) {\n      column.type = date.getDay ? date.getHours() > 0 || date.getMinutes() > 0 || date.getSeconds() > 0 || date.getMilliseconds() > 0 ? 'datetime' : 'date' : typeof value;\n    }\n    if (isNullOrUndefined(column.getFormatter())) {\n      setFormatter(serviceLocator, column);\n    }\n    var formatVal = ValueFormatter.prototype.toView(value, column.getFormatter());\n    return formatVal;\n  };\n  Data.prototype.crudActions = function (args) {\n    var query = this.generateQuery();\n    var promise = null;\n    var pr = 'promise';\n    var key = this.getKey(args.foreignKeyData && Object.keys(args.foreignKeyData).length ? args.foreignKeyData : this.parent.getPrimaryKeyFieldNames());\n    if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n      this.eventPromise(args, query, key);\n    }\n    switch (args.requestType) {\n      case 'save':\n        promise = this.dataManager.update(key, args.data, query.fromTable, query, args.previousData);\n        break;\n    }\n    args[\"\" + pr] = promise ? promise : args[\"\" + pr];\n    this.parent.notify(events.crudAction, args);\n  };\n  /**\n   * @param {object} changes - specifies the changes\n   * @param {string} key - specifies the key\n   * @param {object} original - specifies the original data\n   * @param {Query} query - specifies the query\n   * @returns {Promise<Object>} returns the object\n   * @hidden\n   */\n  Data.prototype.saveChanges = function (changes, key, original, query) {\n    if (query === void 0) {\n      query = this.generateQuery();\n    }\n    query.requiresCount();\n    if ('result' in this.parent.dataSource) {\n      var deff = new Deferred();\n      var args = {\n        requestType: 'batchsave',\n        changes: changes,\n        key: key,\n        query: query,\n        endEdit: deff.resolve\n      };\n      this.setState({\n        isPending: true,\n        resolver: deff.resolve\n      });\n      this.parent.trigger(events.dataSourceChanged, args);\n      return deff.promise;\n    } else {\n      var promise = this.dataManager.saveChanges(changes, key, query.fromTable, query, original);\n      return promise;\n    }\n  };\n  Data.prototype.getKey = function (keys) {\n    if (keys && keys.length) {\n      return keys[0];\n    }\n    return undefined;\n  };\n  /**\n   * @returns {boolean} returns whether its remote data\n   * @hidden\n   */\n  Data.prototype.isRemote = function () {\n    return this.dataManager.dataSource.offline !== true && this.dataManager.dataSource.url !== undefined && this.dataManager.dataSource.url !== '';\n  };\n  Data.prototype.addRows = function (e) {\n    for (var i = e.records.length; i > 0; i--) {\n      if (this.parent.dataSource instanceof DataManager && this.dataManager.dataSource.offline) {\n        this.dataManager.dataSource.json.splice(e.toIndex, 0, e.records[i - 1]);\n      } else if (!this.parent.getDataModule().isRemote() && !isNullOrUndefined(this.parent.dataSource) && !this.parent.dataSource.result) {\n        this.parent.dataSource['splice'](e.toIndex, 0, e.records[i - 1]);\n      }\n    }\n  };\n  Data.prototype.removeRows = function (e) {\n    var json = this.dataManager.dataSource.json;\n    if (this.parent.dataSource instanceof DataManager && this.dataManager.dataSource.offline) {\n      this.dataManager.dataSource.json = json.filter(function (value) {\n        return e.records.indexOf(value) === -1;\n      });\n    } else if (!this.parent.getDataModule().isRemote() && !isNullOrUndefined(this.parent.dataSource) && !this.parent.dataSource.result) {\n      this.parent.dataSource = json.filter(function (value) {\n        return e.records.indexOf(value) === -1;\n      });\n    }\n  };\n  Data.prototype.getColumnByField = function (field) {\n    var col;\n    return this.parent.columnModel.some(function (column) {\n      col = column;\n      return column.field === field;\n    }) && col;\n  };\n  Data.prototype.destroy = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.off(events.rowsAdded, this.addRows);\n    this.parent.off(events.rowsRemoved, this.removeRows);\n    this.parent.off(events.dataSourceModified, this.initDataManager);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off(events.updateData, this.crudActions);\n    this.parent.off(events.addDeleteAction, this.getData);\n    this.parent.off(events.autoCol, this.refreshFilteredCols);\n    this.parent.off(events.columnsPrepared, this.refreshFilteredCols);\n  };\n  Data.prototype.getState = function () {\n    return this.dataState;\n  };\n  Data.prototype.setState = function (state) {\n    return this.dataState = state;\n  };\n  Data.prototype.getForeignKeyDataState = function () {\n    return this.foreignKeyDataState;\n  };\n  Data.prototype.setForeignKeyDataState = function (state) {\n    this.foreignKeyDataState = state;\n  };\n  Data.prototype.getStateEventArgument = function (query) {\n    var adaptr = new UrlAdaptor();\n    var dm = new DataManager({\n      url: '',\n      adaptor: new UrlAdaptor()\n    });\n    var state = adaptr.processQuery(dm, query);\n    var data = JSON.parse(state.data);\n    return extend(data, state.pvtData);\n  };\n  Data.prototype.eventPromise = function (args, query, key) {\n    var _this = this;\n    var dataArgs = args;\n    var state = this.getStateEventArgument(query);\n    var def = new Deferred();\n    var deff = new Deferred();\n    if ((args.requestType !== undefined || this.parent.groupSettings.disablePageWiseAggregates && query.queries.some(function (query) {\n      return query.fn === 'onGroup';\n    })) && this.dataState.isDataChanged !== false) {\n      state.action = args;\n      if (args.requestType === 'save' || args.requestType === 'delete' || args.requestType === 'batchsave') {\n        var editArgs_1 = args;\n        editArgs_1.key = key;\n        var promise = 'promise';\n        editArgs_1[\"\" + promise] = deff.promise;\n        editArgs_1.state = state;\n        this.setState({\n          isPending: true,\n          resolver: deff.resolve\n        });\n        dataArgs.endEdit = deff.resolve;\n        dataArgs.cancelEdit = deff.reject;\n        this.parent.trigger(events.dataSourceChanged, editArgs_1);\n        deff.promise.then(function () {\n          _this.setState({\n            isPending: true,\n            resolver: def.resolve,\n            group: state.group,\n            aggregates: state.aggregates\n          });\n          if (editArgs_1.requestType === 'save') {\n            _this.parent.notify(events.recordAdded, editArgs_1);\n          }\n          _this.parent.trigger(events.dataStateChange, state);\n        }).catch(function () {\n          return void 0;\n        });\n      } else {\n        this.setState({\n          isPending: true,\n          resolver: def.resolve,\n          group: state.group,\n          aggregates: state.aggregates\n        });\n        this.parent.trigger(events.dataStateChange, state);\n      }\n    } else {\n      this.setState({});\n      def.resolve(this.parent.dataSource);\n    }\n    return def;\n  };\n  /**\n   * Gets the columns where searching needs to be performed from the Grid.\n   *\n   * @returns {string[]} returns the searched column field names\n   */\n  Data.prototype.getSearchColumnFieldNames = function () {\n    var colFieldNames = [];\n    var columns = this.parent.getColumns();\n    for (var _i = 0, columns_2 = columns; _i < columns_2.length; _i++) {\n      var col = columns_2[_i];\n      if (col.allowSearching && !isNullOrUndefined(col.field)) {\n        colFieldNames.push(col.field);\n      }\n    }\n    return colFieldNames;\n  };\n  Data.prototype.refreshFilteredCols = function () {\n    if (this.parent.allowFiltering && this.parent.filterSettings.columns.length) {\n      refreshFilteredColsUid(this.parent, this.parent.filterSettings.columns);\n    }\n  };\n  return Data;\n}();\nexport { Data };","map":{"version":3,"names":["isNullOrUndefined","extend","Query","DataManager","Predicate","Deferred","UrlAdaptor","RemoteSaveAdaptor","setFormatter","isGroupAdaptive","getColumnByForeignKeyValue","refreshFilteredColsUid","events","ValueFormatter","CheckBoxFilterBase","Data","parent","serviceLocator","dataState","isPending","resolver","group","foreignKeyDataState","initDataManager","isDestroyed","getModuleName","on","rowsAdded","addRows","rowPositionChanged","reorderRows","rowsRemoved","removeRows","dataSourceModified","destroy","updateData","crudActions","addDeleteAction","getData","autoCol","refreshFilteredCols","columnsPrepared","prototype","e","getDataModule","isRemote","getCurrentViewRecords","splice","toIndex","fromIndex","dataManager","dataSource","json","gObj","isAngular","query","setProperties","isQueryInvokedFromData","generateQuery","skipPage","skipGroup","getQuery","clone","columnQueryMode","select","getColumns","filter","column","isPrimaryKey","visible","field","undefined","map","selectQueryFields","columns","i","length","push","parseInt","toString","filterQuery","searchQuery","aggregateQuery","sortQuery","virtualGroupPageQuery","pageQuery","groupQuery","rows","aggregates","row","j","cols","types","type","Array","k","aggregate","toLowerCase","fName","queries","args","notify","setVirtualPageQuery","allowPaging","enableVirtualization","enableInfiniteScrolling","pageSettings","currentPage","Math","max","pageCount","pageSize","infiniteScrollModule","infinitePageQuery","page","pagerModule","pagerObj","isAllPage","isManualRefresh","offline","adaptor","allowGrouping","groupSettings","enableLazyLoading","lazyLoad","key","value","len","getColumnByField","log","moduleName","columnName","isGrpFmt","enableGroupByFormat","format","formatGroupColumn","bind","allowSorting","sortSettings","sortGrp","col","setSortDirection","direction","fn","sortComparer","indexOf","isForeignColumn","sortByForeignKey","sortBy","getSortDirection","fcolumn","isForeignKey","sSettings","searchSettings","fields","getSearchColumnFieldNames","predicateList","needForeignKeySearch","getForeignKeyColumns","some","foreignKeyValue","fGeneratePredicate","operator","ignoreCase","ignoreAccent","predList","or","where","search","skipFoerign","actualFilter","foreignColumn","foreignColEmpty","allowFiltering","filterSettings","colType","_i","_a","foreignCols","defaultFltrCols","_b","columns_1","gridColumn","getColumnByUid","uid","grabColumnByFieldFromAllCols","excelPredicate","getPredicate","_c","_d","Object","keys","prop","_e","foreignCols_1","column_1","grabColumnByUidFromAllCols","columnData","_f","_g","and","showEmptyGrid","fPredicate","predicate","predicates","_this","requestType","getKey","foreignKeyData","getPrimaryKeyFieldNames","def","eventPromise","promise","crud","data","remove","fromTable","changes","addedRecords","deletedRecords","changedRecords","saveChanges","requiresCount","index","insert","isArray","hasOwnProperty","then","recordAdded","executeQuery","ready","deferred_1","result","resolve","catch","reject","date","getDay","getHours","getMinutes","getSeconds","getMilliseconds","getFormatter","formatVal","toView","pr","update","previousData","crudAction","original","deff","endEdit","setState","trigger","dataSourceChanged","url","records","columnModel","off","getState","state","getForeignKeyDataState","setForeignKeyDataState","getStateEventArgument","adaptr","dm","processQuery","JSON","parse","pvtData","dataArgs","disablePageWiseAggregates","isDataChanged","action","editArgs_1","cancelEdit","dataStateChange","colFieldNames","columns_2","allowSearching"],"sources":["D:/weektable/frontend/node_modules/@syncfusion/ej2-grids/src/grid/actions/data.js"],"sourcesContent":["import { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { Query, DataManager, Predicate, Deferred, UrlAdaptor, RemoteSaveAdaptor } from '@syncfusion/ej2-data';\nimport { setFormatter, isGroupAdaptive, getColumnByForeignKeyValue, refreshFilteredColsUid } from '../base/util';\nimport * as events from '../base/constant';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { CheckBoxFilterBase } from '../common/checkbox-filter-base';\n/**\n * Grid data module is used to generate query and data source.\n *\n * @hidden\n */\nvar Data = /** @class */ (function () {\n    /**\n     * Constructor for data module.\n     *\n     * @param {IGrid} parent - specifies the IGrid\n     * @param {ServiceLocator} serviceLocator - specifies the service locator\n     * @hidden\n     */\n    function Data(parent, serviceLocator) {\n        this.dataState = { isPending: false, resolver: null, group: [] };\n        this.foreignKeyDataState = { isPending: false, resolver: null };\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.initDataManager();\n        if (this.parent.isDestroyed || this.getModuleName() === 'foreignKey') {\n            return;\n        }\n        this.parent.on(events.rowsAdded, this.addRows, this);\n        this.parent.on(events.rowPositionChanged, this.reorderRows, this);\n        this.parent.on(events.rowsRemoved, this.removeRows, this);\n        this.parent.on(events.dataSourceModified, this.initDataManager, this);\n        this.parent.on(events.destroy, this.destroy, this);\n        this.parent.on(events.updateData, this.crudActions, this);\n        this.parent.on(events.addDeleteAction, this.getData, this);\n        this.parent.on(events.autoCol, this.refreshFilteredCols, this);\n        this.parent.on(events.columnsPrepared, this.refreshFilteredCols, this);\n    }\n    Data.prototype.reorderRows = function (e) {\n        if (this.parent.getDataModule().isRemote()) {\n            this.parent.getCurrentViewRecords().splice(e.toIndex, 0, this.parent.getCurrentViewRecords().splice(e.fromIndex, 1)[0]);\n        }\n        else {\n            this.dataManager.dataSource.json.splice(e.toIndex, 0, this.dataManager.dataSource.json.splice(e.fromIndex, 1)[0]);\n        }\n    };\n    Data.prototype.getModuleName = function () {\n        return 'data';\n    };\n    /**\n     * The function used to initialize dataManager and external query\n     *\n     * @returns {void}\n     */\n    Data.prototype.initDataManager = function () {\n        var gObj = this.parent;\n        this.dataManager = gObj.dataSource instanceof DataManager ? gObj.dataSource :\n            (isNullOrUndefined(gObj.dataSource) ? new DataManager() : new DataManager(gObj.dataSource));\n        if (gObj.isAngular && !(gObj.query instanceof Query)) {\n            gObj.setProperties({ query: new Query() }, true);\n        }\n        else {\n            this.isQueryInvokedFromData = true;\n            if (!(gObj.query instanceof Query)) {\n                gObj.query = new Query();\n            }\n        }\n    };\n    /**\n     * Generates a query based on the current grid configuration.\n     *\n     * @param {boolean} skipPage - If `true`, the query will exclude paging information.\n     * @param {boolean} skipGroup - If `true`, the query will exclude grouping information.\n     *\n     * @returns {Query} A query object reflecting the current grid state.\n     */\n    Data.prototype.generateQuery = function (skipPage, skipGroup) {\n        var gObj = this.parent;\n        var query = !isNullOrUndefined(gObj.getQuery()) ? gObj.getQuery().clone() : new Query();\n        if (this.parent.columnQueryMode === 'ExcludeHidden') {\n            query.select(this.parent.getColumns().filter(function (column) { return !(column.isPrimaryKey !== true && column.visible === false || column.field === undefined); }).map(function (column) { return column.field; }));\n        }\n        else if (this.parent.columnQueryMode === 'Schema') {\n            var selectQueryFields = [];\n            var columns = this.parent.columns;\n            for (var i = 0; i < columns.length; i++) {\n                selectQueryFields.push(columns[parseInt(i.toString(), 10)].field);\n            }\n            query.select(selectQueryFields);\n        }\n        this.filterQuery(query);\n        this.searchQuery(query);\n        this.aggregateQuery(query);\n        this.sortQuery(query);\n        if (isGroupAdaptive(this.parent)) {\n            this.virtualGroupPageQuery(query);\n        }\n        else {\n            this.pageQuery(query, skipPage);\n        }\n        if (isNullOrUndefined(skipGroup) || !skipGroup) {\n            this.groupQuery(query);\n        }\n        return query;\n    };\n    /**\n     * @param {Query} query - specifies the query\n     * @returns {Query} - returns the query\n     * @hidden\n     */\n    Data.prototype.aggregateQuery = function (query) {\n        var rows = this.parent.aggregates;\n        for (var i = 0; i < rows.length; i++) {\n            var row = rows[parseInt(i.toString(), 10)];\n            for (var j = 0; j < row.columns.length; j++) {\n                var cols = row.columns[parseInt(j.toString(), 10)];\n                var types = cols.type instanceof Array ? cols.type : [cols.type];\n                for (var k = 0; k < types.length; k++) {\n                    query.aggregate(types[parseInt(k.toString(), 10)].toLowerCase(), cols.field);\n                }\n            }\n        }\n        return query;\n    };\n    Data.prototype.virtualGroupPageQuery = function (query) {\n        var fName = 'fn';\n        if (query.queries.length) {\n            for (var i = 0; i < query.queries.length; i++) {\n                if (query.queries[parseInt(i.toString(), 10)][\"\" + fName] === 'onPage') {\n                    query.queries.splice(i, 1);\n                }\n            }\n        }\n        return query;\n    };\n    Data.prototype.pageQuery = function (query, skipPage) {\n        var gObj = this.parent;\n        var fName = 'fn';\n        var args = { query: query, skipPage: false };\n        gObj.notify(events.setVirtualPageQuery, args);\n        if (args.skipPage) {\n            return query;\n        }\n        if ((gObj.allowPaging || gObj.enableVirtualization || gObj.enableInfiniteScrolling) && skipPage !== true) {\n            gObj.pageSettings.currentPage = Math.max(1, gObj.pageSettings.currentPage);\n            if (gObj.pageSettings.pageCount <= 0) {\n                gObj.pageSettings.pageCount = 8;\n            }\n            if (gObj.pageSettings.pageSize <= 0) {\n                gObj.pageSettings.pageSize = 12;\n            }\n            if (query.queries.length) {\n                for (var i = 0; i < query.queries.length; i++) {\n                    if (query.queries[parseInt(i.toString(), 10)][\"\" + fName] === 'onPage') {\n                        query.queries.splice(i, 1);\n                    }\n                }\n            }\n            if (!isNullOrUndefined(gObj.infiniteScrollModule) && gObj.enableInfiniteScrolling) {\n                this.parent.notify(events.infinitePageQuery, query);\n            }\n            else {\n                query.page(gObj.pageSettings.currentPage, gObj.allowPaging && gObj.pagerModule &&\n                    (gObj.pagerModule.pagerObj.isAllPage && !gObj.isManualRefresh) &&\n                    (!this.dataManager.dataSource.offline && !(this.dataManager.adaptor instanceof RemoteSaveAdaptor)) ?\n                    null : gObj.pageSettings.pageSize);\n            }\n        }\n        return query;\n    };\n    Data.prototype.groupQuery = function (query) {\n        var gObj = this.parent;\n        if (gObj.allowGrouping && gObj.groupSettings.columns.length) {\n            if (this.parent.groupSettings.enableLazyLoading) {\n                query.lazyLoad.push({ key: 'isLazyLoad', value: this.parent.groupSettings.enableLazyLoading });\n            }\n            var columns = gObj.groupSettings.columns;\n            for (var i = 0, len = columns.length; i < len; i++) {\n                var column = this.getColumnByField(columns[parseInt(i.toString(), 10)]);\n                if (!column) {\n                    this.parent.log('initial_action', { moduleName: 'group', columnName: columns[parseInt(i.toString(), 10)] });\n                }\n                var isGrpFmt = column.enableGroupByFormat;\n                var format = column.format;\n                if (isGrpFmt) {\n                    query.group(columns[parseInt(i.toString(), 10)], this.formatGroupColumn.bind(this), format);\n                }\n                else {\n                    query.group(columns[parseInt(i.toString(), 10)], null);\n                }\n            }\n        }\n        return query;\n    };\n    Data.prototype.sortQuery = function (query) {\n        var gObj = this.parent;\n        if ((gObj.allowSorting || gObj.allowGrouping) && gObj.sortSettings.columns.length) {\n            var columns = gObj.sortSettings.columns;\n            var sortGrp = [];\n            for (var i = columns.length - 1; i > -1; i--) {\n                var col = this.getColumnByField(columns[parseInt(i.toString(), 10)].field);\n                if (col) {\n                    col.setSortDirection(columns[parseInt(i.toString(), 10)].direction);\n                }\n                else {\n                    this.parent.log('initial_action', { moduleName: 'sort', columnName: columns[parseInt(i.toString(), 10)].field });\n                    return query;\n                }\n                var fn = columns[parseInt(i.toString(), 10)].direction;\n                if (col.sortComparer) {\n                    this.parent.log('grid_sort_comparer');\n                    fn = !this.isRemote() ? col.sortComparer.bind(col) : columns[parseInt(i.toString(), 10)].direction;\n                }\n                if (gObj.groupSettings.columns.indexOf(columns[parseInt(i.toString(), 10)].field) === -1) {\n                    if (col.isForeignColumn() || col.sortComparer) {\n                        query.sortByForeignKey(col.field, fn, undefined, columns[parseInt(i.toString(), 10)].direction.toLowerCase());\n                    }\n                    else {\n                        query.sortBy(col.field, fn);\n                    }\n                }\n                else {\n                    sortGrp.push({ direction: fn, field: col.field });\n                }\n            }\n            for (var i = 0, len = sortGrp.length; i < len; i++) {\n                if (typeof sortGrp[parseInt(i.toString(), 10)].direction === 'string') {\n                    query.sortBy(sortGrp[parseInt(i.toString(), 10)].field, sortGrp[parseInt(i.toString(), 10)].direction);\n                }\n                else {\n                    var col = this.getColumnByField(sortGrp[parseInt(i.toString(), 10)].field);\n                    query.sortByForeignKey(sortGrp[parseInt(i.toString(), 10)].field, sortGrp[parseInt(i.toString(), 10)].direction, undefined, col.getSortDirection().toLowerCase());\n                }\n            }\n        }\n        return query;\n    };\n    /**\n     * @param {Query} query - specifies the query\n     * @param {Column} fcolumn - specifies the forein key column model\n     * @param {boolean} isForeignKey - Confirms whether the column is a foreign key or not\n     * @returns {Query} - returns the query\n     * @hidden\n     */\n    Data.prototype.searchQuery = function (query, fcolumn, isForeignKey) {\n        var sSettings = this.parent.searchSettings;\n        var fields = (!isNullOrUndefined(sSettings.fields) && sSettings.fields.length) ? sSettings.fields\n            : this.getSearchColumnFieldNames();\n        var predicateList = [];\n        var needForeignKeySearch = false;\n        if (!isNullOrUndefined(this.parent.searchSettings.key) && this.parent.searchSettings.key.length) {\n            needForeignKeySearch = this.parent.getForeignKeyColumns().some(function (col) { return fields.indexOf(col.field) > -1; });\n            var adaptor = !isForeignKey ? this.dataManager.adaptor : fcolumn.dataSource.adaptor;\n            if (needForeignKeySearch || (adaptor.getModuleName &&\n                adaptor.getModuleName() === 'ODataV4Adaptor')) {\n                fields = isForeignKey ? [fcolumn.foreignKeyValue] : fields;\n                for (var i = 0; i < fields.length; i++) {\n                    var column = isForeignKey ? fcolumn : this.getColumnByField(fields[parseInt(i.toString(), 10)]);\n                    if (column.isForeignColumn() && !isForeignKey) {\n                        predicateList = this.fGeneratePredicate(column, predicateList);\n                    }\n                    else {\n                        predicateList.push(new Predicate(fields[parseInt(i.toString(), 10)], sSettings.operator, sSettings.key, sSettings.ignoreCase, sSettings.ignoreAccent));\n                    }\n                }\n                var predList = Predicate.or(predicateList);\n                predList.key = sSettings.key;\n                query.where(predList);\n            }\n            else {\n                query.search(sSettings.key, fields, sSettings.operator, sSettings.ignoreCase, sSettings.ignoreAccent);\n            }\n        }\n        return query;\n    };\n    Data.prototype.filterQuery = function (query, column, skipFoerign) {\n        var gObj = this.parent;\n        var predicateList = [];\n        var actualFilter = [];\n        var foreignColumn = this.parent.getForeignKeyColumns();\n        var foreignColEmpty;\n        if (gObj.allowFiltering && gObj.filterSettings.columns.length) {\n            var columns = column ? column : gObj.filterSettings.columns;\n            var colType = {};\n            for (var _i = 0, _a = gObj.getColumns(); _i < _a.length; _i++) {\n                var col = _a[_i];\n                colType[col.field] = col.filter.type ? col.filter.type : gObj.filterSettings.type;\n            }\n            var foreignCols = [];\n            var defaultFltrCols = [];\n            for (var _b = 0, columns_1 = columns; _b < columns_1.length; _b++) {\n                var col = columns_1[_b];\n                var gridColumn = col.isForeignKey ? gObj.getColumnByUid(col.uid) : gObj.getColumnByField(col.field);\n                if (isNullOrUndefined(col.type) && gridColumn && (gridColumn.type === 'date' || gridColumn.type === 'datetime' || gridColumn.type === 'dateonly')) {\n                    col.type = col.isForeignKey ? gObj.getColumnByUid(col.uid).type : gObj.getColumnByField(col.field).type;\n                }\n                if (col.isForeignKey) {\n                    foreignCols.push(col);\n                }\n                else {\n                    defaultFltrCols.push(col);\n                }\n            }\n            if (defaultFltrCols.length) {\n                for (var i = 0, len = defaultFltrCols.length; i < len; i++) {\n                    defaultFltrCols[parseInt(i.toString(), 10)].uid = defaultFltrCols[parseInt(i.toString(), 10)].uid ||\n                        this.parent.grabColumnByFieldFromAllCols(defaultFltrCols[parseInt(i.toString(), 10)]\n                            .field, defaultFltrCols[parseInt(i.toString(), 10)].isForeignKey).uid;\n                }\n                var excelPredicate = CheckBoxFilterBase.getPredicate(defaultFltrCols);\n                for (var _c = 0, _d = Object.keys(excelPredicate); _c < _d.length; _c++) {\n                    var prop = _d[_c];\n                    predicateList.push(excelPredicate[\"\" + prop]);\n                }\n            }\n            if (foreignCols.length) {\n                for (var _e = 0, foreignCols_1 = foreignCols; _e < foreignCols_1.length; _e++) {\n                    var col = foreignCols_1[_e];\n                    col.uid = col.uid || this.parent.grabColumnByFieldFromAllCols(col.field, col.isForeignKey).uid;\n                    var column_1 = this.parent.grabColumnByUidFromAllCols(col.uid);\n                    if (!column_1) {\n                        this.parent.log('initial_action', { moduleName: 'filter', columnName: col.field });\n                    }\n                    if (column_1.isForeignColumn() && getColumnByForeignKeyValue(col.field, foreignColumn) && !skipFoerign) {\n                        actualFilter.push(col);\n                        if (!column_1.columnData.length) {\n                            foreignColEmpty = true;\n                        }\n                        predicateList = this.fGeneratePredicate(column_1, predicateList);\n                    }\n                    else {\n                        var excelPredicate = CheckBoxFilterBase.getPredicate(columns);\n                        for (var _f = 0, _g = Object.keys(excelPredicate); _f < _g.length; _f++) {\n                            var prop = _g[_f];\n                            predicateList.push(excelPredicate[\"\" + prop]);\n                        }\n                    }\n                }\n            }\n            if (predicateList.length && !foreignColEmpty) {\n                query.where(Predicate.and(predicateList));\n            }\n            else {\n                this.parent.notify(events.showEmptyGrid, {});\n            }\n        }\n        return query;\n    };\n    Data.prototype.fGeneratePredicate = function (col, predicateList) {\n        var fPredicate = {};\n        if (col) {\n            this.parent.notify(events.generateQuery, { predicate: fPredicate, column: col });\n            if (fPredicate.predicate.predicates.length) {\n                predicateList.push(fPredicate.predicate);\n            }\n        }\n        return predicateList;\n    };\n    /**\n     * The function is used to get dataManager promise by executing given Query.\n     *\n     * @param {object} args - specifies the object\n     * @param {string} args.requestType - Defines the request type\n     * @param {string[]} args.foreignKeyData - Defines the foreignKeyData.string\n     * @param {Object} args.data - Defines the data.\n     * @param {number} args.index - Defines the index .\n     * @param {Query} query - Defines the query which will execute along with data processing.\n     * @returns {Promise<Object>} - returns the object\n     * @hidden\n     */\n    Data.prototype.getData = function (args, query) {\n        var _this = this;\n        if (args === void 0) { args = { requestType: '' }; }\n        var key = this.getKey(args.foreignKeyData &&\n            Object.keys(args.foreignKeyData).length ?\n            args.foreignKeyData : this.parent.getPrimaryKeyFieldNames());\n        this.parent.log('datasource_syntax_mismatch', { dataState: this.parent });\n        if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n            var def = this.eventPromise(args, query, key);\n            return def.promise;\n        }\n        else {\n            var crud = void 0;\n            switch (args.requestType) {\n                case 'delete':\n                    query = query ? query : this.generateQuery();\n                    // eslint-disable-next-line no-case-declarations\n                    var len = Object.keys(args.data).length;\n                    if (len === 1) {\n                        crud = this.dataManager.remove(key, args.data[0], query.fromTable, query);\n                    }\n                    else {\n                        var changes = {\n                            addedRecords: [],\n                            deletedRecords: [],\n                            changedRecords: []\n                        };\n                        changes.deletedRecords = args.data;\n                        crud = this.dataManager.saveChanges(changes, key, query.fromTable, query.requiresCount());\n                    }\n                    break;\n                case 'save':\n                    query = query ? query : this.generateQuery();\n                    args.index = isNullOrUndefined(args.index) ? 0 : args.index;\n                    crud = this.dataManager.insert(args.data, query.fromTable, query, args.index);\n                    break;\n            }\n            var promise = 'promise';\n            args[\"\" + promise] = crud;\n            // eslint-disable-next-line no-prototype-builtins\n            if (crud && !Array.isArray(crud) && !crud.hasOwnProperty('deletedRecords')) {\n                return crud.then(function () {\n                    return _this.insert(query, args);\n                });\n            }\n            else {\n                return this.insert(query, args);\n            }\n        }\n    };\n    Data.prototype.insert = function (query, args) {\n        if (args.requestType === 'save') {\n            args.query = query;\n            this.parent.notify(events.recordAdded, args);\n        }\n        return this.executeQuery(query);\n    };\n    Data.prototype.executeQuery = function (query) {\n        var _this = this;\n        if (this.dataManager.ready) {\n            var deferred_1 = new Deferred();\n            var ready = this.dataManager.ready;\n            ready.then(function () {\n                _this.dataManager.executeQuery(query).then(function (result) {\n                    deferred_1.resolve(result);\n                });\n            }).catch(function (e) {\n                deferred_1.reject(e);\n            });\n            return deferred_1.promise;\n        }\n        else {\n            return this.dataManager.executeQuery(query);\n        }\n    };\n    Data.prototype.formatGroupColumn = function (value, field) {\n        var serviceLocator = this.serviceLocator;\n        var column = this.getColumnByField(field);\n        var date = value;\n        if (!column.type) {\n            column.type = date.getDay ? (date.getHours() > 0 || date.getMinutes() > 0 ||\n                date.getSeconds() > 0 || date.getMilliseconds() > 0 ? 'datetime' : 'date') : typeof (value);\n        }\n        if (isNullOrUndefined(column.getFormatter())) {\n            setFormatter(serviceLocator, column);\n        }\n        var formatVal = ValueFormatter.prototype.toView(value, column.getFormatter());\n        return formatVal;\n    };\n    Data.prototype.crudActions = function (args) {\n        var query = this.generateQuery();\n        var promise = null;\n        var pr = 'promise';\n        var key = this.getKey(args.foreignKeyData &&\n            Object.keys(args.foreignKeyData).length ? args.foreignKeyData :\n            this.parent.getPrimaryKeyFieldNames());\n        if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n            this.eventPromise(args, query, key);\n        }\n        switch (args.requestType) {\n            case 'save':\n                promise = this.dataManager.update(key, args.data, query.fromTable, query, args.previousData);\n                break;\n        }\n        args[\"\" + pr] = promise ? promise : args[\"\" + pr];\n        this.parent.notify(events.crudAction, args);\n    };\n    /**\n     * @param {object} changes - specifies the changes\n     * @param {string} key - specifies the key\n     * @param {object} original - specifies the original data\n     * @param {Query} query - specifies the query\n     * @returns {Promise<Object>} returns the object\n     * @hidden\n     */\n    Data.prototype.saveChanges = function (changes, key, original, query) {\n        if (query === void 0) { query = this.generateQuery(); }\n        query.requiresCount();\n        if ('result' in this.parent.dataSource) {\n            var deff = new Deferred();\n            var args = {\n                requestType: 'batchsave', changes: changes, key: key, query: query,\n                endEdit: deff.resolve\n            };\n            this.setState({ isPending: true, resolver: deff.resolve });\n            this.parent.trigger(events.dataSourceChanged, args);\n            return deff.promise;\n        }\n        else {\n            var promise = this.dataManager.saveChanges(changes, key, query.fromTable, query, original);\n            return promise;\n        }\n    };\n    Data.prototype.getKey = function (keys) {\n        if (keys && keys.length) {\n            return keys[0];\n        }\n        return undefined;\n    };\n    /**\n     * @returns {boolean} returns whether its remote data\n     * @hidden\n     */\n    Data.prototype.isRemote = function () {\n        return this.dataManager.dataSource.offline !== true && this.dataManager.dataSource.url !== undefined &&\n            this.dataManager.dataSource.url !== '';\n    };\n    Data.prototype.addRows = function (e) {\n        for (var i = e.records.length; i > 0; i--) {\n            if (this.parent.dataSource instanceof DataManager && this.dataManager.dataSource.offline) {\n                this.dataManager.dataSource.json.splice(e.toIndex, 0, e.records[i - 1]);\n            }\n            else if (((!this.parent.getDataModule().isRemote()) && (!isNullOrUndefined(this.parent.dataSource))) &&\n                (!this.parent.dataSource.result)) {\n                this.parent.dataSource['splice'](e.toIndex, 0, e.records[i - 1]);\n            }\n        }\n    };\n    Data.prototype.removeRows = function (e) {\n        var json = this.dataManager.dataSource.json;\n        if (this.parent.dataSource instanceof DataManager && this.dataManager.dataSource.offline) {\n            this.dataManager.dataSource.json = json.filter(function (value) { return e.records.indexOf(value) === -1; });\n        }\n        else if (((!this.parent.getDataModule().isRemote()) && (!isNullOrUndefined(this.parent.dataSource))) &&\n            (!this.parent.dataSource.result)) {\n            this.parent.dataSource = json.filter(function (value) { return e.records.indexOf(value) === -1; });\n        }\n    };\n    Data.prototype.getColumnByField = function (field) {\n        var col;\n        return (this.parent.columnModel).some(function (column) {\n            col = column;\n            return column.field === field;\n        }) && col;\n    };\n    Data.prototype.destroy = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.rowsAdded, this.addRows);\n        this.parent.off(events.rowsRemoved, this.removeRows);\n        this.parent.off(events.dataSourceModified, this.initDataManager);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.off(events.updateData, this.crudActions);\n        this.parent.off(events.addDeleteAction, this.getData);\n        this.parent.off(events.autoCol, this.refreshFilteredCols);\n        this.parent.off(events.columnsPrepared, this.refreshFilteredCols);\n    };\n    Data.prototype.getState = function () {\n        return this.dataState;\n    };\n    Data.prototype.setState = function (state) {\n        return this.dataState = state;\n    };\n    Data.prototype.getForeignKeyDataState = function () {\n        return this.foreignKeyDataState;\n    };\n    Data.prototype.setForeignKeyDataState = function (state) {\n        this.foreignKeyDataState = state;\n    };\n    Data.prototype.getStateEventArgument = function (query) {\n        var adaptr = new UrlAdaptor();\n        var dm = new DataManager({ url: '', adaptor: new UrlAdaptor });\n        var state = adaptr.processQuery(dm, query);\n        var data = JSON.parse(state.data);\n        return extend(data, state.pvtData);\n    };\n    Data.prototype.eventPromise = function (args, query, key) {\n        var _this = this;\n        var dataArgs = args;\n        var state = this.getStateEventArgument(query);\n        var def = new Deferred();\n        var deff = new Deferred();\n        if ((args.requestType !== undefined || (this.parent.groupSettings.disablePageWiseAggregates && query.queries.some(function (query) { return query.fn === 'onGroup'; })))\n            && this.dataState.isDataChanged !== false) {\n            state.action = args;\n            if (args.requestType === 'save' || args.requestType === 'delete' || args.requestType === 'batchsave') {\n                var editArgs_1 = args;\n                editArgs_1.key = key;\n                var promise = 'promise';\n                editArgs_1[\"\" + promise] = deff.promise;\n                editArgs_1.state = state;\n                this.setState({ isPending: true, resolver: deff.resolve });\n                dataArgs.endEdit = deff.resolve;\n                dataArgs.cancelEdit = deff.reject;\n                this.parent.trigger(events.dataSourceChanged, editArgs_1);\n                deff.promise.then(function () {\n                    _this.setState({ isPending: true, resolver: def.resolve, group: state.group, aggregates: state.aggregates });\n                    if (editArgs_1.requestType === 'save') {\n                        _this.parent.notify(events.recordAdded, editArgs_1);\n                    }\n                    _this.parent.trigger(events.dataStateChange, state);\n                })\n                    .catch(function () { return void 0; });\n            }\n            else {\n                this.setState({ isPending: true, resolver: def.resolve, group: state.group, aggregates: state.aggregates });\n                this.parent.trigger(events.dataStateChange, state);\n            }\n        }\n        else {\n            this.setState({});\n            def.resolve(this.parent.dataSource);\n        }\n        return def;\n    };\n    /**\n     * Gets the columns where searching needs to be performed from the Grid.\n     *\n     * @returns {string[]} returns the searched column field names\n     */\n    Data.prototype.getSearchColumnFieldNames = function () {\n        var colFieldNames = [];\n        var columns = this.parent.getColumns();\n        for (var _i = 0, columns_2 = columns; _i < columns_2.length; _i++) {\n            var col = columns_2[_i];\n            if (col.allowSearching && !isNullOrUndefined(col.field)) {\n                colFieldNames.push(col.field);\n            }\n        }\n        return colFieldNames;\n    };\n    Data.prototype.refreshFilteredCols = function () {\n        if (this.parent.allowFiltering && this.parent.filterSettings.columns.length) {\n            refreshFilteredColsUid(this.parent, this.parent.filterSettings.columns);\n        }\n    };\n    return Data;\n}());\nexport { Data };\n"],"mappings":"AAAA,SAASA,iBAAiB,EAAEC,MAAM,QAAQ,sBAAsB;AAChE,SAASC,KAAK,EAAEC,WAAW,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,UAAU,EAAEC,iBAAiB,QAAQ,sBAAsB;AAC7G,SAASC,YAAY,EAAEC,eAAe,EAAEC,0BAA0B,EAAEC,sBAAsB,QAAQ,cAAc;AAChH,OAAO,KAAKC,MAAM,MAAM,kBAAkB;AAC1C,SAASC,cAAc,QAAQ,6BAA6B;AAC5D,SAASC,kBAAkB,QAAQ,gCAAgC;AACnE;AACA;AACA;AACA;AACA;AACA,IAAIC,IAAI,GAAG,aAAe,YAAY;EAClC;AACJ;AACA;AACA;AACA;AACA;AACA;EACI,SAASA,IAAIA,CAACC,MAAM,EAAEC,cAAc,EAAE;IAClC,IAAI,CAACC,SAAS,GAAG;MAAEC,SAAS,EAAE,KAAK;MAAEC,QAAQ,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAG,CAAC;IAChE,IAAI,CAACC,mBAAmB,GAAG;MAAEH,SAAS,EAAE,KAAK;MAAEC,QAAQ,EAAE;IAAK,CAAC;IAC/D,IAAI,CAACJ,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,cAAc,GAAGA,cAAc;IACpC,IAAI,CAACM,eAAe,CAAC,CAAC;IACtB,IAAI,IAAI,CAACP,MAAM,CAACQ,WAAW,IAAI,IAAI,CAACC,aAAa,CAAC,CAAC,KAAK,YAAY,EAAE;MAClE;IACJ;IACA,IAAI,CAACT,MAAM,CAACU,EAAE,CAACd,MAAM,CAACe,SAAS,EAAE,IAAI,CAACC,OAAO,EAAE,IAAI,CAAC;IACpD,IAAI,CAACZ,MAAM,CAACU,EAAE,CAACd,MAAM,CAACiB,kBAAkB,EAAE,IAAI,CAACC,WAAW,EAAE,IAAI,CAAC;IACjE,IAAI,CAACd,MAAM,CAACU,EAAE,CAACd,MAAM,CAACmB,WAAW,EAAE,IAAI,CAACC,UAAU,EAAE,IAAI,CAAC;IACzD,IAAI,CAAChB,MAAM,CAACU,EAAE,CAACd,MAAM,CAACqB,kBAAkB,EAAE,IAAI,CAACV,eAAe,EAAE,IAAI,CAAC;IACrE,IAAI,CAACP,MAAM,CAACU,EAAE,CAACd,MAAM,CAACsB,OAAO,EAAE,IAAI,CAACA,OAAO,EAAE,IAAI,CAAC;IAClD,IAAI,CAAClB,MAAM,CAACU,EAAE,CAACd,MAAM,CAACuB,UAAU,EAAE,IAAI,CAACC,WAAW,EAAE,IAAI,CAAC;IACzD,IAAI,CAACpB,MAAM,CAACU,EAAE,CAACd,MAAM,CAACyB,eAAe,EAAE,IAAI,CAACC,OAAO,EAAE,IAAI,CAAC;IAC1D,IAAI,CAACtB,MAAM,CAACU,EAAE,CAACd,MAAM,CAAC2B,OAAO,EAAE,IAAI,CAACC,mBAAmB,EAAE,IAAI,CAAC;IAC9D,IAAI,CAACxB,MAAM,CAACU,EAAE,CAACd,MAAM,CAAC6B,eAAe,EAAE,IAAI,CAACD,mBAAmB,EAAE,IAAI,CAAC;EAC1E;EACAzB,IAAI,CAAC2B,SAAS,CAACZ,WAAW,GAAG,UAAUa,CAAC,EAAE;IACtC,IAAI,IAAI,CAAC3B,MAAM,CAAC4B,aAAa,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE;MACxC,IAAI,CAAC7B,MAAM,CAAC8B,qBAAqB,CAAC,CAAC,CAACC,MAAM,CAACJ,CAAC,CAACK,OAAO,EAAE,CAAC,EAAE,IAAI,CAAChC,MAAM,CAAC8B,qBAAqB,CAAC,CAAC,CAACC,MAAM,CAACJ,CAAC,CAACM,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3H,CAAC,MACI;MACD,IAAI,CAACC,WAAW,CAACC,UAAU,CAACC,IAAI,CAACL,MAAM,CAACJ,CAAC,CAACK,OAAO,EAAE,CAAC,EAAE,IAAI,CAACE,WAAW,CAACC,UAAU,CAACC,IAAI,CAACL,MAAM,CAACJ,CAAC,CAACM,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACrH;EACJ,CAAC;EACDlC,IAAI,CAAC2B,SAAS,CAACjB,aAAa,GAAG,YAAY;IACvC,OAAO,MAAM;EACjB,CAAC;EACD;AACJ;AACA;AACA;AACA;EACIV,IAAI,CAAC2B,SAAS,CAACnB,eAAe,GAAG,YAAY;IACzC,IAAI8B,IAAI,GAAG,IAAI,CAACrC,MAAM;IACtB,IAAI,CAACkC,WAAW,GAAGG,IAAI,CAACF,UAAU,YAAYhD,WAAW,GAAGkD,IAAI,CAACF,UAAU,GACtEnD,iBAAiB,CAACqD,IAAI,CAACF,UAAU,CAAC,GAAG,IAAIhD,WAAW,CAAC,CAAC,GAAG,IAAIA,WAAW,CAACkD,IAAI,CAACF,UAAU,CAAE;IAC/F,IAAIE,IAAI,CAACC,SAAS,IAAI,EAAED,IAAI,CAACE,KAAK,YAAYrD,KAAK,CAAC,EAAE;MAClDmD,IAAI,CAACG,aAAa,CAAC;QAAED,KAAK,EAAE,IAAIrD,KAAK,CAAC;MAAE,CAAC,EAAE,IAAI,CAAC;IACpD,CAAC,MACI;MACD,IAAI,CAACuD,sBAAsB,GAAG,IAAI;MAClC,IAAI,EAAEJ,IAAI,CAACE,KAAK,YAAYrD,KAAK,CAAC,EAAE;QAChCmD,IAAI,CAACE,KAAK,GAAG,IAAIrD,KAAK,CAAC,CAAC;MAC5B;IACJ;EACJ,CAAC;EACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIa,IAAI,CAAC2B,SAAS,CAACgB,aAAa,GAAG,UAAUC,QAAQ,EAAEC,SAAS,EAAE;IAC1D,IAAIP,IAAI,GAAG,IAAI,CAACrC,MAAM;IACtB,IAAIuC,KAAK,GAAG,CAACvD,iBAAiB,CAACqD,IAAI,CAACQ,QAAQ,CAAC,CAAC,CAAC,GAAGR,IAAI,CAACQ,QAAQ,CAAC,CAAC,CAACC,KAAK,CAAC,CAAC,GAAG,IAAI5D,KAAK,CAAC,CAAC;IACvF,IAAI,IAAI,CAACc,MAAM,CAAC+C,eAAe,KAAK,eAAe,EAAE;MACjDR,KAAK,CAACS,MAAM,CAAC,IAAI,CAAChD,MAAM,CAACiD,UAAU,CAAC,CAAC,CAACC,MAAM,CAAC,UAAUC,MAAM,EAAE;QAAE,OAAO,EAAEA,MAAM,CAACC,YAAY,KAAK,IAAI,IAAID,MAAM,CAACE,OAAO,KAAK,KAAK,IAAIF,MAAM,CAACG,KAAK,KAAKC,SAAS,CAAC;MAAE,CAAC,CAAC,CAACC,GAAG,CAAC,UAAUL,MAAM,EAAE;QAAE,OAAOA,MAAM,CAACG,KAAK;MAAE,CAAC,CAAC,CAAC;IAC1N,CAAC,MACI,IAAI,IAAI,CAACtD,MAAM,CAAC+C,eAAe,KAAK,QAAQ,EAAE;MAC/C,IAAIU,iBAAiB,GAAG,EAAE;MAC1B,IAAIC,OAAO,GAAG,IAAI,CAAC1D,MAAM,CAAC0D,OAAO;MACjC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,OAAO,CAACE,MAAM,EAAED,CAAC,EAAE,EAAE;QACrCF,iBAAiB,CAACI,IAAI,CAACH,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACT,KAAK,CAAC;MACrE;MACAf,KAAK,CAACS,MAAM,CAACS,iBAAiB,CAAC;IACnC;IACA,IAAI,CAACO,WAAW,CAACzB,KAAK,CAAC;IACvB,IAAI,CAAC0B,WAAW,CAAC1B,KAAK,CAAC;IACvB,IAAI,CAAC2B,cAAc,CAAC3B,KAAK,CAAC;IAC1B,IAAI,CAAC4B,SAAS,CAAC5B,KAAK,CAAC;IACrB,IAAI9C,eAAe,CAAC,IAAI,CAACO,MAAM,CAAC,EAAE;MAC9B,IAAI,CAACoE,qBAAqB,CAAC7B,KAAK,CAAC;IACrC,CAAC,MACI;MACD,IAAI,CAAC8B,SAAS,CAAC9B,KAAK,EAAEI,QAAQ,CAAC;IACnC;IACA,IAAI3D,iBAAiB,CAAC4D,SAAS,CAAC,IAAI,CAACA,SAAS,EAAE;MAC5C,IAAI,CAAC0B,UAAU,CAAC/B,KAAK,CAAC;IAC1B;IACA,OAAOA,KAAK;EAChB,CAAC;EACD;AACJ;AACA;AACA;AACA;EACIxC,IAAI,CAAC2B,SAAS,CAACwC,cAAc,GAAG,UAAU3B,KAAK,EAAE;IAC7C,IAAIgC,IAAI,GAAG,IAAI,CAACvE,MAAM,CAACwE,UAAU;IACjC,KAAK,IAAIb,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGY,IAAI,CAACX,MAAM,EAAED,CAAC,EAAE,EAAE;MAClC,IAAIc,GAAG,GAAGF,IAAI,CAACT,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;MAC1C,KAAK,IAAIW,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,GAAG,CAACf,OAAO,CAACE,MAAM,EAAEc,CAAC,EAAE,EAAE;QACzC,IAAIC,IAAI,GAAGF,GAAG,CAACf,OAAO,CAACI,QAAQ,CAACY,CAAC,CAACX,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QAClD,IAAIa,KAAK,GAAGD,IAAI,CAACE,IAAI,YAAYC,KAAK,GAAGH,IAAI,CAACE,IAAI,GAAG,CAACF,IAAI,CAACE,IAAI,CAAC;QAChE,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,KAAK,CAAChB,MAAM,EAAEmB,CAAC,EAAE,EAAE;UACnCxC,KAAK,CAACyC,SAAS,CAACJ,KAAK,CAACd,QAAQ,CAACiB,CAAC,CAAChB,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACkB,WAAW,CAAC,CAAC,EAAEN,IAAI,CAACrB,KAAK,CAAC;QAChF;MACJ;IACJ;IACA,OAAOf,KAAK;EAChB,CAAC;EACDxC,IAAI,CAAC2B,SAAS,CAAC0C,qBAAqB,GAAG,UAAU7B,KAAK,EAAE;IACpD,IAAI2C,KAAK,GAAG,IAAI;IAChB,IAAI3C,KAAK,CAAC4C,OAAO,CAACvB,MAAM,EAAE;MACtB,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGpB,KAAK,CAAC4C,OAAO,CAACvB,MAAM,EAAED,CAAC,EAAE,EAAE;QAC3C,IAAIpB,KAAK,CAAC4C,OAAO,CAACrB,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,GAAGmB,KAAK,CAAC,KAAK,QAAQ,EAAE;UACpE3C,KAAK,CAAC4C,OAAO,CAACpD,MAAM,CAAC4B,CAAC,EAAE,CAAC,CAAC;QAC9B;MACJ;IACJ;IACA,OAAOpB,KAAK;EAChB,CAAC;EACDxC,IAAI,CAAC2B,SAAS,CAAC2C,SAAS,GAAG,UAAU9B,KAAK,EAAEI,QAAQ,EAAE;IAClD,IAAIN,IAAI,GAAG,IAAI,CAACrC,MAAM;IACtB,IAAIkF,KAAK,GAAG,IAAI;IAChB,IAAIE,IAAI,GAAG;MAAE7C,KAAK,EAAEA,KAAK;MAAEI,QAAQ,EAAE;IAAM,CAAC;IAC5CN,IAAI,CAACgD,MAAM,CAACzF,MAAM,CAAC0F,mBAAmB,EAAEF,IAAI,CAAC;IAC7C,IAAIA,IAAI,CAACzC,QAAQ,EAAE;MACf,OAAOJ,KAAK;IAChB;IACA,IAAI,CAACF,IAAI,CAACkD,WAAW,IAAIlD,IAAI,CAACmD,oBAAoB,IAAInD,IAAI,CAACoD,uBAAuB,KAAK9C,QAAQ,KAAK,IAAI,EAAE;MACtGN,IAAI,CAACqD,YAAY,CAACC,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAExD,IAAI,CAACqD,YAAY,CAACC,WAAW,CAAC;MAC1E,IAAItD,IAAI,CAACqD,YAAY,CAACI,SAAS,IAAI,CAAC,EAAE;QAClCzD,IAAI,CAACqD,YAAY,CAACI,SAAS,GAAG,CAAC;MACnC;MACA,IAAIzD,IAAI,CAACqD,YAAY,CAACK,QAAQ,IAAI,CAAC,EAAE;QACjC1D,IAAI,CAACqD,YAAY,CAACK,QAAQ,GAAG,EAAE;MACnC;MACA,IAAIxD,KAAK,CAAC4C,OAAO,CAACvB,MAAM,EAAE;QACtB,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGpB,KAAK,CAAC4C,OAAO,CAACvB,MAAM,EAAED,CAAC,EAAE,EAAE;UAC3C,IAAIpB,KAAK,CAAC4C,OAAO,CAACrB,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,GAAGmB,KAAK,CAAC,KAAK,QAAQ,EAAE;YACpE3C,KAAK,CAAC4C,OAAO,CAACpD,MAAM,CAAC4B,CAAC,EAAE,CAAC,CAAC;UAC9B;QACJ;MACJ;MACA,IAAI,CAAC3E,iBAAiB,CAACqD,IAAI,CAAC2D,oBAAoB,CAAC,IAAI3D,IAAI,CAACoD,uBAAuB,EAAE;QAC/E,IAAI,CAACzF,MAAM,CAACqF,MAAM,CAACzF,MAAM,CAACqG,iBAAiB,EAAE1D,KAAK,CAAC;MACvD,CAAC,MACI;QACDA,KAAK,CAAC2D,IAAI,CAAC7D,IAAI,CAACqD,YAAY,CAACC,WAAW,EAAEtD,IAAI,CAACkD,WAAW,IAAIlD,IAAI,CAAC8D,WAAW,IACzE9D,IAAI,CAAC8D,WAAW,CAACC,QAAQ,CAACC,SAAS,IAAI,CAAChE,IAAI,CAACiE,eAAgB,IAC7D,CAAC,IAAI,CAACpE,WAAW,CAACC,UAAU,CAACoE,OAAO,IAAI,EAAE,IAAI,CAACrE,WAAW,CAACsE,OAAO,YAAYjH,iBAAiB,CAAE,GAClG,IAAI,GAAG8C,IAAI,CAACqD,YAAY,CAACK,QAAQ,CAAC;MAC1C;IACJ;IACA,OAAOxD,KAAK;EAChB,CAAC;EACDxC,IAAI,CAAC2B,SAAS,CAAC4C,UAAU,GAAG,UAAU/B,KAAK,EAAE;IACzC,IAAIF,IAAI,GAAG,IAAI,CAACrC,MAAM;IACtB,IAAIqC,IAAI,CAACoE,aAAa,IAAIpE,IAAI,CAACqE,aAAa,CAAChD,OAAO,CAACE,MAAM,EAAE;MACzD,IAAI,IAAI,CAAC5D,MAAM,CAAC0G,aAAa,CAACC,iBAAiB,EAAE;QAC7CpE,KAAK,CAACqE,QAAQ,CAAC/C,IAAI,CAAC;UAAEgD,GAAG,EAAE,YAAY;UAAEC,KAAK,EAAE,IAAI,CAAC9G,MAAM,CAAC0G,aAAa,CAACC;QAAkB,CAAC,CAAC;MAClG;MACA,IAAIjD,OAAO,GAAGrB,IAAI,CAACqE,aAAa,CAAChD,OAAO;MACxC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEoD,GAAG,GAAGrD,OAAO,CAACE,MAAM,EAAED,CAAC,GAAGoD,GAAG,EAAEpD,CAAC,EAAE,EAAE;QAChD,IAAIR,MAAM,GAAG,IAAI,CAAC6D,gBAAgB,CAACtD,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;QACvE,IAAI,CAACZ,MAAM,EAAE;UACT,IAAI,CAACnD,MAAM,CAACiH,GAAG,CAAC,gBAAgB,EAAE;YAAEC,UAAU,EAAE,OAAO;YAAEC,UAAU,EAAEzD,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC;UAAE,CAAC,CAAC;QAC/G;QACA,IAAIqD,QAAQ,GAAGjE,MAAM,CAACkE,mBAAmB;QACzC,IAAIC,MAAM,GAAGnE,MAAM,CAACmE,MAAM;QAC1B,IAAIF,QAAQ,EAAE;UACV7E,KAAK,CAAClC,KAAK,CAACqD,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,CAACwD,iBAAiB,CAACC,IAAI,CAAC,IAAI,CAAC,EAAEF,MAAM,CAAC;QAC/F,CAAC,MACI;UACD/E,KAAK,CAAClC,KAAK,CAACqD,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC;QAC1D;MACJ;IACJ;IACA,OAAOxB,KAAK;EAChB,CAAC;EACDxC,IAAI,CAAC2B,SAAS,CAACyC,SAAS,GAAG,UAAU5B,KAAK,EAAE;IACxC,IAAIF,IAAI,GAAG,IAAI,CAACrC,MAAM;IACtB,IAAI,CAACqC,IAAI,CAACoF,YAAY,IAAIpF,IAAI,CAACoE,aAAa,KAAKpE,IAAI,CAACqF,YAAY,CAAChE,OAAO,CAACE,MAAM,EAAE;MAC/E,IAAIF,OAAO,GAAGrB,IAAI,CAACqF,YAAY,CAAChE,OAAO;MACvC,IAAIiE,OAAO,GAAG,EAAE;MAChB,KAAK,IAAIhE,CAAC,GAAGD,OAAO,CAACE,MAAM,GAAG,CAAC,EAAED,CAAC,GAAG,CAAC,CAAC,EAAEA,CAAC,EAAE,EAAE;QAC1C,IAAIiE,GAAG,GAAG,IAAI,CAACZ,gBAAgB,CAACtD,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACT,KAAK,CAAC;QAC1E,IAAIsE,GAAG,EAAE;UACLA,GAAG,CAACC,gBAAgB,CAACnE,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC+D,SAAS,CAAC;QACvE,CAAC,MACI;UACD,IAAI,CAAC9H,MAAM,CAACiH,GAAG,CAAC,gBAAgB,EAAE;YAAEC,UAAU,EAAE,MAAM;YAAEC,UAAU,EAAEzD,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACT;UAAM,CAAC,CAAC;UAChH,OAAOf,KAAK;QAChB;QACA,IAAIwF,EAAE,GAAGrE,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC+D,SAAS;QACtD,IAAIF,GAAG,CAACI,YAAY,EAAE;UAClB,IAAI,CAAChI,MAAM,CAACiH,GAAG,CAAC,oBAAoB,CAAC;UACrCc,EAAE,GAAG,CAAC,IAAI,CAAClG,QAAQ,CAAC,CAAC,GAAG+F,GAAG,CAACI,YAAY,CAACR,IAAI,CAACI,GAAG,CAAC,GAAGlE,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC+D,SAAS;QACtG;QACA,IAAIzF,IAAI,CAACqE,aAAa,CAAChD,OAAO,CAACuE,OAAO,CAACvE,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACT,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;UACtF,IAAIsE,GAAG,CAACM,eAAe,CAAC,CAAC,IAAIN,GAAG,CAACI,YAAY,EAAE;YAC3CzF,KAAK,CAAC4F,gBAAgB,CAACP,GAAG,CAACtE,KAAK,EAAEyE,EAAE,EAAExE,SAAS,EAAEG,OAAO,CAACI,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC+D,SAAS,CAAC7C,WAAW,CAAC,CAAC,CAAC;UACjH,CAAC,MACI;YACD1C,KAAK,CAAC6F,MAAM,CAACR,GAAG,CAACtE,KAAK,EAAEyE,EAAE,CAAC;UAC/B;QACJ,CAAC,MACI;UACDJ,OAAO,CAAC9D,IAAI,CAAC;YAAEiE,SAAS,EAAEC,EAAE;YAAEzE,KAAK,EAAEsE,GAAG,CAACtE;UAAM,CAAC,CAAC;QACrD;MACJ;MACA,KAAK,IAAIK,CAAC,GAAG,CAAC,EAAEoD,GAAG,GAAGY,OAAO,CAAC/D,MAAM,EAAED,CAAC,GAAGoD,GAAG,EAAEpD,CAAC,EAAE,EAAE;QAChD,IAAI,OAAOgE,OAAO,CAAC7D,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC+D,SAAS,KAAK,QAAQ,EAAE;UACnEvF,KAAK,CAAC6F,MAAM,CAACT,OAAO,CAAC7D,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACT,KAAK,EAAEqE,OAAO,CAAC7D,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC+D,SAAS,CAAC;QAC1G,CAAC,MACI;UACD,IAAIF,GAAG,GAAG,IAAI,CAACZ,gBAAgB,CAACW,OAAO,CAAC7D,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACT,KAAK,CAAC;UAC1Ef,KAAK,CAAC4F,gBAAgB,CAACR,OAAO,CAAC7D,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACT,KAAK,EAAEqE,OAAO,CAAC7D,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC+D,SAAS,EAAEvE,SAAS,EAAEqE,GAAG,CAACS,gBAAgB,CAAC,CAAC,CAACpD,WAAW,CAAC,CAAC,CAAC;QACrK;MACJ;IACJ;IACA,OAAO1C,KAAK;EAChB,CAAC;EACD;AACJ;AACA;AACA;AACA;AACA;AACA;EACIxC,IAAI,CAAC2B,SAAS,CAACuC,WAAW,GAAG,UAAU1B,KAAK,EAAE+F,OAAO,EAAEC,YAAY,EAAE;IACjE,IAAIC,SAAS,GAAG,IAAI,CAACxI,MAAM,CAACyI,cAAc;IAC1C,IAAIC,MAAM,GAAI,CAAC1J,iBAAiB,CAACwJ,SAAS,CAACE,MAAM,CAAC,IAAIF,SAAS,CAACE,MAAM,CAAC9E,MAAM,GAAI4E,SAAS,CAACE,MAAM,GAC3F,IAAI,CAACC,yBAAyB,CAAC,CAAC;IACtC,IAAIC,aAAa,GAAG,EAAE;IACtB,IAAIC,oBAAoB,GAAG,KAAK;IAChC,IAAI,CAAC7J,iBAAiB,CAAC,IAAI,CAACgB,MAAM,CAACyI,cAAc,CAAC5B,GAAG,CAAC,IAAI,IAAI,CAAC7G,MAAM,CAACyI,cAAc,CAAC5B,GAAG,CAACjD,MAAM,EAAE;MAC7FiF,oBAAoB,GAAG,IAAI,CAAC7I,MAAM,CAAC8I,oBAAoB,CAAC,CAAC,CAACC,IAAI,CAAC,UAAUnB,GAAG,EAAE;QAAE,OAAOc,MAAM,CAACT,OAAO,CAACL,GAAG,CAACtE,KAAK,CAAC,GAAG,CAAC,CAAC;MAAE,CAAC,CAAC;MACzH,IAAIkD,OAAO,GAAG,CAAC+B,YAAY,GAAG,IAAI,CAACrG,WAAW,CAACsE,OAAO,GAAG8B,OAAO,CAACnG,UAAU,CAACqE,OAAO;MACnF,IAAIqC,oBAAoB,IAAKrC,OAAO,CAAC/F,aAAa,IAC9C+F,OAAO,CAAC/F,aAAa,CAAC,CAAC,KAAK,gBAAiB,EAAE;QAC/CiI,MAAM,GAAGH,YAAY,GAAG,CAACD,OAAO,CAACU,eAAe,CAAC,GAAGN,MAAM;QAC1D,KAAK,IAAI/E,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+E,MAAM,CAAC9E,MAAM,EAAED,CAAC,EAAE,EAAE;UACpC,IAAIR,MAAM,GAAGoF,YAAY,GAAGD,OAAO,GAAG,IAAI,CAACtB,gBAAgB,CAAC0B,MAAM,CAAC5E,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;UAC/F,IAAIZ,MAAM,CAAC+E,eAAe,CAAC,CAAC,IAAI,CAACK,YAAY,EAAE;YAC3CK,aAAa,GAAG,IAAI,CAACK,kBAAkB,CAAC9F,MAAM,EAAEyF,aAAa,CAAC;UAClE,CAAC,MACI;YACDA,aAAa,CAAC/E,IAAI,CAAC,IAAIzE,SAAS,CAACsJ,MAAM,CAAC5E,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAEyE,SAAS,CAACU,QAAQ,EAAEV,SAAS,CAAC3B,GAAG,EAAE2B,SAAS,CAACW,UAAU,EAAEX,SAAS,CAACY,YAAY,CAAC,CAAC;UAC1J;QACJ;QACA,IAAIC,QAAQ,GAAGjK,SAAS,CAACkK,EAAE,CAACV,aAAa,CAAC;QAC1CS,QAAQ,CAACxC,GAAG,GAAG2B,SAAS,CAAC3B,GAAG;QAC5BtE,KAAK,CAACgH,KAAK,CAACF,QAAQ,CAAC;MACzB,CAAC,MACI;QACD9G,KAAK,CAACiH,MAAM,CAAChB,SAAS,CAAC3B,GAAG,EAAE6B,MAAM,EAAEF,SAAS,CAACU,QAAQ,EAAEV,SAAS,CAACW,UAAU,EAAEX,SAAS,CAACY,YAAY,CAAC;MACzG;IACJ;IACA,OAAO7G,KAAK;EAChB,CAAC;EACDxC,IAAI,CAAC2B,SAAS,CAACsC,WAAW,GAAG,UAAUzB,KAAK,EAAEY,MAAM,EAAEsG,WAAW,EAAE;IAC/D,IAAIpH,IAAI,GAAG,IAAI,CAACrC,MAAM;IACtB,IAAI4I,aAAa,GAAG,EAAE;IACtB,IAAIc,YAAY,GAAG,EAAE;IACrB,IAAIC,aAAa,GAAG,IAAI,CAAC3J,MAAM,CAAC8I,oBAAoB,CAAC,CAAC;IACtD,IAAIc,eAAe;IACnB,IAAIvH,IAAI,CAACwH,cAAc,IAAIxH,IAAI,CAACyH,cAAc,CAACpG,OAAO,CAACE,MAAM,EAAE;MAC3D,IAAIF,OAAO,GAAGP,MAAM,GAAGA,MAAM,GAAGd,IAAI,CAACyH,cAAc,CAACpG,OAAO;MAC3D,IAAIqG,OAAO,GAAG,CAAC,CAAC;MAChB,KAAK,IAAIC,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAG5H,IAAI,CAACY,UAAU,CAAC,CAAC,EAAE+G,EAAE,GAAGC,EAAE,CAACrG,MAAM,EAAEoG,EAAE,EAAE,EAAE;QAC3D,IAAIpC,GAAG,GAAGqC,EAAE,CAACD,EAAE,CAAC;QAChBD,OAAO,CAACnC,GAAG,CAACtE,KAAK,CAAC,GAAGsE,GAAG,CAAC1E,MAAM,CAAC2B,IAAI,GAAG+C,GAAG,CAAC1E,MAAM,CAAC2B,IAAI,GAAGxC,IAAI,CAACyH,cAAc,CAACjF,IAAI;MACrF;MACA,IAAIqF,WAAW,GAAG,EAAE;MACpB,IAAIC,eAAe,GAAG,EAAE;MACxB,KAAK,IAAIC,EAAE,GAAG,CAAC,EAAEC,SAAS,GAAG3G,OAAO,EAAE0G,EAAE,GAAGC,SAAS,CAACzG,MAAM,EAAEwG,EAAE,EAAE,EAAE;QAC/D,IAAIxC,GAAG,GAAGyC,SAAS,CAACD,EAAE,CAAC;QACvB,IAAIE,UAAU,GAAG1C,GAAG,CAACW,YAAY,GAAGlG,IAAI,CAACkI,cAAc,CAAC3C,GAAG,CAAC4C,GAAG,CAAC,GAAGnI,IAAI,CAAC2E,gBAAgB,CAACY,GAAG,CAACtE,KAAK,CAAC;QACnG,IAAItE,iBAAiB,CAAC4I,GAAG,CAAC/C,IAAI,CAAC,IAAIyF,UAAU,KAAKA,UAAU,CAACzF,IAAI,KAAK,MAAM,IAAIyF,UAAU,CAACzF,IAAI,KAAK,UAAU,IAAIyF,UAAU,CAACzF,IAAI,KAAK,UAAU,CAAC,EAAE;UAC/I+C,GAAG,CAAC/C,IAAI,GAAG+C,GAAG,CAACW,YAAY,GAAGlG,IAAI,CAACkI,cAAc,CAAC3C,GAAG,CAAC4C,GAAG,CAAC,CAAC3F,IAAI,GAAGxC,IAAI,CAAC2E,gBAAgB,CAACY,GAAG,CAACtE,KAAK,CAAC,CAACuB,IAAI;QAC3G;QACA,IAAI+C,GAAG,CAACW,YAAY,EAAE;UAClB2B,WAAW,CAACrG,IAAI,CAAC+D,GAAG,CAAC;QACzB,CAAC,MACI;UACDuC,eAAe,CAACtG,IAAI,CAAC+D,GAAG,CAAC;QAC7B;MACJ;MACA,IAAIuC,eAAe,CAACvG,MAAM,EAAE;QACxB,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEoD,GAAG,GAAGoD,eAAe,CAACvG,MAAM,EAAED,CAAC,GAAGoD,GAAG,EAAEpD,CAAC,EAAE,EAAE;UACxDwG,eAAe,CAACrG,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACyG,GAAG,GAAGL,eAAe,CAACrG,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACyG,GAAG,IAC7F,IAAI,CAACxK,MAAM,CAACyK,4BAA4B,CAACN,eAAe,CAACrG,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAC/ET,KAAK,EAAE6G,eAAe,CAACrG,QAAQ,CAACH,CAAC,CAACI,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAACwE,YAAY,CAAC,CAACiC,GAAG;QACjF;QACA,IAAIE,cAAc,GAAG5K,kBAAkB,CAAC6K,YAAY,CAACR,eAAe,CAAC;QACrE,KAAK,IAAIS,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAGC,MAAM,CAACC,IAAI,CAACL,cAAc,CAAC,EAAEE,EAAE,GAAGC,EAAE,CAACjH,MAAM,EAAEgH,EAAE,EAAE,EAAE;UACrE,IAAII,IAAI,GAAGH,EAAE,CAACD,EAAE,CAAC;UACjBhC,aAAa,CAAC/E,IAAI,CAAC6G,cAAc,CAAC,EAAE,GAAGM,IAAI,CAAC,CAAC;QACjD;MACJ;MACA,IAAId,WAAW,CAACtG,MAAM,EAAE;QACpB,KAAK,IAAIqH,EAAE,GAAG,CAAC,EAAEC,aAAa,GAAGhB,WAAW,EAAEe,EAAE,GAAGC,aAAa,CAACtH,MAAM,EAAEqH,EAAE,EAAE,EAAE;UAC3E,IAAIrD,GAAG,GAAGsD,aAAa,CAACD,EAAE,CAAC;UAC3BrD,GAAG,CAAC4C,GAAG,GAAG5C,GAAG,CAAC4C,GAAG,IAAI,IAAI,CAACxK,MAAM,CAACyK,4BAA4B,CAAC7C,GAAG,CAACtE,KAAK,EAAEsE,GAAG,CAACW,YAAY,CAAC,CAACiC,GAAG;UAC9F,IAAIW,QAAQ,GAAG,IAAI,CAACnL,MAAM,CAACoL,0BAA0B,CAACxD,GAAG,CAAC4C,GAAG,CAAC;UAC9D,IAAI,CAACW,QAAQ,EAAE;YACX,IAAI,CAACnL,MAAM,CAACiH,GAAG,CAAC,gBAAgB,EAAE;cAAEC,UAAU,EAAE,QAAQ;cAAEC,UAAU,EAAES,GAAG,CAACtE;YAAM,CAAC,CAAC;UACtF;UACA,IAAI6H,QAAQ,CAACjD,eAAe,CAAC,CAAC,IAAIxI,0BAA0B,CAACkI,GAAG,CAACtE,KAAK,EAAEqG,aAAa,CAAC,IAAI,CAACF,WAAW,EAAE;YACpGC,YAAY,CAAC7F,IAAI,CAAC+D,GAAG,CAAC;YACtB,IAAI,CAACuD,QAAQ,CAACE,UAAU,CAACzH,MAAM,EAAE;cAC7BgG,eAAe,GAAG,IAAI;YAC1B;YACAhB,aAAa,GAAG,IAAI,CAACK,kBAAkB,CAACkC,QAAQ,EAAEvC,aAAa,CAAC;UACpE,CAAC,MACI;YACD,IAAI8B,cAAc,GAAG5K,kBAAkB,CAAC6K,YAAY,CAACjH,OAAO,CAAC;YAC7D,KAAK,IAAI4H,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAGT,MAAM,CAACC,IAAI,CAACL,cAAc,CAAC,EAAEY,EAAE,GAAGC,EAAE,CAAC3H,MAAM,EAAE0H,EAAE,EAAE,EAAE;cACrE,IAAIN,IAAI,GAAGO,EAAE,CAACD,EAAE,CAAC;cACjB1C,aAAa,CAAC/E,IAAI,CAAC6G,cAAc,CAAC,EAAE,GAAGM,IAAI,CAAC,CAAC;YACjD;UACJ;QACJ;MACJ;MACA,IAAIpC,aAAa,CAAChF,MAAM,IAAI,CAACgG,eAAe,EAAE;QAC1CrH,KAAK,CAACgH,KAAK,CAACnK,SAAS,CAACoM,GAAG,CAAC5C,aAAa,CAAC,CAAC;MAC7C,CAAC,MACI;QACD,IAAI,CAAC5I,MAAM,CAACqF,MAAM,CAACzF,MAAM,CAAC6L,aAAa,EAAE,CAAC,CAAC,CAAC;MAChD;IACJ;IACA,OAAOlJ,KAAK;EAChB,CAAC;EACDxC,IAAI,CAAC2B,SAAS,CAACuH,kBAAkB,GAAG,UAAUrB,GAAG,EAAEgB,aAAa,EAAE;IAC9D,IAAI8C,UAAU,GAAG,CAAC,CAAC;IACnB,IAAI9D,GAAG,EAAE;MACL,IAAI,CAAC5H,MAAM,CAACqF,MAAM,CAACzF,MAAM,CAAC8C,aAAa,EAAE;QAAEiJ,SAAS,EAAED,UAAU;QAAEvI,MAAM,EAAEyE;MAAI,CAAC,CAAC;MAChF,IAAI8D,UAAU,CAACC,SAAS,CAACC,UAAU,CAAChI,MAAM,EAAE;QACxCgF,aAAa,CAAC/E,IAAI,CAAC6H,UAAU,CAACC,SAAS,CAAC;MAC5C;IACJ;IACA,OAAO/C,aAAa;EACxB,CAAC;EACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI7I,IAAI,CAAC2B,SAAS,CAACJ,OAAO,GAAG,UAAU8D,IAAI,EAAE7C,KAAK,EAAE;IAC5C,IAAIsJ,KAAK,GAAG,IAAI;IAChB,IAAIzG,IAAI,KAAK,KAAK,CAAC,EAAE;MAAEA,IAAI,GAAG;QAAE0G,WAAW,EAAE;MAAG,CAAC;IAAE;IACnD,IAAIjF,GAAG,GAAG,IAAI,CAACkF,MAAM,CAAC3G,IAAI,CAAC4G,cAAc,IACrClB,MAAM,CAACC,IAAI,CAAC3F,IAAI,CAAC4G,cAAc,CAAC,CAACpI,MAAM,GACvCwB,IAAI,CAAC4G,cAAc,GAAG,IAAI,CAAChM,MAAM,CAACiM,uBAAuB,CAAC,CAAC,CAAC;IAChE,IAAI,CAACjM,MAAM,CAACiH,GAAG,CAAC,4BAA4B,EAAE;MAAE/G,SAAS,EAAE,IAAI,CAACF;IAAO,CAAC,CAAC;IACzE,IAAI,IAAI,CAACA,MAAM,CAACmC,UAAU,IAAI,QAAQ,IAAI,IAAI,CAACnC,MAAM,CAACmC,UAAU,EAAE;MAC9D,IAAI+J,GAAG,GAAG,IAAI,CAACC,YAAY,CAAC/G,IAAI,EAAE7C,KAAK,EAAEsE,GAAG,CAAC;MAC7C,OAAOqF,GAAG,CAACE,OAAO;IACtB,CAAC,MACI;MACD,IAAIC,IAAI,GAAG,KAAK,CAAC;MACjB,QAAQjH,IAAI,CAAC0G,WAAW;QACpB,KAAK,QAAQ;UACTvJ,KAAK,GAAGA,KAAK,GAAGA,KAAK,GAAG,IAAI,CAACG,aAAa,CAAC,CAAC;UAC5C;UACA,IAAIqE,GAAG,GAAG+D,MAAM,CAACC,IAAI,CAAC3F,IAAI,CAACkH,IAAI,CAAC,CAAC1I,MAAM;UACvC,IAAImD,GAAG,KAAK,CAAC,EAAE;YACXsF,IAAI,GAAG,IAAI,CAACnK,WAAW,CAACqK,MAAM,CAAC1F,GAAG,EAAEzB,IAAI,CAACkH,IAAI,CAAC,CAAC,CAAC,EAAE/J,KAAK,CAACiK,SAAS,EAAEjK,KAAK,CAAC;UAC7E,CAAC,MACI;YACD,IAAIkK,OAAO,GAAG;cACVC,YAAY,EAAE,EAAE;cAChBC,cAAc,EAAE,EAAE;cAClBC,cAAc,EAAE;YACpB,CAAC;YACDH,OAAO,CAACE,cAAc,GAAGvH,IAAI,CAACkH,IAAI;YAClCD,IAAI,GAAG,IAAI,CAACnK,WAAW,CAAC2K,WAAW,CAACJ,OAAO,EAAE5F,GAAG,EAAEtE,KAAK,CAACiK,SAAS,EAAEjK,KAAK,CAACuK,aAAa,CAAC,CAAC,CAAC;UAC7F;UACA;QACJ,KAAK,MAAM;UACPvK,KAAK,GAAGA,KAAK,GAAGA,KAAK,GAAG,IAAI,CAACG,aAAa,CAAC,CAAC;UAC5C0C,IAAI,CAAC2H,KAAK,GAAG/N,iBAAiB,CAACoG,IAAI,CAAC2H,KAAK,CAAC,GAAG,CAAC,GAAG3H,IAAI,CAAC2H,KAAK;UAC3DV,IAAI,GAAG,IAAI,CAACnK,WAAW,CAAC8K,MAAM,CAAC5H,IAAI,CAACkH,IAAI,EAAE/J,KAAK,CAACiK,SAAS,EAAEjK,KAAK,EAAE6C,IAAI,CAAC2H,KAAK,CAAC;UAC7E;MACR;MACA,IAAIX,OAAO,GAAG,SAAS;MACvBhH,IAAI,CAAC,EAAE,GAAGgH,OAAO,CAAC,GAAGC,IAAI;MACzB;MACA,IAAIA,IAAI,IAAI,CAACvH,KAAK,CAACmI,OAAO,CAACZ,IAAI,CAAC,IAAI,CAACA,IAAI,CAACa,cAAc,CAAC,gBAAgB,CAAC,EAAE;QACxE,OAAOb,IAAI,CAACc,IAAI,CAAC,YAAY;UACzB,OAAOtB,KAAK,CAACmB,MAAM,CAACzK,KAAK,EAAE6C,IAAI,CAAC;QACpC,CAAC,CAAC;MACN,CAAC,MACI;QACD,OAAO,IAAI,CAAC4H,MAAM,CAACzK,KAAK,EAAE6C,IAAI,CAAC;MACnC;IACJ;EACJ,CAAC;EACDrF,IAAI,CAAC2B,SAAS,CAACsL,MAAM,GAAG,UAAUzK,KAAK,EAAE6C,IAAI,EAAE;IAC3C,IAAIA,IAAI,CAAC0G,WAAW,KAAK,MAAM,EAAE;MAC7B1G,IAAI,CAAC7C,KAAK,GAAGA,KAAK;MAClB,IAAI,CAACvC,MAAM,CAACqF,MAAM,CAACzF,MAAM,CAACwN,WAAW,EAAEhI,IAAI,CAAC;IAChD;IACA,OAAO,IAAI,CAACiI,YAAY,CAAC9K,KAAK,CAAC;EACnC,CAAC;EACDxC,IAAI,CAAC2B,SAAS,CAAC2L,YAAY,GAAG,UAAU9K,KAAK,EAAE;IAC3C,IAAIsJ,KAAK,GAAG,IAAI;IAChB,IAAI,IAAI,CAAC3J,WAAW,CAACoL,KAAK,EAAE;MACxB,IAAIC,UAAU,GAAG,IAAIlO,QAAQ,CAAC,CAAC;MAC/B,IAAIiO,KAAK,GAAG,IAAI,CAACpL,WAAW,CAACoL,KAAK;MAClCA,KAAK,CAACH,IAAI,CAAC,YAAY;QACnBtB,KAAK,CAAC3J,WAAW,CAACmL,YAAY,CAAC9K,KAAK,CAAC,CAAC4K,IAAI,CAAC,UAAUK,MAAM,EAAE;UACzDD,UAAU,CAACE,OAAO,CAACD,MAAM,CAAC;QAC9B,CAAC,CAAC;MACN,CAAC,CAAC,CAACE,KAAK,CAAC,UAAU/L,CAAC,EAAE;QAClB4L,UAAU,CAACI,MAAM,CAAChM,CAAC,CAAC;MACxB,CAAC,CAAC;MACF,OAAO4L,UAAU,CAACnB,OAAO;IAC7B,CAAC,MACI;MACD,OAAO,IAAI,CAAClK,WAAW,CAACmL,YAAY,CAAC9K,KAAK,CAAC;IAC/C;EACJ,CAAC;EACDxC,IAAI,CAAC2B,SAAS,CAAC6F,iBAAiB,GAAG,UAAUT,KAAK,EAAExD,KAAK,EAAE;IACvD,IAAIrD,cAAc,GAAG,IAAI,CAACA,cAAc;IACxC,IAAIkD,MAAM,GAAG,IAAI,CAAC6D,gBAAgB,CAAC1D,KAAK,CAAC;IACzC,IAAIsK,IAAI,GAAG9G,KAAK;IAChB,IAAI,CAAC3D,MAAM,CAAC0B,IAAI,EAAE;MACd1B,MAAM,CAAC0B,IAAI,GAAG+I,IAAI,CAACC,MAAM,GAAID,IAAI,CAACE,QAAQ,CAAC,CAAC,GAAG,CAAC,IAAIF,IAAI,CAACG,UAAU,CAAC,CAAC,GAAG,CAAC,IACrEH,IAAI,CAACI,UAAU,CAAC,CAAC,GAAG,CAAC,IAAIJ,IAAI,CAACK,eAAe,CAAC,CAAC,GAAG,CAAC,GAAG,UAAU,GAAG,MAAM,GAAI,OAAQnH,KAAM;IACnG;IACA,IAAI9H,iBAAiB,CAACmE,MAAM,CAAC+K,YAAY,CAAC,CAAC,CAAC,EAAE;MAC1C1O,YAAY,CAACS,cAAc,EAAEkD,MAAM,CAAC;IACxC;IACA,IAAIgL,SAAS,GAAGtO,cAAc,CAAC6B,SAAS,CAAC0M,MAAM,CAACtH,KAAK,EAAE3D,MAAM,CAAC+K,YAAY,CAAC,CAAC,CAAC;IAC7E,OAAOC,SAAS;EACpB,CAAC;EACDpO,IAAI,CAAC2B,SAAS,CAACN,WAAW,GAAG,UAAUgE,IAAI,EAAE;IACzC,IAAI7C,KAAK,GAAG,IAAI,CAACG,aAAa,CAAC,CAAC;IAChC,IAAI0J,OAAO,GAAG,IAAI;IAClB,IAAIiC,EAAE,GAAG,SAAS;IAClB,IAAIxH,GAAG,GAAG,IAAI,CAACkF,MAAM,CAAC3G,IAAI,CAAC4G,cAAc,IACrClB,MAAM,CAACC,IAAI,CAAC3F,IAAI,CAAC4G,cAAc,CAAC,CAACpI,MAAM,GAAGwB,IAAI,CAAC4G,cAAc,GAC7D,IAAI,CAAChM,MAAM,CAACiM,uBAAuB,CAAC,CAAC,CAAC;IAC1C,IAAI,IAAI,CAACjM,MAAM,CAACmC,UAAU,IAAI,QAAQ,IAAI,IAAI,CAACnC,MAAM,CAACmC,UAAU,EAAE;MAC9D,IAAI,CAACgK,YAAY,CAAC/G,IAAI,EAAE7C,KAAK,EAAEsE,GAAG,CAAC;IACvC;IACA,QAAQzB,IAAI,CAAC0G,WAAW;MACpB,KAAK,MAAM;QACPM,OAAO,GAAG,IAAI,CAAClK,WAAW,CAACoM,MAAM,CAACzH,GAAG,EAAEzB,IAAI,CAACkH,IAAI,EAAE/J,KAAK,CAACiK,SAAS,EAAEjK,KAAK,EAAE6C,IAAI,CAACmJ,YAAY,CAAC;QAC5F;IACR;IACAnJ,IAAI,CAAC,EAAE,GAAGiJ,EAAE,CAAC,GAAGjC,OAAO,GAAGA,OAAO,GAAGhH,IAAI,CAAC,EAAE,GAAGiJ,EAAE,CAAC;IACjD,IAAI,CAACrO,MAAM,CAACqF,MAAM,CAACzF,MAAM,CAAC4O,UAAU,EAAEpJ,IAAI,CAAC;EAC/C,CAAC;EACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIrF,IAAI,CAAC2B,SAAS,CAACmL,WAAW,GAAG,UAAUJ,OAAO,EAAE5F,GAAG,EAAE4H,QAAQ,EAAElM,KAAK,EAAE;IAClE,IAAIA,KAAK,KAAK,KAAK,CAAC,EAAE;MAAEA,KAAK,GAAG,IAAI,CAACG,aAAa,CAAC,CAAC;IAAE;IACtDH,KAAK,CAACuK,aAAa,CAAC,CAAC;IACrB,IAAI,QAAQ,IAAI,IAAI,CAAC9M,MAAM,CAACmC,UAAU,EAAE;MACpC,IAAIuM,IAAI,GAAG,IAAIrP,QAAQ,CAAC,CAAC;MACzB,IAAI+F,IAAI,GAAG;QACP0G,WAAW,EAAE,WAAW;QAAEW,OAAO,EAAEA,OAAO;QAAE5F,GAAG,EAAEA,GAAG;QAAEtE,KAAK,EAAEA,KAAK;QAClEoM,OAAO,EAAED,IAAI,CAACjB;MAClB,CAAC;MACD,IAAI,CAACmB,QAAQ,CAAC;QAAEzO,SAAS,EAAE,IAAI;QAAEC,QAAQ,EAAEsO,IAAI,CAACjB;MAAQ,CAAC,CAAC;MAC1D,IAAI,CAACzN,MAAM,CAAC6O,OAAO,CAACjP,MAAM,CAACkP,iBAAiB,EAAE1J,IAAI,CAAC;MACnD,OAAOsJ,IAAI,CAACtC,OAAO;IACvB,CAAC,MACI;MACD,IAAIA,OAAO,GAAG,IAAI,CAAClK,WAAW,CAAC2K,WAAW,CAACJ,OAAO,EAAE5F,GAAG,EAAEtE,KAAK,CAACiK,SAAS,EAAEjK,KAAK,EAAEkM,QAAQ,CAAC;MAC1F,OAAOrC,OAAO;IAClB;EACJ,CAAC;EACDrM,IAAI,CAAC2B,SAAS,CAACqK,MAAM,GAAG,UAAUhB,IAAI,EAAE;IACpC,IAAIA,IAAI,IAAIA,IAAI,CAACnH,MAAM,EAAE;MACrB,OAAOmH,IAAI,CAAC,CAAC,CAAC;IAClB;IACA,OAAOxH,SAAS;EACpB,CAAC;EACD;AACJ;AACA;AACA;EACIxD,IAAI,CAAC2B,SAAS,CAACG,QAAQ,GAAG,YAAY;IAClC,OAAO,IAAI,CAACK,WAAW,CAACC,UAAU,CAACoE,OAAO,KAAK,IAAI,IAAI,IAAI,CAACrE,WAAW,CAACC,UAAU,CAAC4M,GAAG,KAAKxL,SAAS,IAChG,IAAI,CAACrB,WAAW,CAACC,UAAU,CAAC4M,GAAG,KAAK,EAAE;EAC9C,CAAC;EACDhP,IAAI,CAAC2B,SAAS,CAACd,OAAO,GAAG,UAAUe,CAAC,EAAE;IAClC,KAAK,IAAIgC,CAAC,GAAGhC,CAAC,CAACqN,OAAO,CAACpL,MAAM,EAAED,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAE;MACvC,IAAI,IAAI,CAAC3D,MAAM,CAACmC,UAAU,YAAYhD,WAAW,IAAI,IAAI,CAAC+C,WAAW,CAACC,UAAU,CAACoE,OAAO,EAAE;QACtF,IAAI,CAACrE,WAAW,CAACC,UAAU,CAACC,IAAI,CAACL,MAAM,CAACJ,CAAC,CAACK,OAAO,EAAE,CAAC,EAAEL,CAAC,CAACqN,OAAO,CAACrL,CAAC,GAAG,CAAC,CAAC,CAAC;MAC3E,CAAC,MACI,IAAM,CAAC,IAAI,CAAC3D,MAAM,CAAC4B,aAAa,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,IAAM,CAAC7C,iBAAiB,CAAC,IAAI,CAACgB,MAAM,CAACmC,UAAU,CAAE,IAC9F,CAAC,IAAI,CAACnC,MAAM,CAACmC,UAAU,CAACqL,MAAO,EAAE;QAClC,IAAI,CAACxN,MAAM,CAACmC,UAAU,CAAC,QAAQ,CAAC,CAACR,CAAC,CAACK,OAAO,EAAE,CAAC,EAAEL,CAAC,CAACqN,OAAO,CAACrL,CAAC,GAAG,CAAC,CAAC,CAAC;MACpE;IACJ;EACJ,CAAC;EACD5D,IAAI,CAAC2B,SAAS,CAACV,UAAU,GAAG,UAAUW,CAAC,EAAE;IACrC,IAAIS,IAAI,GAAG,IAAI,CAACF,WAAW,CAACC,UAAU,CAACC,IAAI;IAC3C,IAAI,IAAI,CAACpC,MAAM,CAACmC,UAAU,YAAYhD,WAAW,IAAI,IAAI,CAAC+C,WAAW,CAACC,UAAU,CAACoE,OAAO,EAAE;MACtF,IAAI,CAACrE,WAAW,CAACC,UAAU,CAACC,IAAI,GAAGA,IAAI,CAACc,MAAM,CAAC,UAAU4D,KAAK,EAAE;QAAE,OAAOnF,CAAC,CAACqN,OAAO,CAAC/G,OAAO,CAACnB,KAAK,CAAC,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC;IAChH,CAAC,MACI,IAAM,CAAC,IAAI,CAAC9G,MAAM,CAAC4B,aAAa,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,IAAM,CAAC7C,iBAAiB,CAAC,IAAI,CAACgB,MAAM,CAACmC,UAAU,CAAE,IAC9F,CAAC,IAAI,CAACnC,MAAM,CAACmC,UAAU,CAACqL,MAAO,EAAE;MAClC,IAAI,CAACxN,MAAM,CAACmC,UAAU,GAAGC,IAAI,CAACc,MAAM,CAAC,UAAU4D,KAAK,EAAE;QAAE,OAAOnF,CAAC,CAACqN,OAAO,CAAC/G,OAAO,CAACnB,KAAK,CAAC,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC;IACtG;EACJ,CAAC;EACD/G,IAAI,CAAC2B,SAAS,CAACsF,gBAAgB,GAAG,UAAU1D,KAAK,EAAE;IAC/C,IAAIsE,GAAG;IACP,OAAQ,IAAI,CAAC5H,MAAM,CAACiP,WAAW,CAAElG,IAAI,CAAC,UAAU5F,MAAM,EAAE;MACpDyE,GAAG,GAAGzE,MAAM;MACZ,OAAOA,MAAM,CAACG,KAAK,KAAKA,KAAK;IACjC,CAAC,CAAC,IAAIsE,GAAG;EACb,CAAC;EACD7H,IAAI,CAAC2B,SAAS,CAACR,OAAO,GAAG,YAAY;IACjC,IAAI,IAAI,CAAClB,MAAM,CAACQ,WAAW,EAAE;MACzB;IACJ;IACA,IAAI,CAACR,MAAM,CAACkP,GAAG,CAACtP,MAAM,CAACe,SAAS,EAAE,IAAI,CAACC,OAAO,CAAC;IAC/C,IAAI,CAACZ,MAAM,CAACkP,GAAG,CAACtP,MAAM,CAACmB,WAAW,EAAE,IAAI,CAACC,UAAU,CAAC;IACpD,IAAI,CAAChB,MAAM,CAACkP,GAAG,CAACtP,MAAM,CAACqB,kBAAkB,EAAE,IAAI,CAACV,eAAe,CAAC;IAChE,IAAI,CAACP,MAAM,CAACkP,GAAG,CAACtP,MAAM,CAACsB,OAAO,EAAE,IAAI,CAACA,OAAO,CAAC;IAC7C,IAAI,CAAClB,MAAM,CAACkP,GAAG,CAACtP,MAAM,CAACuB,UAAU,EAAE,IAAI,CAACC,WAAW,CAAC;IACpD,IAAI,CAACpB,MAAM,CAACkP,GAAG,CAACtP,MAAM,CAACyB,eAAe,EAAE,IAAI,CAACC,OAAO,CAAC;IACrD,IAAI,CAACtB,MAAM,CAACkP,GAAG,CAACtP,MAAM,CAAC2B,OAAO,EAAE,IAAI,CAACC,mBAAmB,CAAC;IACzD,IAAI,CAACxB,MAAM,CAACkP,GAAG,CAACtP,MAAM,CAAC6B,eAAe,EAAE,IAAI,CAACD,mBAAmB,CAAC;EACrE,CAAC;EACDzB,IAAI,CAAC2B,SAAS,CAACyN,QAAQ,GAAG,YAAY;IAClC,OAAO,IAAI,CAACjP,SAAS;EACzB,CAAC;EACDH,IAAI,CAAC2B,SAAS,CAACkN,QAAQ,GAAG,UAAUQ,KAAK,EAAE;IACvC,OAAO,IAAI,CAAClP,SAAS,GAAGkP,KAAK;EACjC,CAAC;EACDrP,IAAI,CAAC2B,SAAS,CAAC2N,sBAAsB,GAAG,YAAY;IAChD,OAAO,IAAI,CAAC/O,mBAAmB;EACnC,CAAC;EACDP,IAAI,CAAC2B,SAAS,CAAC4N,sBAAsB,GAAG,UAAUF,KAAK,EAAE;IACrD,IAAI,CAAC9O,mBAAmB,GAAG8O,KAAK;EACpC,CAAC;EACDrP,IAAI,CAAC2B,SAAS,CAAC6N,qBAAqB,GAAG,UAAUhN,KAAK,EAAE;IACpD,IAAIiN,MAAM,GAAG,IAAIlQ,UAAU,CAAC,CAAC;IAC7B,IAAImQ,EAAE,GAAG,IAAItQ,WAAW,CAAC;MAAE4P,GAAG,EAAE,EAAE;MAAEvI,OAAO,EAAE,IAAIlH,UAAU,CAAD;IAAE,CAAC,CAAC;IAC9D,IAAI8P,KAAK,GAAGI,MAAM,CAACE,YAAY,CAACD,EAAE,EAAElN,KAAK,CAAC;IAC1C,IAAI+J,IAAI,GAAGqD,IAAI,CAACC,KAAK,CAACR,KAAK,CAAC9C,IAAI,CAAC;IACjC,OAAOrN,MAAM,CAACqN,IAAI,EAAE8C,KAAK,CAACS,OAAO,CAAC;EACtC,CAAC;EACD9P,IAAI,CAAC2B,SAAS,CAACyK,YAAY,GAAG,UAAU/G,IAAI,EAAE7C,KAAK,EAAEsE,GAAG,EAAE;IACtD,IAAIgF,KAAK,GAAG,IAAI;IAChB,IAAIiE,QAAQ,GAAG1K,IAAI;IACnB,IAAIgK,KAAK,GAAG,IAAI,CAACG,qBAAqB,CAAChN,KAAK,CAAC;IAC7C,IAAI2J,GAAG,GAAG,IAAI7M,QAAQ,CAAC,CAAC;IACxB,IAAIqP,IAAI,GAAG,IAAIrP,QAAQ,CAAC,CAAC;IACzB,IAAI,CAAC+F,IAAI,CAAC0G,WAAW,KAAKvI,SAAS,IAAK,IAAI,CAACvD,MAAM,CAAC0G,aAAa,CAACqJ,yBAAyB,IAAIxN,KAAK,CAAC4C,OAAO,CAAC4D,IAAI,CAAC,UAAUxG,KAAK,EAAE;MAAE,OAAOA,KAAK,CAACwF,EAAE,KAAK,SAAS;IAAE,CAAC,CAAE,KAChK,IAAI,CAAC7H,SAAS,CAAC8P,aAAa,KAAK,KAAK,EAAE;MAC3CZ,KAAK,CAACa,MAAM,GAAG7K,IAAI;MACnB,IAAIA,IAAI,CAAC0G,WAAW,KAAK,MAAM,IAAI1G,IAAI,CAAC0G,WAAW,KAAK,QAAQ,IAAI1G,IAAI,CAAC0G,WAAW,KAAK,WAAW,EAAE;QAClG,IAAIoE,UAAU,GAAG9K,IAAI;QACrB8K,UAAU,CAACrJ,GAAG,GAAGA,GAAG;QACpB,IAAIuF,OAAO,GAAG,SAAS;QACvB8D,UAAU,CAAC,EAAE,GAAG9D,OAAO,CAAC,GAAGsC,IAAI,CAACtC,OAAO;QACvC8D,UAAU,CAACd,KAAK,GAAGA,KAAK;QACxB,IAAI,CAACR,QAAQ,CAAC;UAAEzO,SAAS,EAAE,IAAI;UAAEC,QAAQ,EAAEsO,IAAI,CAACjB;QAAQ,CAAC,CAAC;QAC1DqC,QAAQ,CAACnB,OAAO,GAAGD,IAAI,CAACjB,OAAO;QAC/BqC,QAAQ,CAACK,UAAU,GAAGzB,IAAI,CAACf,MAAM;QACjC,IAAI,CAAC3N,MAAM,CAAC6O,OAAO,CAACjP,MAAM,CAACkP,iBAAiB,EAAEoB,UAAU,CAAC;QACzDxB,IAAI,CAACtC,OAAO,CAACe,IAAI,CAAC,YAAY;UAC1BtB,KAAK,CAAC+C,QAAQ,CAAC;YAAEzO,SAAS,EAAE,IAAI;YAAEC,QAAQ,EAAE8L,GAAG,CAACuB,OAAO;YAAEpN,KAAK,EAAE+O,KAAK,CAAC/O,KAAK;YAAEmE,UAAU,EAAE4K,KAAK,CAAC5K;UAAW,CAAC,CAAC;UAC5G,IAAI0L,UAAU,CAACpE,WAAW,KAAK,MAAM,EAAE;YACnCD,KAAK,CAAC7L,MAAM,CAACqF,MAAM,CAACzF,MAAM,CAACwN,WAAW,EAAE8C,UAAU,CAAC;UACvD;UACArE,KAAK,CAAC7L,MAAM,CAAC6O,OAAO,CAACjP,MAAM,CAACwQ,eAAe,EAAEhB,KAAK,CAAC;QACvD,CAAC,CAAC,CACG1B,KAAK,CAAC,YAAY;UAAE,OAAO,KAAK,CAAC;QAAE,CAAC,CAAC;MAC9C,CAAC,MACI;QACD,IAAI,CAACkB,QAAQ,CAAC;UAAEzO,SAAS,EAAE,IAAI;UAAEC,QAAQ,EAAE8L,GAAG,CAACuB,OAAO;UAAEpN,KAAK,EAAE+O,KAAK,CAAC/O,KAAK;UAAEmE,UAAU,EAAE4K,KAAK,CAAC5K;QAAW,CAAC,CAAC;QAC3G,IAAI,CAACxE,MAAM,CAAC6O,OAAO,CAACjP,MAAM,CAACwQ,eAAe,EAAEhB,KAAK,CAAC;MACtD;IACJ,CAAC,MACI;MACD,IAAI,CAACR,QAAQ,CAAC,CAAC,CAAC,CAAC;MACjB1C,GAAG,CAACuB,OAAO,CAAC,IAAI,CAACzN,MAAM,CAACmC,UAAU,CAAC;IACvC;IACA,OAAO+J,GAAG;EACd,CAAC;EACD;AACJ;AACA;AACA;AACA;EACInM,IAAI,CAAC2B,SAAS,CAACiH,yBAAyB,GAAG,YAAY;IACnD,IAAI0H,aAAa,GAAG,EAAE;IACtB,IAAI3M,OAAO,GAAG,IAAI,CAAC1D,MAAM,CAACiD,UAAU,CAAC,CAAC;IACtC,KAAK,IAAI+G,EAAE,GAAG,CAAC,EAAEsG,SAAS,GAAG5M,OAAO,EAAEsG,EAAE,GAAGsG,SAAS,CAAC1M,MAAM,EAAEoG,EAAE,EAAE,EAAE;MAC/D,IAAIpC,GAAG,GAAG0I,SAAS,CAACtG,EAAE,CAAC;MACvB,IAAIpC,GAAG,CAAC2I,cAAc,IAAI,CAACvR,iBAAiB,CAAC4I,GAAG,CAACtE,KAAK,CAAC,EAAE;QACrD+M,aAAa,CAACxM,IAAI,CAAC+D,GAAG,CAACtE,KAAK,CAAC;MACjC;IACJ;IACA,OAAO+M,aAAa;EACxB,CAAC;EACDtQ,IAAI,CAAC2B,SAAS,CAACF,mBAAmB,GAAG,YAAY;IAC7C,IAAI,IAAI,CAACxB,MAAM,CAAC6J,cAAc,IAAI,IAAI,CAAC7J,MAAM,CAAC8J,cAAc,CAACpG,OAAO,CAACE,MAAM,EAAE;MACzEjE,sBAAsB,CAAC,IAAI,CAACK,MAAM,EAAE,IAAI,CAACA,MAAM,CAAC8J,cAAc,CAACpG,OAAO,CAAC;IAC3E;EACJ,CAAC;EACD,OAAO3D,IAAI;AACf,CAAC,CAAC,CAAE;AACJ,SAASA,IAAI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}